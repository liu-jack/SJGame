S.SSCL.Games=Backbone.Collection.extend({model:S.SSMO.Game,initialize:function(){_.bindAll(this,"parse")},parse:function(t){return t.data}});S.SSCT.Game=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},validate:function(t,e){this.validModel=S.SSCT.GetHandler("Model","ValidCode"),this.validModel.on("error",_.bind(function(t,n){e.error(n.msg||n),this.validModel.off("error")},this));var n=this.validModel.set({alphaCode:t});n&&this.validModel.validCode({alphaCode:t},{success:e.success,error:function(t,n){console.log("resp",n),e.error(n.msg)}})},getGameInfo:function(t){function e(e){o.gameId=e.data.gameId,o.gameInfo=e.data,t&&t.success&&t.success.apply(this,[e.data])}function n(e){t&&t.error&&t.error.apply(this,[e])}if(null==this.gameId){var o=this;S.sdkBase.request(this.servType.COMMON,this.actions.GET_GAME_INFO,{},e,n)}else _.isUndefined(t)||_.isUndefined(t.success)||!_.isFunction(t.success)||t.success.apply(this,[this.gameInfo])}});S.SSMO.Game=Backbone.Model.extend({initialize:function(){}});S.SSMO.ValidCode=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.VALID_CODE},validate:function(t){if(!this.isRequest){if(_.isUndefined(t.alphaCode)&&_.isEmpty(t.alphaCode))return"激活码不能为空";if(6!=t.alphaCode.length||t.alphaCode.match(/[^a-z0-9A-Z]+/))return"请输入正确的激活码"}this.isRequest=!1},validCode:function(t,e){this.save(t,e)},parse:function(t){return this.isRequest=!0,t.data}});S.SSVW.Game=Backbone.View.extend({el:"#gameContainer",events:{"onclick #bbsLink":"linkToBBS","onclick #gameCenterLink":"linkToGameCenter","onclick #confirmValidCode":"doConfirm","onclick #exitValidCode":"doExit","onclick #clearCode":"flushInpt","onclick #validCode":"_inputFocuse","focusout #validCode":"hideClrPass","onclick #toUserCenterLink":"gotoUserCenter"},isRandom:null,initialize:function(){_.bindAll(this),this.gameController=S.SSCT.GetHandler("Controller","Game")},notOpen:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_GAME,enterBusiness:["notOpen"]})},validCode:function(t){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_GAME,enterBusiness:["validateCode"]}),this.isRandom=_.isUndefined(t)||_.isEmpty(t)?"false":t,this.changeClrPass(),this.initLogoutBtn()},doConfirm:function(){var t=this,e=this.$el.find("#validCode").val(),n=S.SSCT.GetHandler("Controller","User");this.$el.find("#confirmValidCode").attr("disabled","disabled"),this.$el.find("#confirmValidCode").attr("data-disabled","true").addClass("ui-disabled"),this.gameController.validate(e,this.gameController.callBackMix(function(e,o){function i(){"true"===t.isRandom?sdk.Url.redirect("../user/user.html#!user/updatePassword/true"):n.notifyCp({code:o.code,msg:o.msg},n.callBackMix(n.sdkExit))}S.SSCT.GetHandler("Controller","User").getCurUserInfo({success:function(e){ucf.Cache.remove("isAlpha_"+e.ucid,!0),i.call(t)},error:function(){i.call(t)}})},function(e){t._showErrorMsg(e,"#validCodeNoticeBox"),t.$el.find("#confirmValidCode").removeAttr("disabled"),t.$el.find("#confirmValidCode").attr("data-disabled","").removeClass("ui-disabled")}))},doExit:function(){S.Log.pageClose(),S.SSCT.GetHandler("Controller","User").sdkExit()},flushInpt:function(){_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||sdk.common.ui.NoticeBox.hide(this.noticeBar,null,"slide"),this.$el.find("#validCode").val("")},changeClrPass:function(){_.isEmpty($("#validCode").val())?$("#clearValidCode").hide():$("#clearValidCode").show()},hideClrPass:function(){$("#clearValidCode").hide()},initLogoutBtn:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(t){"logout"==t.action&&(S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT),S.SSCT.GetHandler("Controller","User").sdkExit())}})},linkToBBS:function(){var t=this;S.SSCT.GetHandler("Controller","General").getUrl("gameBbs",{success:function(t){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bbsClick"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["bbsClick"]),sdk.PageCache.set("sdk_redirect_out",1),S.Url.redirect(t)},error:function(e){t._showErrorMsg(e.msg)}})},linkToGameCenter:function(){sdk.Log.pageClose(sdk.Log.businesses.PAGE_GAME,["notOpen"]),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_GAME,["gameCenter"]),S.Url.redirect(eConfig.gameCenter)},_inputFocuse:function(){this.changeClrPass()},_showErrorMsg:function(t,e,n){S.SSCT.GetHandler("Controller","General").sendClientMsg(t),n&&n.apply()},gotoUserCenter:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ValidCode_to_UserCenter_l"],{callback:function(){S.Url.redirect("../user/user.html#!user")},quiet:!1})}});