S.SSCL.LoginHist=Backbone.Collection.extend({initialize:function(){_.bindAll(this)},getHistory:function(e){var t=e.success?e.success:null,n=e.error?e.error:null,i=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.GET_LOGIN_GAMEHISTORYSYNC,e.data);i.success?(this.reset(i.data),t.apply(this,[this,i])):(this.reset([]),n.apply(this,[this,i]))},getServerHistory:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.QUERY_HISTORY,this.fetch(e)},parse:function(e){return e}});S.SSCL.QuestionList=Backbone.Collection.extend({initialize:function(){_.bindAll(this)},getQuestionList:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_QUESTION_HISTORY,this.fetch(e)},parse:function(e){return e}});S.SSCT.AccountManage=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},getSecureState:function(e){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.getSecureState({success:function(t,n){console.log("getSecureState success : "+JSON.stringify(n)),e.success(n.data)},error:function(t,n){console.log("getSecureState error : "+JSON.stringify(n)),e.error(n.msg)},quiet:!0})},getSecureStateDetail:function(e,t){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.getSecureStateDetail({data:{items:e},success:function(e,n){console.log("getSecureStateDetail success : "+JSON.stringify(n)),t.success(n.data)},error:function(e,n){console.log("getSecureStateDetail error : "+JSON.stringify(n)),t.error(n.msg)},quiet:!0})},sendCode2Mobile:function(e,t){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.sendCodeToMobile({data:e,success:function(e,t){console.log("sendCodeToMobile success : "+JSON.stringify(t))},error:function(e,n){console.log("sendCodeToMobile error : "+JSON.stringify(n)),t.error(n.msg)},quiet:!0})},doBindMobile:function(e,t){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy");var n=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);n!==!1&&n>=0&&(e.encrypt=rConfig.SECURITY_TYPE.SECURITY),this.secureModel.bindMobile({data:e,success:function(e,n){console.log("bindMobile success : "+JSON.stringify(n)),t.success()},error:function(e,n){console.log("bindMobile error : "+JSON.stringify(n)),t.error(n)},quiet:!0})},checkIsBinded:function(e,t){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.checkIsBinded({data:e,success:function(e,n){console.log("checkIsBinded success : "+JSON.stringify(n)),t.success(n.data)},error:function(e,n){console.log("checkIsBinded error : "+JSON.stringify(n)),t.error(n.msg)},quiet:!0})},doSaveSecurityQuestions:function(e,t){var n=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);n!==!1&&n>=0&&(e.encrypt=rConfig.SECURITY_TYPE.SECURITY),this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.saveSecurityQuestions({data:e,success:function(){t.success()},error:function(e,n){t.error(n)},quiet:!0})}});S.SSCT.Secrecy=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},sendMsgToMobile:function(e,t){var n=S.SSCT.GetHandler("Model","Secrecy");n.changeUrl("sendMsgToMobile"),n.fetch({data:e,success:function(){var n=S.SSCT.GetHandler("Controller","General");n.setCacheData("phone",e.phone,1800,!0),t.success()},error:function(e,n){t.error(n.msg)},quiet:!0})},doBindMobile:function(e,t){var n=S.SSCT.GetHandler("Model","Secrecy");n.changeUrl("bindMobile"),n.fetch({data:e,success:function(){t.success()},error:function(e,n){t.error(n.msg)},quiet:!0})}});S.SSCT.Sso=Backbone.Controller.extend({initialize:function(){},CONFIG:{ACCOUNT_TYPE:{LOGIN:0,GAME_LOGIN:1},SECURITY_TYPE:{UNSECURITY:0,SECURITY:1}},histLength:{},serverHistLength:{},getHistLength:function(e){var t=this.histLength[e]?this.histLength[e]:0;return t},loginConfig:null,getLoginConfig:function(){return this.loginConfig||this.getLoginData(this.callBackMix(function(e){this.loginConfig=e})),this.loginConfig},histories:{},getHistories:function(e){return this.histories[e]?this.histories[e]:void 0},setHistories:function(e,t){this.histories[e]=t},serverHistories:{},getServerHistories:function(e){return this.serverHistories[e]?this.serverHistories[e]:void 0},validLoginData:function(e,t,n,i,o){o=o?o:{},o.error=o.error?o.error:function(){},o.success=o.success?o.success:function(){};var r={};if(0===t.length)return r.msg="密码不能为空",r.code=102,o.error(r),void 0;if(0===e.length)return r.msg="账号不能为空",r.code=101,o.error(r),void 0;if(n===this.CONFIG.ACCOUNT_TYPE.LOGIN){if(e.length<2||e.length>20)return r.msg="账号长度必须在2到20位之间",r.code=103,o.error(r),void 0;if(!rConfig.user.accountFilter.test(e)&&!rConfig.user.emailAccountFilter.test(e))return r.msg="账号格式错误",r.code=104,o.error(r),void 0;if((!i||!i.isSecurity)&&(t.length<6||t.length>20))return r.msg="密码长度必须在6到20位之间",r.code=105,o.error(r),void 0}o.success(e,t)},loginSubmit:function(e,t,n){n=n?n:{},n.error=n.error?n.error:function(){},n.success=n.success?n.success:function(){};var i=S.SSCT.GetHandler("Model","Sso");i.on("error",_.bind(function(e,t){n.error(e,{msg:t}),i.off("error")},this));var o=_.isUndefined(e.accountType)?0:e.accountType,r=_.isUndefined(e.rememberPassword)?!0:e.rememberPassword;e.accountType=o,e.rememberPassword=r;var s=i.set(e);s&&i.login({success:function(e,t){var i=S.SSCT.GetHandler("Controller","User");i.getCurUserInfo(),n.success(e,t)},error:function(e,t){n.error(e,t)},data:e,quiet:t})},getLoginData:function(e){var t=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.GET_LOGIN_CONFIG);!_.isUndefined(t)&&t.success?(this.loginConfig=t.data,e.success(t.data)):e.error(t?t.msg:"获取登录配置失败")},getHistory:function(e,t,n){n=_.isUndefined(n)?!1:n,t=t?t:{};var i=S.SSCT.GetHandler("Collection","LoginHist"),o=this;i.getHistory({success:function(n,i){o.histories[e]=i.data,o.histLength[e]=i.data.length?i.data.length:0,e===o.CONFIG.ACCOUNT_TYPE.LOGIN&&_.each(i.data,function(e){var t=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+e.account,!0);t&&(e.isRandomPassword=t.random)}),t.success&&t.success(i.data)},error:function(e,n){t.error&&t.error(n.msg)},data:{accountType:e},quiet:n})},getServerHistory:function(e,t){t=t?t:{};var n=S.SSCT.GetHandler("Collection","LoginHist"),i=this;return i.serverHistories[e]?(t.success&&t.success(i.serverHistories[e]),void 0):(n.getServerHistory({success:function(n,o){var r=o.data.uids;i.serverHistories[e]=r,i.serverHistLength[e]=r.length?r.length:0,e===i.CONFIG.ACCOUNT_TYPE.LOGIN&&_.each(r,function(e){var t=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+e.account,!0);t&&(e.isRandomPassword=t.random)}),t.success&&t.success(r)},error:function(e,n){t.error&&t.error(n.msg)},data:{accountType:e},quiet:!0}),void 0)},getHistByUsername:function(e,t,n){var i=null,o=this.histories[t];_.isUndefined(e)||_.isUndefined(o)||_.each(o,function(t){t.account==e&&(i=t)}),i?n.success&&n.success(i):n.error&&n.error("找不到匹配的用户账号")},clearHistFlag:function(e){e=e?e:{};var t=sdk.PageCache.get("clear_history");t.success&&1===t.data?(S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.CLEAR_HISTORY),sdk.PageCache.del("clear_history"),e.success&&e.success()):e.error&&e.error()},getLoginCount:function(e){var t=ucf.Cache.get("login_count_info",!0)||{};return t[e]||0},updateLoginCount:function(e){var t=ucf.Cache.get("login_count_info",!0)||{},n=t[e]||0;n++,t[e]=n,ucf.Cache.set("login_count_info",t,0,!0)},validSecrecy:function(e,t,n){var i=S.SSCT.GetHandler("Controller","AccountManage");i.getSecureStateDetail(["mobile","question"],i.callBackMix(function(e){var t=e.mobile||{},i=e.question||{};1===t.code&&_.isEmpty(t.mobile)&&(1===i.code||126===i.code)&&_.isEmpty(i.password_question)?n.success(e):n.error&&n.error("safe")},function(){n.error&&n.error("fail")}))},getGameNotice:function(e){e=e?e:{},e.error=e.error?e.error:function(){},e.success=e.success?e.success:function(){};var t=S.SSCT.GetHandler("Model","Sso");t.getGameNotice({success:function(t,n){var i,o,r=n.data.msgs;if(null==r)ucf.Cache.set("game_notice",{},0,!0);else if(i=r.length,0==i)ucf.Cache.set("game_notice",{},0,!0);else{o=r[0];for(var s=i-1;s>=0;s--)parseInt(r[s].priority)<parseInt(o.priority)&&(o=r[s]);ucf.Cache.set("game_notice",o,0,!0)}e.success(o)},error:function(t,n){ucf.Cache.set("game_notice",{},0,!0),e.error(n.msg)},data:{msgType:1},quiet:!0})}});S.SSCT.User=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},curUser:{},userName:"",getCurUser:function(){return this.curUser},setCurUser:function(e){this.curUser=e},getCurUserInfo:function(e){var t=S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_CURR_USER);t.success?(this.curUser=t.data,e&&e.success&&e.success.apply(this,[t.data])):e&&e.error&&e.error.apply(this,[t.msg])},getBaseUserInfo:function(e,t){e=e?e:{};var n=ucf.Cache.get("userBaseInfo_"+this.curUser.ucid,!0);if(_.isUndefined(n)||_.isEmpty(n)){var i=S.SSCT.GetHandler("Model","User");t=_.isUndefined(t)?!1:t,i.fetchBaseUserInfo({data:{uid:this.curUser.ucid},success:$.proxy(function(t){n=t.toJSON(),ucf.Cache.set("userBaseInfo_"+this.curUser.ucid,n,1800,!0),e.success&&e.success.apply(this,[n])},this),error:$.proxy(function(t,n){e.error&&e.error.apply(this,[n.msg])},this),quiet:t})}else e.success&&e.success.apply(this,[n])},updatePass:function(e,t){var n=t.success?t.success:function(){},i=t.error?t.error:function(){},o=S.SSCT.GetHandler("Model","User");o.off("error"),o.on("error",$.proxy(function(e,t){i.apply(this,[t])},this));var r=o.set(e);r&&o.updatePass({success:$.proxy(function(){this.getCurUserInfo(this.callBackMix(function(e){ucf.Cache.set("user_info_"+e.ucid,{random:!1},0,!0)})),n()},this),error:$.proxy(function(e,t){i.apply(this,[t.msg])},this),data:e})},registerUpdatePass:function(e,t){var n=t.success?t.success:function(){},i=t.error?t.error:function(){},o=S.SSCT.GetHandler("Model","User");o.off("error"),o.on("error",$.proxy(function(e,t){i.apply(this,[t])},this));var r=o.set(e),s=this;r&&o.updatePass({success:$.proxy(function(){s.getCurUserInfo(s.callBackMix(function(t){s.setRegData(t.ucid,e.password),ucf.Cache.set("user_info_"+t.ucid,{random:!1},0,!0)})),n()},this),error:$.proxy(function(e,t){i.apply(this,[t.msg])},this),data:e})},register:function(e,t,n){t=t?t:{},n=_.isUndefined(n)?!1:n;var i=S.SSCT.GetHandler("Model","Register");i.off("error"),i.on("error",function(e,n){t.error(n)});var o=i.set(e);o&&i.register({data:e,success:$.proxy(function(e,n){this.setRegData(e.get("ucid"),e.get("password"));var i=S.SSCT.GetHandler("Controller","General");i.setCacheData("regUcid",e.get("ucid"),1800,!0),t.success(e,n)},this),error:function(e,n){t.error(n.msg)},quiet:n})},sdkExit:function(){S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGIN_EXIT_SDK)},getVipInfo:function(e,t){var n=S.SSCT.GetHandler("Model","Vip"),i=this;t=_.isUndefined(t)?!0:t,n.fetchVipInfo({success:function(t,n){"1"==n.data.privilegeStatus&&"1"==n.data.vipStatus?e.success&&e.success():e.error&&e.error("no vip privilege")},error:function(){e.error&&e.error("privilegeStatus or vipStatus exception!!")},data:{uid:i.curUser.ucid,privilegeCode:"0001",timestamp:Math.round((new Date).getTime()/1e3)},quiet:t})},notifyCp:function(e,t,n){switch(n=_.isUndefined(n)||_.isEmpty(n)?"login":n){case"login":var i=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGIN_NOTIFY_CP,{code:e.code,msg:e.msg});break;case"logout":var i=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT_NOTIFY_CP,e)}i.success?t&&t.success&&t.success.apply(this):t&&t.error&&t.error.apply(this)},setRegData:function(e,t){sdk.PageCache.set("regInfo",JSON.stringify({ucid:e,password:t}))},getRegData:function(e){var t=sdk.PageCache.get("regInfo");e&&(t.success?e.success&&!_.isEmpty(t.data)?e.success(JSON.parse(t.data)):e.error():e.error&&e.error())},getFeatureSwitch:function(e){var t=e&&e.success?e.success:function(){},n=e&&e.error?e.error:function(){},i=S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_FEATURE_SWITCH);i.success?t.apply(this,[i.data]):n.apply(this,[i])},logout:function(e){var t=e&&e.success?e.success:function(){},n=e&&e.error?e.error:function(){},i=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT);i.success?(this.notifyCp(null,null,"logout"),t.apply()):n.apply()},setNerverNotice:function(e,t,n){var i=ucf.Cache.get("nerver_notice_info",!0)||{};n=_.isUndefined(n)?"existAccount":n,i[e]=i[e]||{},i[e][n]=t,ucf.Cache.set("nerver_notice_info",i,0,!0)},checkNoticeInfo:function(e,t){var n=ucf.Cache.get("nerver_notice_info",!0)||{};return t=_.isUndefined(t)?"existAccount":t,n[e]=n[e]||{},n[e][t]?!0:!1},getSecQuestion:function(e,t){var n=S.SSCT.GetHandler("Model","User");return e&&0!==e?rConfig.user.accountFilter.test(e)?(n.getSecQuestion({data:{ucid:parseInt(e)},success:function(e,n){n.data?t.success&&t.success(n.data):t.error&&t.error(n.msg)},error:function(e,n){t.error&&t.error(n.msg)}}),void 0):(t.error&&t.error("UC账号必须为数字"),void 0):(t.error&&t.error("请输入UC账号"),void 0)},validateAnswer:function(e,t){var n=S.SSCT.GetHandler("Model","User");return e.password_answer&&0!==e.password_answer.length?(n.validateAnswer({data:e,success:function(e,n){t.success&&t.success(n)},error:function(e,n){t.error&&t.error(n.msg)}}),void 0):(t.error&&t.error("请输入密保问题答案"),void 0)},resetPassword:function(e,t){var n=S.SSCT.GetHandler("Model","User");if(e.password.length<6||e.password.length>20)return t.error&&t.error("密码长度不符（6-20位）"),void 0;if(e.password.match(rConfig.user.passwordFilter))return t.error&&t.error("密码必须为字母或数字"),void 0;var i=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);i!==!1&&i>=0&&(e.encrypt=rConfig.SECURITY_TYPE.SECURITY),n.resetPassword({data:e,success:function(n,i){var o=ucf.Cache.get("user_info_"+e.ucid,!0);o&&o.random&&ucf.Cache.set("user_info_"+e.ucid,{random:!1},0,!0),t.success&&t.success(i.data)},error:function(e,n){t.error&&t.error(n.msg)}})},updateNickname:function(e,t){var n=t.success?t.success:function(){},i=t.error?t.error:function(){},o=S.SSCT.GetHandler("Model","User"),r=this;o.off("error"),o.on("error",$.proxy(function(e,t){i.apply(this,[t])},this));var s=o.set(e);s&&o.updateNickname({success:$.proxy(function(){r.getCurUserInfo();var t=r.curUser,i=ucf.Cache.get("userBaseInfo_"+t.ucid,!0);i&&ucf.Cache.remove("userBaseInfo_"+t.ucid,!0),this.userName=e.userName,n()},this),error:$.proxy(function(e,t){i.apply(this,[t.msg])},this),data:e})},removeHistory:function(e,t){var n=S.SSCT.GetHandler("Model","User");n.removeHistory({data:e,success:function(){t.success()},error:function(e,n){t.error&&t.error(n.msg)},quiet:!0})},getLoginHistoryCount:function(e,t){var n=S.SSCT.GetHandler("Model","User");n.getLoginHistoryCount({data:e,success:function(e,n){t.success&&t.success(n.data)},error:function(e,n){t.error&&t.error(n.msg)},quiet:!0})},registerGuestAccount:function(e,t){var n=S.SSCT.GetHandler("Model","User");n.registerGuestAccount({data:e,success:function(e,n){t.success&&t.success(n)},error:function(e,n){t.error&&t.error(n)},quiet:!1})},bindGuestAccount:function(e,t){var n=S.SSCT.GetHandler("Model","User");n.bindGuestAccount({data:e,success:function(e,n){t.success&&t.success(n)},error:function(e,n){t.error&&t.error(n)},quiet:!1})},rechargeUPoint:function(e,t){var n=S.SSCT.GetHandler("Model","User");n.rechargeUPoint({data:e,success:function(e,n){t.success&&t.success(n.data)},error:function(e,n){t.error&&t.error(n)}})},setAutoLoginState:function(e,t){var n=S.SSCT.GetHandler("Model","User");n.setAutoLoginState({data:e,success:function(e,n){t.success&&t.success(n.data)},error:function(e,n){t.error&&t.error(n)},quiet:!0})},getAccountInfoByLoginName:function(e,t){var n=S.SSCT.GetHandler("Model","User");n.getAccountInfoByLoginName({data:{loginName:e},success:function(e,n){t.success&&t.success(n.data)},error:function(e,n){t.error&&t.error(n)},quiet:!1})},validMsgRetakeAccount:function(e,t){var n="";_.isEmpty(e)?(n="账号不为空",t.error(n)):e.length<2||e.length>20?(n="账号长度必须在2到20位之间",t.error(n)):rConfig.user.accountFilter.test(e)||rConfig.user.emailAccountFilter.test(e)?t.success():(n="账号格式错误",t.error(n))}});S.SSCT.Pay=Backbone.Controller.extend({getUPointBalance:function(e){var t=e&&e.success?e.success:function(){},n=e&&e.error?e.error:function(){},i=S.SSCT.GetHandler("Model","UPoint");i.fetchUPoint({success:t,error:n,data:null,quiet:!0})}});S.SSMO.Register=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.REGISTER,this.isRequest=!1},validate:function(e){if(!this.isRequest){if(_.isEmpty(e.password))return"密码不能为空，请重新输入";if(e.password.length<6||e.password.length>20)return"密码长度为6-20位";if(e.password.match(rConfig.user.passwordFilter))return"密码只能为英文字母和数字，请重新输入";if(!e.agree)return"不同意UC账号服务协议无法注册哦^-^"}this.isRequest=!1},register:function(e){this.fetch(e)},parse:function(e){return this.isRequest=!0,e.data}});S.SSMO.Secrecy=Backbone.Model.extend({initialize:function(){_.bindAll(this)},validate:function(e){console.log(e),null===e.mobile&&console.log("手机号码不为null")},validateMobile:function(e){return null===e.match(rConfig.user.mobileFilter)?{msg:"手机号码必须为数字",success:!1}:11!==e.length||"1"!==e[0]?{msg:"手机号码输入错误",success:!1}:{msg:"success",success:!0}},validateCode:function(e){return null==e||""==e?{msg:"验证码不能为空",success:!1}:{msg:"success",success:!0}},validateQuestions:function(e){return e.length<2||e.length>20?{msg:"密保问题长度必须在2~20位之间",success:!1}:{msg:"success",success:!0}},validateQuestionAnswers:function(e){return e.length<2||e.length>20?{msg:"密保答案长度必须在2~20位之间",success:!1}:{msg:"success",success:!0}},validatePassword:function(e){return e.length<6||e.length>20?{msg:"密码长度必须在6~20位之间",success:!1}:e.match(rConfig.user.passwordFilter)?{msg:"密码只能为英文字母和数字，请重新输入",success:!1}:{msg:"success",success:!0}},parse:function(e){return e.data},getSecureState:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_QUERYSECURESTATE,this.fetch(e)},getSecureStateDetail:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_GETSECURESTATE,this.fetch(e)},sendCodeToMobile:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_SENDMOBILESMSCODE,this.fetch(e)},bindMobile:function(e){var t=this.validateCode(e.data.code),n=this.validatePassword(e.data.password);t.success?n.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_BINDMOBILEBYSMSCODE,this.fetch(e)):e.error(this,n):e.error(this,t)},checkIsBinded:function(e){var t=this.validateMobile(e.data.mobile);t.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_CHECKISBINDED,this.fetch(e)):e.error(this,t)},saveSecurityQuestions:function(e){var t=this.validateQuestions(e.data.password_question),n=this.validateQuestionAnswers(e.data.password_answer),i=this.validatePassword(e.data.password);t.success?n.success?i.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_SETPASSWORDQUESTION,this.fetch(e)):e.error(this,i):e.error(this,n):e.error(this,t)}});S.SSMO.Sso=Backbone.Model.extend({defaults:{rememberPassword:!0},initialize:function(){_.bindAll(this)},login:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.LOGIN,this.fetch(e)},getGameNotice:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_GAMENOTICE,this.fetch(e)},parse:function(e){this.isRequest=!0;var t=e.data||e;return t}});S.SSMO.User=Backbone.Model.extend({initialize:function(){_.bindAll(this)},fetchBaseUserInfo:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.USER_BASEINFO,console.log("do fetch"),this.fetch(e)},updatePass:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.CHANGE_PASSWORD,this.fetch(e)},validate:function(e){if(_.isUndefined(e.isPostDetail)){if(!_.isUndefined(e.isPostPass)){if(e.password.length<6||e.password.length>20)return"密码长度不符（6-20位）";if(e.password.match(rConfig.user.passwordFilter))return"密码必须为字母或数字";if(e.oldPassword.length<6||e.oldPassword.length>20)return"密码长度不符（6-20位）";if(e.oldPassword.match(rConfig.user.passwordFilter))return"密码必须为字母或数字"}}else;},parse:function(e){return e.data},getSecQuestion:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.SECURITY_QUESTION,this.fetch(e)},validateAnswer:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.VALIDATE_ANSWER,this.fetch(e)},resetPassword:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.RESET_PASSWORD,this.fetch(e)},removeHistory:function(e){var t=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.DELETE_LOGIN_HISTORY,e.data);t.success?e.success.apply(this,[this,t]):(this.reset([]),e.error.apply(this,[this,t]))},updateNickname:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UPDATE_NICKNAME,this.fetch(e)},getLoginHistoryCount:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.GET_LOGIN_HISTORY_COUNT,this.fetch(e)},registerGuestAccount:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.REGISTER_GUEST,this.fetch(e)},bindGuestAccount:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.ACTIVATE_GUEST,this.fetch(e)},rechargeUPoint:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.PAYCENTER_UPOINT_AUTOLOGIN,this.fetch(e)},setAutoLoginState:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.SET_AUTO_LOGIN_STATE,this.fetch(e)},getAccountInfoByLoginName:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_ACCOUNT_INFO,this.fetch(e)}});S.SSMO.Vip=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.VIP},fetchVipInfo:function(e){this.fetch(e)},parse:function(e){return e.data}});S.SSMO.UPoint=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UPOINT_BALANCE},fetchUPoint:function(e){this.fetch(e)},parse:function(e){var t=e.data;return t}});S.SSVW.FindPassword=Backbone.View.extend({el:"#userContainer",events:{"click #sendCmccMessageBtn":"sendCmccMessage","click #sendUnicomMessageBtn":"sendUnicomMessage","onclick #validAccountBtn":"validAccount","onclick #secAnswerSubBtn":"secAnswerSubmit","onclick #newPasswordSubBtn":"newPasswordSubmit","onclick #appealSubBtn":"appealSubmit","onclick #needResetPassword":"checkedNeedResetPassword","onclick #messageRetakeBtn":"retakeMethod","onclick #secAnswerRetakeBtn":"retakeMethod","onclick #appealRetakeBtn":"retakeMethod","onclick #toAppealRetakeBtn":"toAppealRetake","onclick #toAppealRetakeByIdBtn":"toAppealRetakeByTabId","onclick #resetPassReturnGameBtn":"returnGame","onclick #accountList > .ac-item":"retakeAccount","onclick #validMsgRetakeAccBtn":"validMsgRetakeAcc"},local:{defaultTab:"messageRetake",tabs:["messageRetake","secAnswerRetake","appealRetake"]},initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","User"),this.ssoController=S.SSCT.GetHandler("Controller","Sso"),this.generalController=S.SSCT.GetHandler("Controller","General")},sendCmccMessage:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwphone_b"])},sendUnicomMessage:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwphone_b"])},secAnswerRetake:function(){},validAccount:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwquestioncode_b"]);var e=$("#ucAccount").val(),t=document.createElement("div");document.body.appendChild(t);var n=this;this.controller.getSecQuestion(e,this.controller.callBackMix(function(i){return document.body.removeChild(t),i.password_question?(sdk.PageCache.set("account_security_question",{account:e,question:i.password_question}),sdk.Url.location.route("#!findPassword/securityAnswer"),void 0):(n._showErrorMsg("获取密保问题失败"),void 0)},function(e){document.body.removeChild(t),n._showErrorMsg(e)}))},validMsgRetakeAcc:function(){var e=$("#validMsgRetakeAccInp").val(),t=this;t.controller.validMsgRetakeAccount(e,{success:function(){t.controller.getAccountInfoByLoginName(e,{success:function(e){var n=e.mobile;_.isEmpty(n)?t._showErrorMsg("该账号未绑定任何手机"):t.showMsgRetakeCon(n)},error:function(e){t._showErrorMsg(e.msg)}})},error:function(e){t._showErrorMsg(e)}})},showMsgRetakeCon:function(e){$("#bindedNumber").html(e),$("#beforeMsgRetakeCon").addClass("ms-none"),$("#msgRetakeCon").removeClass("ms-none")},securityAnswer:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5_fpwquestion_p"]);var e=sdk.PageCache.get("account_security_question");e.success&&e.data&&($("#question").html(e.data.question),$("#question").attr("data-value",e.data.question),$("#ucAccount").html(e.data.account),$("#ucAccount").attr("data-value",e.data.account))},secAnswerSubmit:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwquestion_b"]);var e=$("#securityAnswer").val(),t=$("#question").attr("data-value"),n=$("#ucAccount").attr("data-value"),i=this;this.controller.validateAnswer({ucid:parseInt(n,10),password_question:t,password_answer:e},this.controller.callBackMix(function(){sdk.PageCache.set("account_resetPassword_params",{account:n,question:t,answer:e}),sdk.Url.location.route("#!findPassword/resetPassword/"+n)},function(e){console.log(e),i._showErrorMsg(e)}))},resetPassword:function(e){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5_fpwmodifypw_p"]),$("#resetPassAccount").attr("data-value",e),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",function(){S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1})})},newPasswordSubmit:function(){var e=$("#newPassword").val(),t=$("#resetPassAccount").attr("data-value"),n=sdk.PageCache.get("account_resetPassword_params"),i=this;if(n.success&&n.data){var o=n.data;this.controller.resetPassword({ucid:parseInt(t,10),password_question:o.question,password_answer:o.answer,password:e},this.controller.callBackMix(function(){$("body").addClass("btnClick-none"),$("#successBox").removeClass("ms-none")},function(e){i._showErrorMsg(e)}))}},appealSubmit:function(){var e=$("#server").val(),t=$("#contact").val(),n="checked"===$("#needResetPassword").attr("data-checked")?!0:!1;console.log("server : ["+e+"]  contact : ["+t+"] reset : ["+n+"]")},appealSuccess:function(){},passwordRetake:function(e){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["forgetPassword"]),$("#chooseTab").on("click",function(e){var t=e.target;$(t).css("boxShadow","none")});var t;if(S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"backToLogin"==e.action&&(S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),t=!0,S.Url.location.route("#!sso/login"),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.CLEAR_HISTORY))}}),t!==!0){var n=rConfig.ACCOUNT_TYPE.UC,i=this.tabType||e||this.local.defaultTab;this.showRetakePageByTab(i);var o=this;this.ssoController.getServerHistory(n,this.ssoController.callBackMix(function(e){var t="";e.length>0?($("#accountList").removeClass("ms-none"),$("#hasAccount").html("曾在本机登录过的UC账号："),_.each(e,function(e){var n="";e.loginTime&&(n=e.loginTime),t+='<div class="ac-item" data-account='+e.ucid+" data-password="+e.password+">"+'<em class="em_arrow">&nbsp;</em>UC账号：'+e.ucid+"<br />最近登录时间："+n+"</div>"}),$("#accountList").html(t)):$("#hasAccount").html("！没有在本机登录过UC账号")},function(e){o._showErrorMsg(e)})),sdkInfo=S.sdkBase.sdkInfo(),$("#clientVersion").html("客户端版本号："+sdkInfo.ve)}},getInfoByAccount:function(e){if(!e)return null;var t=null;return _.each(this.ssoController.getServerHistories(rConfig.ACCOUNT_TYPE.UC),function(n){n.account==e&&(t=n)}),t},retakeMethod:function(e){var t=e.target,n=$(t).attr("data-retake");n&&this.showRetakePageByTab(n)},showRetakePageByTab:function(e){this.tabType=e;var t=this.local.tabs;_.each(t,function(t){t!==e&&($("#"+t).addClass("ms-none"),$("."+t).parent().removeClass("on"))}),$("#"+e).removeClass("ms-none"),$("."+e).parent().addClass("on")},checkedNeedResetPassword:function(){var e=$("#needResetPassword");"checked"===e.attr("data-checked")?(e.attr("data-checked",""),e.removeClass("cbbg")):(e.attr("data-checked","checked"),e.addClass("cbbg"))},toAppealRetake:function(){this.tabType="appealRetake",sdk.Url.location.route("#!findPassword/passwordRetake/appealRetake")},toAppealRetakeByTabId:function(){this.showRetakePageByTab("appealRetake")},retakeAccount:function(e){if($(e.target).hasClass("ac-item")){var t=$(e.target).attr("data-account");$(e.target).attr("data-password"),this._jumtoLogin(t)}},_jumtoLogin:function(e){!S.global.ui||S.global.ui===rConfig.SDK_UI.STANDARD||S.global.versionCompare(S.global.version,rConfig.VERSIONS.LOGIN_WIDGET_VERSION)<0?(console.log("Redirect to H5 login"),sdk.Url.location.route("#!sso/login/"+e)):S.global.ui===rConfig.SDK_UI.LOGIN_WIDGET&&(console.log("Jumto to login widget"),this.generalController.jumpToLoginWidget({uiBusiness:"loginWidget",data:{ucid:e}},{success:function(){},error:function(){sdk.Url.location.route("#!sso/login/"+e)}}))},returnGame:function(){var e=$("#newPassword").val(),t=$("#resetPassAccount").attr("data-value");sdk.PageCache.set("auto_login_info",{account:t,password:e,securityType:0}),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),this._jumtoLogin(t),this.generalController.clearHistory()},_showErrorMsg:function(e){this.generalController.sendClientMsg(e)},flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||sdk.common.ui.NoticeBox.hide(this.noticeBar,null,"slide")}});S.SSVW.Register=Backbone.View.extend({el:"#userContainer",events:{"onclick #newPassword":"flushInpt","onclick #regReturnGameBtn":"returnGame","onclick #modifyPassMask":"closeModifyPassword","onclick #cancelModifyBtn":"closeModifyPassword","onclick #doModifyBtn":"doModifyPassword","onclick #regBindBtn":"gotoBind"},isOpenModifyWindow:!1,initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","User"),this.generalController=S.SSCT.GetHandler("Controller","General"),this.ssoController=S.SSCT.GetHandler("Controller","Sso")},regSuccess:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["registerSuccess"]});var e=this;this.controller.getRegData(this.controller.callBackMix(function(t){e.ssoController.updateLoginCount(t.ucid);var n=e.generalController.getCacheData("user_info_"+t.ucid);n&&!1===n.random&&$("#passwordName").html("密码:"),$("#regTitle").html("成功注册UC账号"),$("#regMsg1").html("UC账号："+t.ucid),$("#regUcAccount").attr("data-account",t.ucid).html(t.ucid),$("#regPassword").attr("data-password",t.password).html(t.password)},function(){sdk.Url.back()}))},modifyPassword:function(){function e(){var e=parseInt($(window).height()),t=parseInt($(document).height());return e>t?e:t}sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signmodifypw_b"]);var t=this;$("#newPassword").val(""),$("#modifyPassMask").height(e()),$(window).on("resize",function(){$("#modifyPassMask").height(e())}),this.hideFeedBack(),$("body").addClass("btnClick-none"),$("#modifyPassWin").removeClass("ms-none"),this.isOpenModifyWindow=!0,S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",t.closeModifyPassword)},closeModifyPassword:function(){this.isOpenModifyWindow&&($("#modifyPassWin").addClass("ms-none"),$(".btnClick-none").removeClass("btnClick-none"),$("body").removeClass("btnClick-none"),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),document.removeEventListener("backbutton",this.closeModifyPassword),$(window).off("resize"))},doModifyPassword:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signmodifypwok_b"]);var e=$("#newPassword").val(),t={isPostPass:!0,oldPassword:$("#regPassword").html(),password:e},n=this;this.controller.registerUpdatePass(t,this.controller.callBackMix(function(){n.generalController.sendClientMsg("修改成功"),$("#passwordName").html("密码:"),$("#regPassword").html(e),n.closeModifyPassword()},function(e){n.generalController.sendClientMsg(e)}))},returnGame:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signgame_b"]);var e=this;this.controller.getRegData(this.controller.callBackMix(function(t){var n=ucf.Cache.get("openTestGame_"+t.ucid,!0),i=ucf.Cache.get("isAlpha_"+t.ucid,!0);return n&&n.status&&"B"==n.status?(sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(n.message)),void 0):i?(sdk.Url.redirect("../game/game.html#!game/validCode/false"),void 0):(e.controller.sdkExit(),void 0)},function(){sdk.Url.back()}))},gotoBind:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signbindphone_b"]),S.Url.location.route("#!secrecy/preBind/signpage")},gotoAgreement:function(){S.Url.location.route("#!user/agreement")},flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val("")},_showLoading:function(){var e=S.common.ui.NoticeBox.loading();return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},hideFeedBack:function(){$("input").addClass("btnClick-none")}});S.SSVW.Secrecy=Backbone.View.extend({el:"#userContainer",controller:null,config:{btnLockTime:59,questionList:["我曾就读的小学校名？","刻骨铭心的6位数字？","我的心愿是？","我的爱好是？","最难忘那年那月那日？","最喜欢的一句话是？","我最关注的是什么？","最想要的物品名称？"],sourcePage:{USER:"usercenter",BIND:"ucidbindpage",REGISTER:"signpage",LOGIN:"loginpage"}},events:{"onclick #mobile, #validCode, #bindPass":"_flushInpt","onclick #toBindPageBtn":"toBindPage","onclick #doBindBtn":"doBind","onclick #resendBtn":"reSendMsg","onclick #cancelIbbBtn":"cancelIbb","onclick #keepBindBtn":"keepBind","onclick #toGameBtn":"doBindSuccess","onclick #toSetQuestionsBtn":"toSetQuestions","change  #questionList":"selQuestion","onclick #saveSecurityBtn":"saveSecurityQuestions","input #bindPass":"hideRandomPassNotice","onclick #bindPhoneTabBtn, #setQuestionTabBtn":"setBindTabHandle","onclick #pGotoSecCenterBtn,#qGotoSecCenterBtn":"redirectBtnHandle","onclick #changeNumberBtn":"changeNumberHandle"},initialize:function(){_.bindAll(this),this.controller=this.controller?this.controller:S.SSCT.GetHandler("Controller","AccountManage"),this.generalController=S.SSCT.GetHandler("Controller","General")},toBindPage:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphonecode_b",this.enterType]),this.hideFeedBack("#toBindPageBtn");var e=$("#mobile").val(),t={mobile:e},n=this._showLoading(),i=this;this.controller.checkIsBinded(t,this.controller.callBackMix(function(e){i._hideLoading(n);var t=S.SSCT.GetHandler("Controller","General");t.setCacheData("mobile",$("#mobile").val(),10800,!0),null!==e.ucid?(i.beforeBoxShowed(),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",function(){i.cancelIbb()}),i._showBindBox()):i.setRouteType("#!secrecy/bind")},function(e){i._hideLoading(n),i._showErrorMsg(e),console.log("checkIsBinded error : "+e)}))},_showBindBox:function(){this._hideLinkEffect(["cancelIbbBtn","keepBindBtn"],$("#bindPhoneCnt")[0]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphonebind_w"]),$("body").addClass("btnClick-none");var e=$("#isBindBox");e.css("display","block")},doBind:function(){this.hideFeedBack("#doBindBtn");var e={code:$("#validCode").val(),password:$("#bindPass").val()},t=this._showLoading(),n=this;this.controller.doBindMobile(e,this.controller.callBackMix(function(){n._hideLoading(t),n.beforeBoxShowed();var e=S.SSCT.GetHandler("Controller","General"),i=n.getUserInfo().ucid,o=e.getCacheData("mobile",!0);n._showBindSuccessBox({ucid:i,mobile:o})},function(e){n._hideLoading(t),101==e.code&&$("#bindPass").val(""),n._showErrorMsg(e.msg)}))},_showBindSuccessBox:function(e){this._hideLinkEffect("toGameBtn",$("#bindPhoneCnt")[0]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphoneok_w",this.enterType]),$("#bindSuccessNoti").html("<p>UC账号：<em>"+e.ucid+"</em><br>绑定手机号：<em>"+e.mobile+"</em></p>"),$("#bindSuccTitle").html("您已绑定成功！"),$("#toGameBtn").data("step","changePhone"),$("body").addClass("btnClick-none"),$("#bindPopBox").removeClass("ms-none"),this.enterType===this.config.sourcePage.USER?$("#toGameBtn").html("完成"):$("#toGameBtn").html("进入游戏")},reSendMsg:function(){$("#resendBtn").hasClass("clickAble")&&this.sendMsg()},cancelIbb:function(){S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),sdk.EC.showInput(),this.hideFeedBack("#cancelIbbBtn");var e=this;setTimeout(function(){e.addFeedBack("#cancelIbbBtn")},500),this.addFeedBack("#toBindPageBtn");var t=$("#isBindBox")[0];t.style.display="none",$("body").removeClass("btnClick-none")},keepBind:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphonebind_b"]),this.cancelIbb(),S.SSCT.GetHandler("Controller","General"),this.setRouteType("#!secrecy/bind")},doBindSuccess:function(e){var t=$(e.target),n=t.data("step"),i=this;this.hideFeedBack("#toGameBtn"),setTimeout(function(){i.addFeedBack("#toGameBtn")},500),this.addFeedBack("#doBindBtn"),$("#bindPopBox").addClass("ms-none"),$("body").removeClass("btnClick-none"),"changePhone"===n?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphoneok_game_b",this.enterType]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsquestion_game_b",this.enterType]),this.enterType===this.config.sourcePage.USER?(S.Url.location.route("#!user"),this.generalController.clearHistory()):this.toGame()},toSetQuestions:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsquestion_l"]),this.setRouteType("#!secrecy/securityQuestions")},selQuestion:function(){var e=document.querySelector("#questionList"),t=e.options[e.selectedIndex],n=t.value;"-1"!=n&&""!=n&&("0"==n?$("#passwordQuestion").val(""):$("#passwordQuestion").val(n))},saveSecurityQuestions:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_submitQuestion_b",,this.enterType]),this.hideFeedBack("#saveSecurityBtn");var e={password_question:$("#passwordQuestion").val(),password_answer:$("#passwordAnswer").val(),password:$("#questionPass").val()},t=this._showLoading(),n=this;this.controller.doSaveSecurityQuestions(e,this.controller.callBackMix(function(){n._hideLoading(t),n.beforeBoxShowed();var e=n.getUserInfo().ucid;n._showQuestionBindSuccessBox({ucid:e})},function(e){n._hideLoading(t),101==e.code&&$("#questionPass").val(""),n._showErrorMsg(e.msg)}))},_showQuestionBindSuccessBox:function(e){this._hideLinkEffect("toGameBtn",$("#setQuestionCnt")[0]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsquestion_w",this.enterType]),$("#bindSuccessNoti").html("<p>UC账号<em>"+e.ucid+"</span>已成功设置密保问题。</em></p>"),$("#bindSuccTitle").html("您已设置成功！"),$("#toGameBtn").data("step","changeQuestion"),$("body").addClass("btnClick-none"),$("#bindPopBox").removeClass("ms-none"),this.enterType===this.config.sourcePage.USER?$("#toGameBtn").html("完成"):$("#toGameBtn").html("进入游戏")},_initPopbox:function(){$("#bindPopBox").length<=0&&this.$el.append($("#bindPopBoxTempl").html())},initBackBtnEvent:function(){var e=this;S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(t){"sdBackGame"==t.action&&e.toGame(),"backToUsercenter"==t.action&&(e._isStop=!0,e._retryLoadingElem&&(e._hideLoading(e._retryLoadingElem),e._retryLoadingElem=null),S.Url.back())}})},toGame:function(){var e=this.getUserInfo().ucid,t=ucf.Cache.get("openTestGame_"+e,!0),n=ucf.Cache.get("isAlpha_"+e,!0);t&&t.status&&"B"==t.status?sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(t.message)):n?sdk.Url.redirect("../game/game.html#!game/validCode/false"):(S.Log.pageClose(),S.SSCT.GetHandler("Controller","User").sdkExit())},changeBindingHandle:function(e){var t=this.getUserInfo().ucid,n=S.SSCT.GetHandler("Controller","General"),i=n.getCacheData("mobile",!0);$("body").removeClass("btnClick-none"),$("#bindPopBox").addClass("ms-none"),sdk.EC.showInput(),this.setRouteType("#!secrecy/bindingChange/phone"),this.setRouteType("#!secrecy/bindingChange/question"),"changePhone"===e?(this._renderPhoneBindSuccess(t,i),this._renderGotoQuestionBinding()):"changeQuestion"===e&&(this._renderQuestionBindSuccess(t),this._renderGotoPhoneBinding())},_renderPhoneBindSuccess:function(e,t){$("#pBindChangeInfo").html("<b>UC账号："+e+"</b><br /><b>已绑定手机号码："+t+"</b>"),$("#pBingChangeNoti").html('<h6 class="f-gray">您已绑定手机，可通过手机号找回账号、密码，还可直接使用手机号登录游戏。</h6><p class="p_fs f14">如需修改手机号，请前往账户中心设置。</p>'),$("#pGotoSecCenterBtn").data("type","updateMobile")},_renderGotoPhoneBinding:function(){$("#pBindChangeInfo").addClass("ms-none"),$("#pBingChangeNoti").html('<h6 class="f-gray">如需继续提高账号安全，可前往账户中心，把您的UC账号和手机进行绑定。</h6>'),$("#pGotoSecCenterBtn").html("绑定手机号码").data("type","setMobile")},_renderQuestionBindSuccess:function(e){$("#qBingChangeNoti").html('<h6 class="f-gray">您已为UC账号 <em>'+e+"</em>  设置密保问题，忘记密码时可通过此方式找回密码。</h6>"+'<p class="p_fs f14">如需修改密保问题，请前往账户中心设置。</p>'),$("#qGotoSecCenterBtn").data("type","updateQuestion")},_renderGotoQuestionBinding:function(){$("#qBingChangeNoti").html('<h6 class="f-gray">如需继续提高账号安全，可前往账户中心，为您的UC账号设置密保问题。</h6>'),$("#qGotoSecCenterBtn").html("设置密保问题").data("type","setQuestion")},_renderBindingFail:function(){this.$el.html($("#screcyPageTempl").html()),$("#secrecy_con").html('<section class="ui-maincontainer"><center class="gr-mt20"><h6 class="f-gray">暂时无法获取您的账号安全情况<h6></center></section>')},setPageState:function(e,t){var n,i;if(ucid=this.getUserInfo().ucid,"mobile"===e||"question"===e||"both"===e)switch(this.$el.html(template.render("screcyPageTempl")),n=$("#bindPhoneCnt"),i=$("#setQuestionCnt"),e){case"mobile":n.html(template.render("phoneBindingChangeTempl")),i.html(template.render("questionBindingChangeTempl")),this._renderPhoneBindSuccess(ucid,t),this._renderGotoQuestionBinding();break;case"question":n.html(template.render("phoneBindingChangeTempl")),i.html(template.render("questionBindingChangeTempl")),this._renderGotoPhoneBinding(),this._renderQuestionBindSuccess(ucid);break;case"both":n.html(template.render("phoneBindingChangeTempl")),i.html(template.render("questionBindingChangeTempl")),this._renderPhoneBindSuccess(ucid,t),this._renderQuestionBindSuccess(ucid);break;case"none":}},setBindTabHandle:function(e){var t=$(e.target),n=t.data("type");n&&this.setBindTab(n)},redirectBtnHandle:function(e){var t,n=$(e.target).data("type");if(n){switch(n){case"setQuestion":t=eConfig.setQuestion;break;case"setMobile":t=eConfig.setMobile;break;case"updateQuestion":t=eConfig.updateQuestion;break;case"updateMobile":t=eConfig.updateMobile}t&&(this.businessLoging(n),sdk.Url.redirect(t))}},businessLoging:function(e){var t;if(e){switch(e){case"setMobile":t=["h5_pwsphone_open_b"];break;case"updateMobile":t=["h5_resetPhoneNum_b"];break;case"setQuestion":t=["h5_pwsquestion_open_b"];break;case"updateQuestion":t=["h5_resetQuestion_b"]}t&&sdk.Log.click(sdk.Log.businesses.PAGE_USER,t)}},setBindTab:function(e){function t(){i.parent().addClass("on"),s.removeClass("ms-none").addClass("pagefocus"),o.parent().removeClass("on"),r.addClass("ms-none").removeClass("pagefocus")}function n(){i.parent().removeClass("on"),s.addClass("ms-none").removeClass("pagefocus"),o.parent().addClass("on"),r.removeClass("ms-none").addClass("pagefocus")}var i=$("#bindPhoneTabBtn"),o=$("#setQuestionTabBtn"),s=$("#bindPhoneCnt"),r=$("#setQuestionCnt");switch(this._bindTabType=e,e){case"question":n(),this._pageType="question";break;case"mobile":t(),this._pageType="mobile"}var a=$(".pagefocus .tabPage",this.el);if($(".pagefocus .tabPage",this.el).length>0){var c;switch(a.data("page")){case"bind":c=["bind"];break;case"preBind":c=["preBind",this.enterType];break;case"question":c=["preBind_question",this.enterType]}c&&(S.Log.pageClose(),S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:c}))}},_getSecStateRetry:function(e){function t(){return i._isStop?(i._isStop=!1,i._hideLoading(o),void 0):(n.getSecureStateDetail(["mobile","question"],n.callBackMix(function(t){if(1===t.mobile.code&&(1===t.question.code||126===t.question.code)){var n;return _.isEmpty(t.mobile.mobile)&&_.isEmpty(t.question.password_question)?n="none":_.isEmpty(t.mobile.mobile)||_.isEmpty(t.question.password_question)?_.isEmpty(t.question.password_question)?_.isEmpty(t.mobile.mobile)||(n="mobile"):n="question":n="both",i._hideLoading(o),e.success&&e.success(n,t),void 0}i._hideLoading(o),e.error&&e.error()},function(){i._hideLoading(o),e.error&&e.error()})),void 0)}var n=S.SSCT.GetHandler("Controller","AccountManage"),i=this,o=i._showLoading();i._retryLoadingElem=o,t.call(this)},_showLoading:function(){var e=S.common.ui.NoticeBox.loading();return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},preBind:function(e,t){function n(t,n,i){this.enterType=e,"usercenter"===this.enterType&&this.setPageState(t,n),this.preBindRender(e)}S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["preBind",e]});var i=sdk.PageCache.get("risk"),o=sdk.PageCache.get("secrecy_binding_mobile"),s=this,r=i.success?i.data:void 0,t=t||"mobile";sdk.PageCache.del("risk"),sdk.PageCache.del("secrecy_binding_mobile"),this._isStop=!1,"usercenter"!==e||i.success&&i.data&&"fail"!==i.data?($("#preBindCon").removeClass("ms-none"),n.call(this,r,o&&o.success?o.data:"",t)):this._getSecStateRetry({success:function(e,i){$("#preBindCon").removeClass("ms-none"),n.call(s,e,i.mobile.mobile,t)},error:function(){$("#preBindCon").removeClass("ms-none"),s._renderBindingFail()}}),this.initBackBtnEvent()},preBindRender:function(e){var t=$("#bindNoticeMsg");"pwFalse"==e?t.html("我们发现您曾经出现密码错误，为了让您在忘记密码后能顺利找回，建议："):"paid"==e?t.html("您已完成支付，如果丢失账号、密码，则可能造成损失，因此我们强烈建议您："):"loginpage"==e?t.html("您已多次使用本账号进行游戏，为避免丢失账号、密码后可能造成的损失，建议："):"usercenter"==e&&t.html("数据显示，80%以上丢账号未能及时找回的玩家，都是因为未绑定手机所致。"),_.isUndefined($("#mobile").val())||""==$("#mobile").val()||$("#mobile").val("")},bind:function(){S.Log.pageClose(),S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["bind"]});var e=S.SSCT.GetHandler("Controller","General"),t=e.getCacheData("mobile",!0),n=this.getUserInfo().ucid;if(_.isUndefined($("#validCode").val())||""==$("#validCode").val()||$("#validCode").val(""),_.isUndefined($("#bindPass").val())||""==$("#bindPass").val()||$("#bindPass").val(""),this.getUserInfo().isRandomPassword)$("#bindPass").val(this.getUserInfo().randomPassword),this.showRandomPassNotice();else{var i=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+n,!0);i&&i.random&&($("#bindPass").val(i.password),this.showRandomPassNotice())}this._initPopbox.call(this),$("#bindInfo").html(template.render("bindingInfoTempl",{ucid:n,mobile:t})),this.sendMsg()},securityQuestions:function(e){this.enterType=e,S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["preBind_question",this.enterType]});var t=this.getUserInfo().ucid;if("usercenter"===e?$("#setQuestionNoti").html("设置密保问题后，忘记密码可通过此方式找回密码。"):$("#setQuestionNoti").html("您还可以设置密保问题，忘记密码时，可通过此方式找回。"),this.initQuestionList(),this._initPopbox.call(this),$("#passwordQuestion").val(this.config.questionList[0]),_.isUndefined($("#passwordAnswer").val())||""==$("#passwordAnswer").val()||$("#passwordAnswer").val(""),this.getUserInfo().isRandomPassword)$("#questionPass").val(this.getUserInfo().randomPassword);else{var n=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+t,!0);n&&n.random&&$("#questionPass").val(n.password)}},sendMsg:function(){this.btnCountDown();var e=S.SSCT.GetHandler("Controller","General"),t=e.getCacheData("mobile",!0),n={mobile:t},i=this;this.controller.sendCode2Mobile(n,this.controller.callBackMix(null,function(e){i.cancelBtnCountDown(),i._showErrorMsg("发送验证码失败: "+e)}))},cancelTgb:function(){sdk.EC.showInput(),$("body").removeClass("btnClick-none");var e=$("#toGameBox")[0];e.style.display="none"},btnCountDown:function(){"undefined"!=typeof secrecyTimeId&&null!=secrecyTimeId&&(clearInterval(secrecyTimeId),secrecyTimeId=null);var e=this.config.btnLockTime,t=this;$("#resendBtn").val(e+" 重新获取"),$("#resendBtn").removeClass("clickAble"),secrecyTimeId=setInterval(function(){--e<0?t.cancelBtnCountDown():$("#resendBtn").val(e+" 重新获取")},1e3)},cancelBtnCountDown:function(){clearInterval(secrecyTimeId),secrecyTimeId=null,$("#resendBtn").val("重新获取"),$("#resendBtn").addClass("clickAble")},_flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),this._hideErrorMsg()},getUserInfo:function(){var e=e?e:S.SSCT.GetHandler("Controller","User"),t=this,n=e.getCurUser();return(_.isEmpty(n)||n=={})&&e.getCurUserInfo(e.callBackMix(function(e){n=e},function(){t._showErrorMsg("获取用户信息失败")})),n},initQuestionList:function(){var e='<option value="-1">请选择密保问题</option>';this.config.questionList.map(function(t){e+="<option value="+t+">"+t+"</option>"}),e+='<option value="0">自定义问题</option>',$("#questionList").html(e)},beforeBoxShowed:function(){$("#modifyPassMask").height($(window).height()+150),$(window).on("resize",function(){$("#modifyPassMask").height($(window).height()+150)}),_.delay(function(){sdk.EC.hideInput()},50)},changeNumberHandle:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_changeNum_b"]),this.setRouteType("#!secrecy/preBind")},setRouteType:function(e){var t=this.enterType||"";$("#bindPhoneCnt"),$("#setQuestionCnt"),S.Url.location.route(e+"/"+t)},_showErrorMsg:function(e){var t=S.SSCT.GetHandler("Controller","General");t.sendClientMsg(e)},_hideErrorMsg:function(e){e=_.isUndefined(e)||_.isEmpty(e)?"slide":e,_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||("remove"==e?S.common.ui.NoticeBox.hide(this.noticeBar,null,"remove"):S.common.ui.NoticeBox.hide(this.noticeBar,null,"slide"))},_showLoading:function(){var e=S.common.ui.NoticeBox.loading();return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},hideFeedBack:function(e){$(e).addClass("btnClick-none")},addFeedBack:function(e){$(e).removeClass("btnClick-none")},hideRandomPassNotice:function(){$("#randomPassNotice").addClass("ms-vshid")},showRandomPassNotice:function(){$("#randomPassNotice").removeClass("ms-vshid")}});S.SSVW.Sso=Backbone.View.extend({el:"#userContainer",events:{"onclick #username,#password":"_flushInpt","onclick #newPassword":"_flushInpt","onclick #loginBut":"loginSubmit","onclick #registerBut":"register","onclick #forgetPassBtn":"forgetPassword","onclick #mobileBindingBtn":"bindMobile","onclick #registerReturnGameBtn":"returnGameAndLogin","onclick #gameLoginReturnGameBtn":"returnGameAndLogin","onclick #gameLoginBtn":"gotoGameLogin","onclick #backBtn":"goBack","onclick #modifyAndLoginBtn":"loginPageModifyAndLogin","onclick #forceModifyAndLoginBtn":"forceModifyAndLogin","onclick #bindModifyAndLoginBtn":"bindModifyAndLogin","onclick #useUCAccountLogin":"useUCAccountLogin","onclick #isNerverNotice":"checkNerverNotice","change #loginHistory":"selectHis","onclick #updatePassBtn":"_setUpdatePassParam","onclick #cancelLogin":"cancelUCAccountLogin","onclick #neverUpdateBtn":"neverUpdatePass","onclick #cancelModify":"cancelModify","onclick #agreementBtn":"gotoAgreement","onclick #loginHistory":"logHist","onclick #closeNotice":"closeNotice","onclick #noticeBtn":"showNotice","onclick #modifyPassBtn":"modifyPassword","onclick #regSuccessContent":"hideModify","onclick #checkboxArea":"setAccAutoLogin"},showHistoryFlag:!1,accountType:0,historyScroll:null,regReturn:!1,randomPwd:!0,noticeId:"",model:{},resp:{},loginHist:[],loginCount:0,localConfig:{HISTORY_LIST_MAX_SIZE:10,LOGIN_COUNT:15,CANCEL_LOGIN_CODE:109,SECURITY_TYPE:{UNSECURITY:0,SECURITY:1}},loginLoadingEl:{},initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","Sso"),this.userController=S.SSCT.GetHandler("Controller","User"),this.generalController=S.SSCT.GetHandler("Controller","General"),this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.LOGIN;var e=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);e!==!1&&e>=0?$("body").data("ctrl","true"):$("body").data("ctrl","")},closeNotice:function(){setTimeout($.proxy(function(){$("body").removeClass("btnClick-none"),this.$el.find("#notice").addClass("ms-ni"),this._showLinkEffect()},this),300)},showNotice:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_LoginNotice_l",this.noticeId]),$("body").addClass("btnClick-none"),this.$el.find("#notice").removeClass("ms-ni"),this._hideLinkEffect("closeNotice")},login:function(e){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["sso"]});var t=e,n=sdk.PageCache.get("auto_login_info");sdk.PageCache.del("auto_login_info"),this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.LOGIN,this.controller.clearHistFlag();var o=this.controller.getLoginConfig(),s=o.allowGameLogin,i=o.gameAccountTitle,r=o.isAutoLogin;r===!1?$("#iconCheckbox").removeClass("on"):$("#iconCheckbox").addClass("on"),i=_.isUndefined(i)||null===i||0===i.length?rConfig.user.defaultGameName:i;var a=ucf.Cache.get("game_notice",!0)||{};_.isUndefined(a.content)||(this.$el.find("#noticeBtn").html(a.content),this.$el.find("#noticeBtn").removeClass("gr-vshid"),this.$el.find("#noticeTtl").html(a.content),this.$el.find("#noticeWrapper").html(a.contentDetail),this.noticeId=a.msgId,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_LoginNotice_p",a.msgId]));var c=this;this.controller.getGameNotice({success:function(e){_.isUndefined(e)||(_.isUndefined(a.content)||0==parseInt(e.priority))&&(c.$el.find("#noticeBtn").html(e.content),c.$el.find("#noticeBtn").removeClass("gr-vshid"),c.$el.find("#noticeTtl").html(e.content),c.$el.find("#noticeWrapper").html(e.contentDetail),c.noticeId=e.msgId,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_LoginNotice_p",e.msgId]))},error:function(){}}),$("#gameLoginBtn").html(i+"老账号登录"),$("#showHistory").removeClass("ms-ni"),s===!0&&$("#gameLoginBtn").removeClass("ms-none"),this.versionFixing(),$("body").removeClass("btnClick-none"),$("#username").attr("placeholder","UC账号\\手机"),$("#registerBut").val("一键注册").data("type","login"),$("#forgetPassBtn").removeClass("ms-ni"),$("#gameLoginBottom").addClass("ms-ni"),$("#normalLoginBottom").removeClass("ms-ni"),n&&n.success&&n.data?this._setHistory(n.data.account,n.data.password,n.data.securityType):t?this._setHistory(t):this._setHistory(),this._restoreRegSuccWin()},gameLogin:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["oldAccountLogin"]}),this.versionFixing();var e=this.controller.getLoginConfig(),t=e.isAutoLogin;t===!1?$("#iconCheckbox").removeClass("on"):$("#iconCheckbox").addClass("on");var n=e.gameAccountTitle;n=_.isUndefined(n)||null===n||0===n.length?rConfig.user.defaultGameName:n,this.setUsername(""),this.setPassword(""),$("body").removeClass("btnClick-none"),this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,$("#loginTitleTabs").html('<a class="item">'+n+'老账号</a><p class="btnBox"><a href="javascript:;" id="backBtn" class="fl btn btn_dark back_btn">UC账号</a></p>'),$("#username").attr("placeholder",n),$("#registerBut").val("注册UC账号").data("type","gameLogin"),$("#forgetPassBtn").addClass("ms-ni"),this._setHistory(),$("#normalLoginBottom").addClass("ms-ni"),$("#gameLoginBottom").removeClass("ms-ni"),$("#showHistory").addClass("ms-ni");var o=sdk.PageCache.get("login_param");if(o.success&&o.data){var s=o.data.account,i=o.data.password,r=o.data.randomPassword;r?this._setRegSuccPopup(s,r,!0,!1):this._setRegSuccPopup(s,i,!0,!0)}this._restoreRegSuccWin()},versionFixing:function(){var e=S.global.versionCompare(S.global.version,rConfig.VERSIONS.AUTO_LOGIN_VERSION);e!==!1&&e>=0?$("#checkboxArea").removeClass("ms-ni"):$("#checkboxArea").addClass("ms-ni");var t=S.global.versionCompare(S.global.version,rConfig.VERSIONS.LOGIN_WIDGET_VERSION);t!==!1&&t>=0?($("#agreementLinkCon").addClass("ms-none"),$("#regAgree").removeClass("ms-none"),$("#registerReturnGameBtn").val("立即登录"),$("#gameLoginReturnGameBtn").val("立即登录")):($("#agreementLinkCon").removeClass("ms-none"),$("#regAgree").addClass("ms-none"),$("#registerReturnGameBtn").val("进入游戏"),$("#gameLoginReturnGameBtn").val("进入游戏"))},loginSubmit:function(){this.accountType===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidlogin_b"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_login_b"]);var e=this,t="您正在登录的UC账号已与游戏账号绑定，角色信息完全一样",n=this.accountType,o=this.$el.find("#username").val(),s=this.$el.find("#password").getInp(),i=this.$el.find("#password").isModify(),r=this.$el.find("#iconCheckbox").hasClass("on"),a=i?this.localConfig.SECURITY_TYPE.UNSECURITY:this.localConfig.SECURITY_TYPE.SECURITY,c=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION),l=!1;this.accountType===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN&&(t="您正在使用UC账号登录，此账号还能在所有UC和九游产品中使用"),l=c!==!1&&c>=0&&a===this.localConfig.SECURITY_TYPE.SECURITY?!0:!1,this.controller.validLoginData(o,s,n,{isSecurity:l},this.controller.callBackMix(function(o,s){e.loginLoadingEl=e._showLoading(t),e.controller.loginSubmit({account:o,password:s,accountType:n,rememberPassword:!0,isAutoLogin:r,securityType:a},!0,e.controller.callBackMix(function(t,i){var r,a,c;ucf.Cache.set("openTestGame_"+t.get("ucid"),t.get("openTestGame"),86400,!0),ucf.Cache.set("isAlpha_"+t.get("ucid"),t.get("isAlpha"),86400,!0),$("input").addClass("btnClick-none"),e.userController.getCurUserInfo(e.userController.callBackMix(function(t){c=t,r=t.ucid,a=e.generalController.getCacheData("user_info_"+t.ucid,!0);var n=t.password||t.randomPassword;a&&a.random&&n!=a.password&&e.generalController.setCacheData("user_info_"+t.ucid,{random:!1},0,!0)}));var l=ucf.Cache.get("wrong_password_ucids",!0);if(r&&l&&l[o])return delete l[o],ucf.Cache.set("wrong_password_ucids",l,0,!0),e.controller.updateLoginCount(o),e.toSecrecyPage(n,o,function(){e.doLoginSuccess(t,i)},1,e.loginLoadingEl),void 0;var u,d=!0,h=e.controller.getLoginCount(r);if(e.loginCount=h,a=e.generalController.getCacheData("user_info_"+r,!0),a&&(c.isRandomPassword=a.random,c.randomPassword=c.isRandomPassword?a.password:c.randomPassword),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_i"]),n==e.controller.CONFIG.ACCOUNT_TYPE.LOGIN&&!0===c.isRandomPassword)e._hideLoading(e.loginLoadingEl),e.controller.updateLoginCount(c.ucid),3>=h?e.doLoginCheck(n,o):e._showUpdateRandomPassBox({accountType:n,account:c.ucid,randomPassword:c.randomPassword,isUCLogin:!0});else if(a||(isNaN(s)||8!=s.toString().length)&&(11!=s.toString().length||"UCX"!=s.substr(0,3)||isNaN(s.substr(3,s.toString().length-3))))e.doLoginSuccess(t,i);else{sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_speciallyPw"]);var f,p,g=e.loginHist,m=g.length;if(0!==m&&!_.isUndefined(g[0]))for(var S=0;m>S;S++)if(f=g[S],f.account==o){p=f.lastLoginTime;var y=(new Date).valueOf();u=(parseInt(y)-parseInt(p))/864e5,2>u&&(d=!1);break}u&&d?(e._hideLoading(e.loginLoadingEl),e.model=t,e.resp=i,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_overtimePw_w"]),e._showPopBox(template.render("forceUpdateRandomPassBoxTempl"),function(){$("#updateHint").html("您已"+Math.floor(u)+"天未登陆本账号，为了您的账号安全，请重新输入密码"),$("#updateHint").attr("account",o),$("#updateHint").attr("accountType",n),$("#updateHint").attr("password",s)})):e.doLoginSuccess(t,i)}},function(t,n){if(e._hideLoading(e.loginLoadingEl),e._showErrorMsg(n.msg),101==n.code){e.$el.find("#password").setInp("");var o=ucf.Cache.get("wrong_password_ucids",!0)||{},s=t.get("account");o[s]=1,ucf.Cache.set("wrong_password_ucids",o,0,!0)}}))},function(t){if(105==t.code||102==t.code){e.$el.find("#password").setInp("");var n=ucf.Cache.get("wrong_password_ucids",!0)||{},o=e.$el.find("#username").val();n[o]=1,ucf.Cache.set("wrong_password_ucids",n,0,!0)}e._showErrorMsg(t.msg)}))},doLoginSuccess:function(e){var t=e.get("account"),n=e.get("password"),o=e.get("accountType");e.get("rememberPassword");var s=this,i={};this.userController.getCurUserInfo(this.userController.callBackMix(function(e){i=e},function(){s.userController.sdkExit()}));var r=this.generalController.getCacheData("user_info_"+i.ucid,!0);r&&(i.isRandomPassword=r.random,i.randomPassword=i.isRandomPassword?r.password:i.randomPassword);var a=!(!1===i.isRandomPassword||0===i.randomPassword.length),c=ucf.Cache.get("login_binding_info",!0)||{};if(o===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN&&c[t]!==!0){console.log("游戏账号未绑定UC账号(如果非随机密码就表示已经绑定)"),c[t]=!0,ucf.Cache.set("login_binding_info",c,0,!0);var l=i.ucid,u=i.randomPassword;a?this.controller.validSecrecy(o,t,this.controller.callBackMix(function(){s._hideLoading(s.loginLoadingEl),sdk.PageCache.set("login_param",{accountType:s.controller.CONFIG.ACCOUNT_TYPE.LOGIN,account:l,password:n,randomPassword:u}),s._setRegSuccPopup(l,u,!0)},function(){s._hideLoading(s.loginLoadingEl),s.userController.checkNoticeInfo(i.ucid,"updatePassword")?s.doLoginCheck(o,t):s._showUpdateRandomPassBox({accountType:s.controller.CONFIG.ACCOUNT_TYPE.LOGIN,account:i.ucid,randomPassword:i.randomPassword})})):this.existUCAccount()}else o===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN?(console.log("游戏账号登录且非首次登录[游戏帐号，已绑定]"),this.existUCAccount(o,i.ucid)):(s._hideLoading(s.loginLoadingEl),this.controller.updateLoginCount(i.ucid),this.doLoginCheck(o,i.ucid))},register:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_b"]),S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["register"]});var e=this._randomPassword(),t=this._showLoading(),n=this;this.userController.register({password:e,isRandomPassword:!0,agree:!0},this.userController.callBackMix(function(o){function s(){n._hideLoading(t),n._setRegSuccPopup(o.get("ucid"),e,!1),"gameLogin"==n.$el.find("#registerBut").data("type")?(sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5_sign_w_GameAccount"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["h5_sign_w_GameAccount"])):(sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5_sign_w_UCAccount"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["h5_sign_w_UCAccount"]))}function i(){n.controller.loginSubmit(r,!0,n.controller.callBackMix(function(o){n._hideLoading(t),ucf.Cache.set("openTestGame_"+o.get("ucid"),o.get("openTestGame"),3600,!0),ucf.Cache.set("isAlpha_"+o.get("ucid"),o.get("isAlpha"),3600,!0),"gameLogin"==n.$el.find("#registerBut").data("type")?(sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5_sign_w_GameAccount"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["h5_sign_w_GameAccount"])):(sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5_sign_w_UCAccount"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["h5_sign_w_UCAccount"])),n._setRegSuccPopup(o.get("ucid"),e,!1)},function(e,o){n._hideLoading(t),n._showErrorMsg(o.msg||"登录失败")}))}n.generalController.setCacheData("user_info_"+o.get("ucid"),{random:!0,password:e},0,!0);var r={account:o.get("ucid"),isAutoLogin:!0,password:e};S.global.versionCompare(S.global.version,rConfig.VERSIONS.LOGIN_WIDGET_VERSION)>=0?($("#registerReturnGameBtn").data("regType","registerOnly"),s.call(n)):($("#registerReturnGameBtn").data("regType","registerAndLogin"),i.call(n))},_.bind(function(e){n._hideLoading(t),n.generalController.sendClientMsg(e)},this)),!0)},doLoginCheck:function(e,t,n){function o(){if(r&&r.status&&"B"==r.status)return sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(r.message)),void 0;if(a)sdk.Url.redirect("../game/game.html#!game/validCode/false");else{if(n)return n.apply(s),void 0;s.userController.sdkExit()}}var s=this,i=this.userController.getCurUser().ucid,r=ucf.Cache.get("openTestGame_"+i,!0),a=ucf.Cache.get("isAlpha_"+i,!0),c=this.controller.getLoginCount(i);e==this.controller.CONFIG.ACCOUNT_TYPE.LOGIN&&c==this.localConfig.LOGIN_COUNT?this.toSecrecyPage(e,t,function(){o()}):o()},bindMobile:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindphone_b"]),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bindSecrecyMobile"]),sdk.Url.location.route("#!secrecy/preBind/ucidbindpage")},returnGame:function(){this.regReturn?"gameLogin"==this.$el.find("#registerBut").data("type")?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_game_b_GameAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_game_b_UCAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindgame_b"]);var e=$("#ucAccount").attr("data-value"),t=$("#ucAccount").attr("data-acType");this.doLoginCheck(t,e),sdk.PageCache.del("login_param")},registerReturnGame:function(){var e=$("#registerReturnGameBtn");if("registerAndLogin"===e.data("regType"))return console.log("SDK exit without login"),this.returnGame.call(this),void 0;var t=this,n=this.$el.find("#regUcAccount").data("ucid"),o=this.$el.find("#regPassword").data("password"),s=t._showLoading(),i={account:n,password:o,isAutoLogin:!0};t.controller.loginSubmit(i,!1,t.controller.callBackMix(function(e){t._hideLoading(s),ucf.Cache.set("openTestGame_"+n,e.get("openTestGame"),3600,!0),ucf.Cache.set("isAlpha_"+n,e.get("isAlpha"),3600,!0),t.regReturn?"gameLogin"==t.$el.find("#registerBut").data("type")?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_game_b_GameAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_game_b_UCAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindgame_b"]);var o=$("#ucAccount").attr("data-value"),i=$("#ucAccount").attr("data-acType");t.doLoginCheck(i,o),sdk.PageCache.del("login_param")},function(e,n){t._hideLoading(s),t._showErrorMsg(n.msg||"登录失败")}))},firstGameLogin:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["firstGameLogin"]});var e=sdk.PageCache.get("login_param");if(e.success&&e.data){var t=e.data.account,n=e.data.accountType,o=e.data.randomPassword;$("#ucAccount").html(t),$("#ucAccount").attr("data-value",t),$("#ucAccount").attr("data-acType",n),$("#randomPassword").attr("data-value",o),$("#randomPassword").html(o)}},returnGameAndLogin:function(e){var t=$(e.target);if("true"===t.data("returngame")){var n,o,s=this,i=!0;"registerNow"===t.data("regType")?(n=this.$el.find("#regNowUcAccount").data("ucid"),o=this.$el.find("#regNowPassword").data("password"),i=this.$el.find("#regNowIconCheckbox").hasClass("on")):(n=this.$el.find("#regUcAccount").data("ucid"),o=this.$el.find("#regPassword").data("password"));var r=s._showLoading(),a={account:n,password:o,isAutoLogin:i};s.controller.loginSubmit(a,!1,s.controller.callBackMix(function(e){s._hideLoading(r),ucf.Cache.set("openTestGame_"+n,e.get("openTestGame"),3600,!0),ucf.Cache.set("isAlpha_"+n,e.get("isAlpha"),3600,!0),s.regReturn?("registerNow"===t.data("regType")&&sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_game_h5 2.4.0_b"]),"gameLogin"==s.$el.find("#registerBut").data("type")?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_game_b_GameAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_game_b_UCAccount"])):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindgame_b"]);var o=$("#ucAccount").attr("data-value"),i=$("#ucAccount").attr("data-acType");s.doLoginCheck(i,o),sdk.PageCache.del("login_param")},function(e,t){s._hideLoading(r),s._showErrorMsg(t.msg||"登录失败")}))}},bindModifyAndLogin:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindmodifypwok_b"]),this.modifyAndLogin()},loginPageModifyAndLogin:function(){this.accountType===this.controller.CONFIG.ACCOUNT_TYPE.LOGIN?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_loginmodifypwok_b"]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_modify_b"])):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbindmodifypwok_b"]);var e=$("#randomPwdRemind").html().substr(0,5);"你使用的是"==e?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_modify_i_opt"]):"随机密码已"==e&&sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_modify_i_force"]),this.modifyAndLogin()},forceModifyAndLogin:function(){var e=$("#updateHint").attr("account"),t=($("#updateHint").attr("accountType"),$("#updateHint").attr("password")),n=$("#forcePassword").val(),o=$("#forcePassword").attr("type"),s=this;"password"==o?t==n?(this.generalController.setCacheData("user_info_"+e,{random:!1},0,!0),this._hidePopBox(),this.doLoginSuccess(this.model,this.resp)):(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_retypePw_w"]),$("#forcePwd").html(""),$("#forcePwd").append('<input id="forcePassword"  type="text" class="input_box" placeholder="重新输入密码" />'),$("#updateHint").html("密码错误，请确认后重新输入")):(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_overtimePw_b"]),S.SSCT.GetHandler("Controller","User").updatePass({oldPassword:t,password:n,isPostPass:!0},S.SSCT.GetHandler("Controller","User").callBackMix(function(){s._hidePopBox(),s.doLoginSuccess(s.model,s.resp)},function(e){s._showErrorMsg(e,"#loginSuccessNoticeBox")})))},modifyAndLogin:function(){var e=this,t=$("#newPassword").val(),n=$("#accountParam").attr("data-value"),o=$("#accountParam").attr("data-acType"),s=$("#accountParam").attr("data-password"),i="callback"===$(".modifyAndLoginBtn").attr("data-callback")?!0:!1;S.SSCT.GetHandler("Controller","User").updatePass({oldPassword:s,password:t,isPostPass:!0},S.SSCT.GetHandler("Controller","User").callBackMix(function(){var s;i&&(s=function(){$("#passwordLabel").html("密码"),$("#randomPassword").html(t),$("#randomPassword").attr("data-value",t),e._hidePopBox()}),e.doLoginCheck(o,n,s)},function(t){e._showErrorMsg(t,"#loginSuccessNoticeBox")}))},existUCAccount:function(){this._hideLoading(this.loginLoadingEl),this._showExsitAccountBox()},toSecrecyPage:function(e,t,n,o,s){var i=this;if(!s)var r=this._showLoading();this.controller.validSecrecy(e,t,this.controller.callBackMix(function(){s?i._hideLoading(s):i._hideLoading(r),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bindSecrecyMobile"]),1==o?sdk.Url.location.route("#!secrecy/preBind/pwFalse"):sdk.Url.location.route("#!secrecy/preBind/loginpage")},function(){s?i._hideLoading(s):i._hideLoading(r),n()}))},checkNerverNotice:function(){var e=$("#isNerverNotice");"checked"===e.attr("data-value")?(e.attr("data-value",""),e.removeClass("cbbg")):(e.attr("data-value","checked"),e.addClass("cbbg"))},useUCAccountLogin:function(){var e=this.userController.getCurUser(),t=this.generalController.getCacheData("user_info_"+e.ucid,!0);t&&(e.isRandomPassword=t.random,e.randomPassword=e.isRandomPassword?t.password:e.randomPassword);var n=!(!1===e.isRandomPassword||0===e.randomPassword.length);n?this.userController.checkNoticeInfo(e.ucid,"updatePassword")?this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid):this._showUpdateRandomPassBox({accountType:this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,account:e.ucid,randomPassword:e.randomPassword}):this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid)},setUsername:function(e){this.$el.find("#username").val(e)},setPassword:function(e,t){this.$el.find("#password").setInp(e).setModify(t)},logHist:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_otherid_b"])},selectHis:function(){var e=document.querySelector("#loginHistory"),t=e.options[e.selectedIndex],n=t.value,o=n||$("#loginHistory").val();if("-1"!=o){var s={};this.controller.getHistByUsername(o,this.accountType,this.controller.callBackMix(function(e){s=e})),this._setAccount({account:s.account,password:s.password,isRandomPassword:s.isRandomPassword})}},checkRememPassword:function(e){var t,n=e.target,o=n.getAttribute("data-checked");"checked"===o?(t="",$(n).removeClass(this.localConfig.checkedClass)):(t="checked",$(n).addClass(this.localConfig.checkedClass)),n.setAttribute("data-checked",t)},resetUsername:function(){this.setUsername(""),this.resetPassword()},resetPassword:function(){this.setPassword("")},cancelUCAccountLogin:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbindpass_b"]);var e=this.userController.getCurUser();this.userController.setNerverNotice(e.ucid,!0),this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid)},neverUpdatePass:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_opt_no_l"]);var e=this.userController.getCurUser();$(".btnClick-none").removeClass("btnClick-none"),this._hidePopBox(),this.doLoginCheck(this.accountType,e.ucid)},cancelModify:function(){this._hidePopBox()},forgetPassword:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_forgetpw_l"]),S.Url.location.route("#!findPassword/passwordRetake/messageRetake")},gotoAgreement:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_article_l"]),S.Url.location.route("#!user/agreement"),$("#regSuccessPopup").hasClass("ms-none")||S.PageCache.set("sso_regSuccWin_params",this._popupParams),$("#registerNowPopbox").isHide()||($("#registerNowPopbox").suiHide(),S.PageCache.set("sso_is_regNowWin_show",!0))},gotoGameLogin:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldid_l"]),S.Url.location.route("#!sso/gameLogin"),sdk.PageCache.del("login_param")},goBack:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbinducid_b"]),S.Url.back()},_setHistory:function(e,t,n){var o=this,s={isRandomPassword:!1,account:"",password:""};this._getHistData(_.bind(function(i){o.loginHist=i;var r=this.controller.getHistLength(this.accountType);if(0===r||_.isUndefined(i[0]))this.$el.find("#showHistory").removeClass("ms-block").addClass("ms-ni");else{r>1?this.$el.find("#showHistory").removeClass("ms-ni").addClass("ms-block"):this.$el.find("#showHistory").removeClass("ms-block").addClass("ms-ni");var a=null,c=document.createDocumentFragment(),l=new Option("请选择账号","-1");c.appendChild(l),_.each(i,function(t){_.isEmpty(e)||t.account!==e||(a=t),c.appendChild(new Option(t.account,t.account))}),$("#loginHistory").append(c),e&&t?a={isRandomPassword:!1,account:e,rememberPassword:!0,password:t}:e&&null===a?a={isRandomPassword:!1,account:e,rememberPassword:!1,password:""}:null===a&&(a=i[0]),s.isRandomPassword=a.isRandomPassword,s.account=a.account,a.rememberPassword&&(s.password=a.password)}this._setAccount({account:s.account,password:s.password,isRandomPassword:s.isRandomPassword,securityType:n})},this),!0)},_flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),$(window).width()>$(window).height()},_setAccount:function(e){var t;this.setUsername(e.account),1==e.securityType?t=!1:0==e.securityType&&(t=!0),this.setPassword(e.password,t)},_showLoading:function(e){var t=S.common.ui.NoticeBox.loading(e);return t},_textLoading:function(){var e=S.common.ui.NoticeBox.loading("loading_text");return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},_getHistData:function(e,t){var n=this,o=this.controller.getHistories(this.accountType);_.isUndefined(o)||t===!0?this.controller.getHistory(this.accountType,this.controller.callBackMix(function(t){e&&e(t)},function(e){n._showErrorMsg(e,"#errorEl")})):e&&e(o)},_showUpdateRandomPassBox:function(e){e.accountType==this.controller.CONFIG.ACCOUNT_TYPE.LOGIN?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_loginmodifypw_w"]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_modify_w"])):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbindmodifypw_w"]),$("input").addClass("btnClick-none");var t=this;this._showPopBox(template.render("updateRandomPassBoxTempl"),function(){t.loginCount<=10?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_opt_w"]),$("#randomPwdRemind").html('你使用的是随机密码<em style="color:red;font-weight:bold;">(还可以使用'+(10-parseInt(t.loginCount))+"次)</em>，为了你的账号安全，请及时修改。")):(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_force_w "]),$("#randomPwdRemind").html("随机密码已到期，请设置密码后进入游戏。"),$("#neverUpdateBtn").addClass("ms-none")),$("#accountParam").attr("data-value",e.account),$("#accountParam").attr("data-acType",e.accountType),$("#accountParam").attr("data-password",e.randomPassword)})},_setUpdatePassParam:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindmodifypw_b"]),$("input").addClass("btnClick-none");var e=$("#ucAccount").attr("data-value"),t=$("#ucAccount").attr("data-acType"),n=$("#randomPassword").attr("data-value");this._showUpdatePassBox({account:e,accountType:t,password:n})},_showUpdatePassBox:function(e){this._showPopBox(template.render("updatePassBoxTempl"),function(){$("#accountParam").html(e.account),$("#accountParam").attr("data-value",e.account),$("#accountParam").attr("data-acType",e.accountType),$("#accountParam").attr("data-password",e.password)})},_showExsitAccountBox:function(){var e=this.userController.getCurUser(),t=this.userController.checkNoticeInfo(e.ucid);t?this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid):(S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["existUCAccount"]}),this._showPopBox(template.render("ownUCAccountBoxTempl"),function(){$("#bindTitle").html("我们发现你的《"+e.gameName+"》游戏老账号和UC账号曾经绑定过。"),$("#bindUcid").html("UC账号："+e.ucid)}))},_showPopBox:function(e,t){var n=this;$("body").addClass("btnClick-none"),_.delay(function(){function o(){var e=parseInt($(window).height()),t=parseInt($(document).height());return e>t?e:t}sdk.EC.hideInput(),$("#popBox").html(e),$("#popup").removeClass("ms-none"),$("#modifyPassMask").height(o()),$(window).on("resize",function(){$("#modifyPassMask").height(o())}),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",function(){n._hidePopBox()}),t.apply(n)},50)},_hidePopBox:function(){sdk.EC.showInput(),$("#popup").addClass("ms-none"),$("body").removeClass("btnClick-none"),$(".btnClick-none").removeClass("btnClick-none"),$(window).off("resize"),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),document.removeEventListener("backbutton")},_showErrorMsg:function(e){this.generalController.sendClientMsg(e)},_randomPassword:function(){return"UCX"+Math.random().toString().substr(2,8)},setAccAutoLogin:function(){var e=$("#iconCheckbox");e.hasClass("on")?(e.removeClass("on"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_CloseAutoLogin_b","login"])):(e.addClass("on"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_OpenAutoLogin_b","login"]))},setRegNowAccAutoLogin:function(){function e(){o.addClass("on")}function t(){o.removeClass("on")}function n(e){e.msg&&_this._showErrorMsg(e.msg)}var o=$("#regNowIconCheckbox");o.hasClass("on")?(o.removeClass("on"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_CloseAutoLogin_b","register"]),this.userController.setAutoLoginState({isAutoLogin:!1},{success:t,error:n})):(o.addClass("on"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_OpenAutoLogin_b","register"]),this.userController.setAutoLoginState({isAutoLogin:!0},{success:e,error:n}))},modifyPassword:function(){var e=this.$el.find("#modifyPassBtn"),t=this.$el.find("#regPassword"),n=this.$el.find("#newPasswordSpan"),o=this.$el.find("#passwordName"),s=this.$el.find("#modifyResult"),i=e.val(),r=this.$el.find("#registerBut").data("type");if("修改密码"==i)"gameLogin"==r?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_modifyPw_b_GameAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_modifyPw_b_UCAccount"]),n.toggleClass("ms-ni"),t.toggleClass("ms-ni"),o.html("输入密码:"),e.val("    完成   "),s.css("color","grey"),s.html("点击空白区域可取消修改");else if("    完成   "==i){"gameLogin"==r?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_PwConfirm_b_GameAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_PwConfirm_b_UCAccount"]);var a=this.$el.find("#newPassword"),c=a.val();if(a.val(""),s.html(""),c.length<6||c.length>20)return this.hideModify(),s.css("color","red"),s.html("密码格式错误！"),void 0;sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signmodifypwok_b"]);var l={isPostPass:!0,oldPassword:t.html(),password:c},u=this;u._hideLinkEffect(),this.userController.registerUpdatePass(l,this.controller.callBackMix(function(){s.css("color","#333333"),s.html("密码修改成功！"),n.toggleClass("ms-ni"),t.toggleClass("ms-ni"),o.html("账号密码:"),e.val("修改密码"),t.html(c).data("password",c),u._popupParams&&(u._popupParams[1]=c),u.randomPwd=!1;var i=u.$el.find("#regUcAccount").html();sdk.PageCache.set("login_param",{accountType:u.controller.CONFIG.ACCOUNT_TYPE.LOGIN,account:i,password:c,randomPassword:""}),u._hideLinkEffect()},function(e){u.hideModify(),s.css("color","red"),s.html(e)}))}},hideModify:function(e){if(!e||"modifyPassBtn"!=e.target.id&&"newPassword"!=e.target.id&&"returnGameBtn"!=e.target.id){this.$el.find("#newPasswordSpan").addClass("ms-ni"),this.$el.find("#regPassword").removeClass("ms-ni"),this.$el.find("#modifyPassBtn").val("修改密码");var t=this.$el.find("#passwordName");"账号密码:"!=t.html()&&(this.randomPwd?t.html("随机密码:"):t.html("账号密码:"),this.$el.find("#modifyResult").html("&nbsp;"))}},_restoreRegSuccWin:function(){var e=sdk.PageCache.get("sso_regSuccWin_params");e.success&&e.data&&(sdk.PageCache.del("sso_regSuccWin_params"),this._setRegSuccPopup.apply(this,e.data))},_restoreRegNowWin:function(){var e=sdk.PageCache.get("sso_is_regNowWin_show");e&&e.data&&(sdk.PageCache.del("sso_is_regNowWin_show"),this._showRegNowPopbox())},_setRegSuccPopup:function(e,t,n,o){if(this.$el.find("#regUcAccount").html(e).data("ucid",e),this.$el.find("#regPassword").html(t).data("password",t),$("#registerReturnGameBtn").data("regType","firstGameLogin"),this.$el.find("#password").addClass("ms-ni"),this.$el.find("#username").addClass("gr-vshid"),$("body").addClass("btnClick-none"),this.$el.find("#regSuccessPopup").removeClass("ms-none"),this._popupParams=[e,t,n,o],n){o&&this.$el.find("#passwordName").html("账号密码:");var s=this.$el.find("#gameNotice");s.css("margin","10px 10px -10px 15px"),s.css("color","grey"),s.html("为提供更好的游戏服务，我们为您分配了新的UC账号。"),this.$el.find("#regSuccTitle").html("老账号绑定新UC账号"),this.$el.find("#regAgree").removeClass("ms-none")}this.regReturn=!1}});S.SSVW.User=Backbone.View.extend({el:"#userContainer",events:{"onclick #oldPass,#newPass,#regGuestPassword,#passwordToBind":"flushInpt","onclick #changePassBtn":"gotoUpdatePass","onclick #confirmChangePass":"doUpdatePass","onclick #payHistoryBtn":"gotoPayHistory","onclick #logoutBtn":"logout","onclick #aboutBtn":"gotoAboutUs","onclick #feedBackBtn":"gotoFeedBack","onclick #bbsBtn":"gotoBBS","onclick #existAccountBtn":"gotoLogin","onclick #gameExp":"gotoGameExp","onclick #vipBtn":"gotoVipArea","onclick #toSecrecyBtn":"gotoSecrecy","onclick #changeNickname":"changeNickname","onclick #submitNicknameBtn":"submitNickname","onclick #accountSecureBtn":"gotoAccountSecure","onclick #gotoSecCenterBtn":"gotoSecCenter","onclick #rechargeBtn":"gotoRecharge","onclick #multiAccountBtn":"gotoMultiAccount","onclick #becomeVipBtn":"gotoBecomeVip","onclick .del_icon":"_showConfirmBox","onclick #exitBtn":"curLogout","onclick #activeAgreementBtn":"gotoAgreement","onclick #bindUCAccount":"gotoActivate","onclick #bindUCAccountPlf":"gotoActivatePlf","onclick #regGuest":"registerGuestAccount","onclick #activateGuest":"bindGuestAccount","onclick #bindReturn":"bindReturn","change  #bindLoginHistory":"selectHis","onclick #bindLoginHistory":"logHist","onclick #userBaseInfo":"hideEditNickname","onclick #autoLoginSwitch":"setAutoLoginStatus","onclick .switAcc":"switAccHandler"},pageScroll:{},redirectTitle:void 0,redirectUrl:void 0,config:{SECURITY_TYPE:{UNSECURITY:0,SECURITY:1}},initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","User"),this.ssoController=S.SSCT.GetHandler("Controller","Sso"),this.generalController=S.SSCT.GetHandler("Controller","General");var e=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);e!==!1&&e>=0?$("body").data("ctrl","true"):$("body").data("ctrl","")},userInfo:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["management"]}),this._userInfo(),this.entranceControl(),this.controller.getBaseUserInfo(this.controller.callBackMix(this.renderBaseInfo,$.proxy(function(e){this.renderBaseInfo({}),sdk.common.ui.NoticeBox.error(e)},this)))},updatePassword:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["updatePassword"]}),this._userInfo();var e=this.controller.getCurUser();this.controller.userName,this.$el.find("#up-nickname").html(""),this.$el.find("#up-ucid").html(e.ucid),this.$el.find("#newPass").val(""),this.$el.find("#newPass").attr("placeholder","请输入6-20位字母或数字");var t=this.generalController.getCacheData("user_info_"+e.ucid,!0);_.isUndefined(t)||_.isEmpty(t)||t.random&&(e.isRandomPassword=!0,e.randomPassword=t.password),e.isRandomPassword?(this.$el.find("#oldPass").attr("placeholder",""),this.$el.find("#oldPass").val(e.randomPassword)):(this.$el.find("#oldPass").val(""),this.$el.find("#oldPass").attr("placeholder","请输入6-20位字母或数字"));var n=this;S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"onEdit"==e.action&&n.editMode===!0?n.cancelEditMode():"doUpdatePass"==e.action&&n.editMode!==!0&&n.doUpdatePass()}})},renderBaseInfo:function(e){var t=this,n=S.SSCT.GetHandler("Controller","AccountManage"),o=$("#secureState");sdk.PageCache.del("risk"),n.getSecureStateDetail(["mobile","question"],n.callBackMix(function(e){1!==e.mobile.code||1!==e.question.code&&126!==e.question.code?(o.text("获取失败"),o.removeClass(),sdk.PageCache.set("risk","fail")):_.isEmpty(e.mobile.mobile)&&_.isEmpty(e.question.password_question)?(o.text("未设置"),o.removeClass().addClass("red"),sdk.PageCache.set("risk","none")):_.isEmpty(e.mobile.mobile)||_.isEmpty(e.question.password_question)?_.isEmpty(e.question.password_question)?_.isEmpty(e.mobile.mobile)||(o.text("手机"),o.removeClass(),sdk.PageCache.set("risk","mobile"),sdk.PageCache.set("secrecy_binding_mobile",e.mobile.mobile)):(o.text("密保问题"),o.removeClass(),sdk.PageCache.set("risk","question")):(o.text("手机、密保问题"),o.removeClass(),sdk.PageCache.set("risk","both"),sdk.PageCache.set("secrecy_binding_mobile",e.mobile.mobile)),o.addClass("oth")},function(){o.text("获取失败"),o.removeClass(),o.addClass("oth"),sdk.PageCache.set("risk","fail")}));var s=S.SSCT.GetHandler("Controller","Pay");s.getUPointBalance(s.callBackMix(function(e){$("#uPointBalance").text("余额："+e.get("balance")+" U点")},function(e){t._showErrorMsg(e)}));var i=S.SSCT.GetHandler("Controller","User");i.getLoginHistoryCount({},i.callBackMix(function(e){$("#accountNo").addClass("pag_blue");var t=parseInt(e.count);t>99?$("#accountNo").text("N"):$("#accountNo").text(e.count)},function(e){t._showErrorMsg(e)}));var r=S.global.versionCompare(S.global.version,rConfig.VERSIONS.AUTO_LOGIN_VERSION);r!==!1&&r>=0?($("#autoLoginSetting").removeClass("ms-ni"),$("#autoLoginNoti").removeClass("ms-ni")):($("#autoLoginSetting").addClass("ms-ni"),$("#autoLoginNoti").addClass("ms-ni")),this.$el.find("#userInfoDetailBtn").removeAttr("disabled"),this.controller.getCurUserInfo();var a,c=this.controller.getCurUser(),l=e.userName;if(_.isUndefined(l)||_.isEmpty(l)?l="UC用户":l.length>rConfig.user.showUserNickLen&&(l=l.substr(0,rConfig.user.showUserNickLen-1)+"..."),a=_.isUndefined(e.level)?0:e.level,this.$el.find("#sdkVersion").html(eConfig.version),_.isEmpty(e))ucf.Cache.set("userBaseInfo_"+c.ucid,{level:0,userName:"UC用户"},1800,!0),this.$el.find("#userInfoNickname").html(l),this.$el.find("#userInfoUcid").html(c.ucid),this.$el.find("#userInfoLevel").html(0),this.$el.find("#userInfoAvatar").attr("src","../common/sdk_images/tx-999.jpg"),this.$el.find("#userInfoVip").css("display","none");else{this.$el.find("#userInfoNickname").html(l),this.$el.find("#userInfoUcid").html(c.ucid);var u=!1,d="";0===e.gender?(d="../common/sdk_images/czsex.png",genderAvatar="../common/sdk_images/tx-998.jpg"):1===e.gender?(d="../common/sdk_images/sexn.png",genderAvatar="../common/sdk_images/tx-999.jpg"):(genderAvatar="../common/sdk_images/tx-999.jpg",u=!0),this.$el.find("#userInfoAvatar").attr("src",genderAvatar),this.$el.find("#userInfoLevel").html(a)}this.controller.getFeatureSwitch(this.controller.callBackMix(function(e){t._enableUserChange=e.enableUserChange,e.enableUserChange&&$("#exitBtn").removeClass("ms-ni")}))},entranceControl:function(e){var t=!1;this.controller.getFeatureSwitch(this.controller.callBackMix(function(n){n.enablePayHistory?($("#payHistoryBtn").removeClass("ms-ni"),$("#payHistoryBtn").addClass("p-last-border"),t=!0):($("#rechargeBtn").length>0&&($("#rechargeBtn")[0].style.webkitBorderRadius="5px"),$("#payHistoryBtn").addClass("ms-ni")),n.enableUserChange&&($("#logoutBtn").parent().removeClass("ms-none"),t||($("#logoutBtn").parent().addClass("p-last-border"),t=!0)),t&&$("#gameExp").parent().removeClass("p-last-border"),n.isAutoLogin?($("#autoLoginSwitch").addClass("on"),$("#autoLoginNoti").html("关闭后每次进入游戏时可重新选择账号进行登录。")):($("#autoLoginSwitch").removeClass("on"),$("#autoLoginNoti").html("开启后将自动使用最近登录的账号进入游戏。")),e&&e()},function(){e&&e()}))},doUpdatePass:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ModifyPW_sumit_b"]);var e=this.$el.find("#oldPass").val(),t=this.$el.find("#newPass").val();if(!e)return this._showErrorMsg("请输入旧密码"),void 0;if(!t)return this._showErrorMsg("请输入新密码"),void 0;this.controller.setCurUser({}),this.$el.find("#confirmChangePass").attr("disabled","disabled");var n={oldPassword:e,password:t,isPostPass:!0},o=this;this.controller.updatePass(n,this.controller.callBackMix(function(){o.controller.getCurUserInfo(o.controller.callBackMix(function(){$("body").addClass("btnClick-none"),o._showErrorMsg("更新密码成功"),S.Url.back()},function(){S.Url.location.route("#!sso/login")}))},function(e){o._showErrorMsg(e),o.$el.find("#confirmChangePass").removeAttr("disabled")}))},flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||sdk.common.ui.NoticeBox.hide(this.noticeBar,null,"slide")},logout:function(){this.generalController.jumpToNativePage({uiBusiness:"login"})},_userInfo:function(){var e=this;this.controller.getCurUserInfo(this.controller.callBackMix(null,$.proxy(function(){this.generalController.getSourcePageInfo(this.generalController.callBackMix(function(t){e.generalController.jumpToNativePage(t)},function(){S.Url.location.route("#!sso/login")}))},this)))},showVipPanel:function(e){this.controller.getVipInfo(this.controller.callBackMix(function(){var t=$("#vip");t.css("display","block"),e||(t.addClass("p-last-border"),$("#gameExp").parent().removeClass("p-last-border"))},function(){}))},gotoVipArea:function(){S.Url.location.route("#!vip/showVipArea")},gotoUpdatePass:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_ModifyPW_l"]),S.Url.location.route("#!user/updatePassword")},gotoPayHistory:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_PayRecord_l"]);var e=window.location.href.match("user/user.html")?"user/user.html#!user":"user/user_landscape.html#!user",t=window.location.href.replace(e,"pay/pay.html#!pay/history/"+S.SSCT.GetHandler("Controller","User").getCurUser().gameName);sdk.Log.pageEnter(sdk.Log.businesses.PAGE_PAY,["payHistory"]),S.Url.redirect(eConfig.payHistoryUrl+(eConfig.payHistoryUrl.indexOf("?")>=0?"&":"?")+"p="+encodeURIComponent(t))},gotoAboutUs:function(){var e=this.controller.getCurUser();sdk.Log.pageEnter(sdk.Log.businesses.PAGE_GENERAL,["about"]),S.Url.redirect("../general/about.html?game="+e.gameName)},gotoLogin:function(){var e=this;this.generalController.getSourcePageInfo(this.generalController.callBackMix(function(t){e.generalController.jumpToNativePage(t)},function(){S.Url.location.route("#!sso")}))},gotoFeedBack:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["feedBack"]),sdk.PageCache.set("feedBack_result_url",window.location.href);var e=S.SSCT.GetHandler("Controller","Game"),t=this;e.getGameInfo(e.callBackMix(function(e){S.Url.redirect(eConfig.feedBackCenter+"?uid="+t.controller.getCurUser().ucid+"&uname="+t.controller.getCurUser().nickname+"&gid="+e.gameId+"&gname="+t.controller.getCurUser().gameName+"&skey=D02")}))},gotoBBS:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bbsClick"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["bbsClick"]),sdk.PageCache.set("sdk_redirect_out",1),S.Url.redirect("../bbs/bbs.html")},gotoGameExp:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["gameExp"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["gameExp"]),S.Url.redirect("http://a.9game.cn/sdk/list.html")},gotoSecrecy:function(){S.Url.location.route("#!secrecy/preBind/usercenter")},multiAccount:function(){var e="",t=this.controller.getCurUser(),n=this;this.editMode=!1,this._getHistData(function(o){_.each(o,function(n){itemHtml=template("accountInfoItemTempl",{gameName:_.isEmpty(n.gameName)?"空":n.gameName,ucAccount:n.account,dispAccount:n.account.replace("@",'<span class="at at-s12"></span>'),status:n.account==t.account?"icon_st":""}),e+=itemHtml}),$("#accountInfos").html(e),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"backToUser"==e.action&&(sdk.common.ui.MsgBox.remove(),S.Url.back()),"onEdit"==e.action&&n.editMode===!0?n.cancelEditMode():"onEdit"==e.action&&n.editMode!==!0&&n.showEditMode()}})},!0),this.controller.getFeatureSwitch(this.controller.callBackMix(function(e){var t=S.global.versionCompare(S.global.version,rConfig.VERSIONS.AUTO_LOGIN_VERSION);if(e.enableUserChange&&t!==!1&&t>=0){for(var o=document.querySelectorAll(".gotoStatus"),s=0;s<o.length;s++)o[s].style.visibility="visible";n._enableGotoStatus=!0}}))},showEditMode:function(){this.editMode=!0,this.generalController.setHeaderStyle({topBarBtnBackGame:{text:"完成",visible:!0,visiblePersist:!1,btnShape:"rect"}});for(var e=document.querySelectorAll(".delStatus"),t=0;t<e.length;t++)e[t].style.display="block";if(this._enableGotoStatus===!0)for(var n=document.querySelectorAll(".gotoStatus"),t=0;t<n.length;t++)n[t].style.visibility="hidden"},cancelEditMode:function(){this.editMode=!1,this.generalController.setHeaderStyle({topBarBtnBackGame:{text:"编辑",visible:!0,visiblePersist:!1,btnShape:"rect"}});for(var e=document.querySelectorAll(".delStatus"),t=0;t<e.length;t++)e[t].style.display="none";if(this._enableGotoStatus===!0)for(var n=document.querySelectorAll(".gotoStatus"),t=0;t<n.length;t++)n[t].style.visibility="visible"},_getHistData:function(e,t){var n=this,o=rConfig.ACCOUNT_TYPE.UC,s=this.ssoController.getHistories(o);!s||t?this.ssoController.getHistory(o,this.controller.callBackMix(function(t){e&&e(t)},function(e){n._showErrorMsg(e)})):e&&e(s)},removeHistory:function(e){var t=e,n=$(t).attr("data-account"),o=rConfig.ACCOUNT_TYPE.UC,s=this;this.controller.removeHistory({accountType:o,account:parseInt(n)},this.controller.callBackMix(function(){ucf.Cache.remove("user_info_"+n,!0),$(t).remove()},function(){s._showErrorMsg()}))},_showConfirmBox:function(e){var t=this,n=$(e.target);if(n.hasClass("del_icon")){$(e.target).addClass("btnClick-none");var o=e.target.parentNode.parentNode;$("body").addClass("btnClick-none"),sdk.common.ui.MsgBox.show('<div><center><p class="gr-f16">确认在本机删除账号'+$(o).attr("data-account")+"？</p></center></div><div><center><p>被删除账号将不会出现在登录输入框中</p></center></div>",{confirmName:"确定",cancelName:"取消",callBack:function(){$(e.target).removeClass("btnClick-none"),t.removeHistory(o),sdk.common.ui.MsgBox.remove(),$("body").removeClass("btnClick-none")},cancel:function(){$(e.target).removeClass("btnClick-none"),sdk.common.ui.MsgBox.remove(),$("body").removeClass("btnClick-none")}},"confirm",!0)}},curLogout:function(){var e=this;sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_Account_Logout_b"]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_Account_Logout_w"]),this._confirm({title:'<div><center><p class="gr-f16">确定要退出当前账号？</p></center></div>',confirm:"退出账号",cancel:"取消"},function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_Account_LogoutOK_b"]),S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT),e.controller.notifyCp({code:1,msg:""},{success:function(){e.controller.sdkExit()},error:function(){e._showErrorMsg("通知游戏失败")}},"logout"),sdk.PageCache.set("clear_history",1)},function(){})},_showErrorMsg:function(e){this.generalController.sendClientMsg(e)},changeNickname:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_NicknameModify_b"]),$("#userInfoNickname").toggleClass("hide"),$("#changeNickname").toggleClass("hide"),$("#editNickname").toggleClass("hide"),$("#submitNicknameBtn").toggleClass("hide"),$("#editNickname").val("")},hideEditNickname:function(e){"editNickname"!=e.target.id&&"changeNickname"!=e.target.id&&$("#userInfoNickname").hasClass("hide")&&this.changeNickname()},submitNickname:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_NicknameModifyOK_b"]);var e=this.$el.find("#editNickname").val();if(!e)return this._showErrorMsg("请输入昵称"),void 0;this.controller.setCurUser({});var t={uid:this.$el.find("#userInfoUcid").text(),userName:e},n=this;this.controller.updateNickname(t,this.controller.callBackMix(function(){n.controller.getCurUserInfo(n.controller.callBackMix(function(){n._showErrorMsg("修改昵称成功"),e.length>rConfig.user.showUserNickLen&&(e=e.substr(0,rConfig.user.showUserNickLen-1)+"..."),$("#userInfoNickname").text(e)},function(){S.Url.location.route("#!sso/login")}))},function(e){"userName_isExist"==e?n._showErrorMsg("用户名已存在"):n._showErrorMsg(e)}))},gotoAccountSecure:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_AccountSafe_l"]),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"backToUser"==e.action&&(sdk.common.ui.MsgBox.remove(),S.Url.back())}}),$("#secureState"),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["accountSecure"]),S.Url.location.route("#!secrecy/preBind/usercenter")},gotoSecCenter:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["accountSecure"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["accountSecure"]),sdk.PageCache.set("sdk_redirect_out",1);var e=eConfig.secureUrl+"?uc_param_str=frpfvesscpmilaprnisieiut&appId=17"+"&backUrl="+encodeURIComponent(eConfig.sdkExitBackUrl);S.Url.redirect(e)},gotoRecharge:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_PayUpoint_l"]),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["udPay"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["udPay"]),sdk.PageCache.set("sdk_redirect_out",1);var e={},t=this,n=S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_GAME_INFO);n&&n.success&&(e.gameId=n.data.gameId,e.serverId=n.data.serverId,e.upayPage=rConfig.apis.U_PAY_PAGE,this.controller.rechargeUPoint(e,{success:function(e){S.Url.redirect(e.url)},error:function(e){t._showErrorMsg(e.msg)}}))},gotoMultiAccount:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_AccountManage_l"]),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["multiAccount"]),S.Url.location.route("#!user/multiAccount")},gotoBecomeVip:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["becomeVip"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["becomeVip"]),sdk.PageCache.set("sdk_redirect_out",1);var e=eConfig.becomeVip;S.Url.redirect(e)},gotoAgreement:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_article_l"]),S.Url.location.route("#!user/agreement")},gotoActivate:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_l"]),S.Url.location.route("#!user/activate")},gotoActivatePlf:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_l"]),S.Url.location.route("#!user/activatePlf")},activate:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_p"]),this._backButtonHandle(function(e){"activeBackGame"==e.action&&(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_leaveformaloldid_b"]),S.SSCT.GetHandler("Controller","User").sdkExit())});var e,t,n=sdk.PageCache.get("auto_login_info"),o=S.SSCT.GetHandler("View","Sso"),s=S.SSCT.GetHandler("Controller","Sso"),i=this;n.data&&(e=n.data.account,t=n.data.password),console.log("Android login history cache:"+JSON.stringify(n.data)),o._getHistData(function(n){var o=s.getHistLength(0);if(0===o||_.isUndefined(n[0]))i.$el.find("#bindLoginHistory").removeClass("ms-block").addClass("ms-ni");else{o>1?i.$el.find("#bindLoginHistory").removeClass("ms-ni").addClass("ms-block"):i.$el.find("#bindLoginHistory").removeClass("ms-block").addClass("ms-ni");var r=document.createDocumentFragment(),a=new Option("请选择账号","-1");r.appendChild(a),_.each(n,function(e){r.appendChild(new Option(e.account,e.account))}),$("#bindLoginHistory").append(r)}e&&t?(i.$el.find("#ucAccountToBind").val(e),i.$el.find("#passwordToBind").setInp(t)):n[0]&&(i.$el.find("#ucAccountToBind").setInp(n[0].account),i.$el.find("#passwordToBind").setInp(n[0].password))},!0)},activatePlf:function(){this.activate()},regActivate:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5a_formalsign_p"]),this._backButtonHandle(function(e){"regActiveBackGame"==e.action&&(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_leaveformalsign_b"]),S.SSCT.GetHandler("Controller","User").sdkExit())})},regActivatePlf:function(){this.regActivate();var e=sdk.common.utils.Url.getQueryStringArgs();e.title&&(this.redirectTitle=e.title,this.redirectUrl=e.redirectUrl,this.$el.find("#activateHint").text("进入"+e.title+"前，请先注册账号并完成激活："))},logHist:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_otherid_b"])},selectHis:function(){var e=this.$el.find("#bindLoginHistory").val(),t=e||this.$el.find("#bindLoginHistory").val(),n=S.SSCT.GetHandler("Controller","Sso"),o=this;"-1"!=t&&n.getHistByUsername(t,0,this.controller.callBackMix(function(e){o.$el.find("#ucAccountToBind").val(e.account),o.$el.find("#passwordToBind").setInp(e.password)},function(){o.$el.find("#passwordToBind").setInp("")}))},registerGuestAccount:function(){function e(e){sdk.Log.click(sdk.Log.businesses.PAGE_USER,[e])}sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formalsign_b"]),$("#regGuest").addClass("btnClick-none");var t=this.$el.find("#regGuestEmail").val(),n=this.$el.find("#regGuestPassword").val(),o=(this.config.SECURITY_TYPE.UNSECURITY,this);if(t&&!t.match(rConfig.user.emailAccountFilter))return this._showErrorMsg("邮箱输入有误"),e("email_format_error"),void 0;if(n.length<6||n.length>20)return this._showErrorMsg("密码长度不符（6-20位）"),void 0;if(n.match(rConfig.user.passwordFilter))return this._showErrorMsg("密码必须为字母或数字"),void 0;var s={email:t,password:n,isRandomPassword:!1};this.controller.registerGuestAccount(s,this.controller.callBackMix(function(e){t.length>20&&(t=t.substr(0,19)+"..."),o.$el.find("#newUCID").text(e.data.ucid),o.$el.find("#bindEmail").text(t),t?o.$el.find("#bindEmailP").removeClass("ms-vshid"):o.$el.find("#bindEmailP").addClass("ms-vshid"),setTimeout($.proxy(function(){this.bindGuestAccountSuccess()},o),80)},function(t){t.msg.match("已被使用")&&e("email_is_used_error"),o._showErrorMsg(t.msg)}))},bindGuestAccountSuccess:function(){this._hideLinkEffect("bindReturn"),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5a_formalsignok_p"]),this.redirectTitle&&this.$el.find("#bindReturn").val("进入"+this.redirectTitle);var e=this.$el.find("#registerGuestAccountSuccess");e.removeClass("ms-none")},bindGuestAccount:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_b"]);var e=this.$el.find("#ucAccountToBind").val(),t=this.$el.find("#passwordToBind").getInp(),n=$("#passwordToBind").isModify(),o=n?this.config.SECURITY_TYPE.UNSECURITY:this.config.SECURITY_TYPE.SECURITY,s=this,i=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);if(""==e)return this._showErrorMsg("请输入账号"),void 0;if(0===t.length)return this._showErrorMsg("密码不能为空"),void 0;if(i!==!1&&i>=0&&o===this.config.SECURITY_TYPE.SECURITY);else{if(t.length<6||t.length>20)return this._showErrorMsg("密码长度不符（6-20位）"),!0;if(t.match(rConfig.user.passwordFilter))return this._showErrorMsg("密码必须为字母或数字"),!0}var r={account:e,password:t,accountType:0,rememberPassword:!0,isAutoLogin:!0,securityType:o},a=this._textLoading();this.controller.bindGuestAccount(r,this.controller.callBackMix(function(){s._hideLoading(a),s.redirectUrl?S.Url.redirect(s.redirectUrl):s.controller.sdkExit()},function(e){s._hideLoading(a),s._showErrorMsg(e.msg)}))},_textLoading:function(){var e=S.common.ui.NoticeBox.loading("loading_text");return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},bindReturn:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formalsignok_b"]),this.redirectUrl?S.Url.redirect(this.redirectUrl):this.controller.sdkExit()},_backButtonHandle:function(e){S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:e})},setAutoLoginStatus:function(){function e(){o.addClass("on"),$("#autoLoginNoti").html("关闭后每次进入游戏时可重新选择账号进行登录。")}function t(){o.removeClass("on"),$("#autoLoginNoti").html("开启后将自动使用最近登录的账号进入游戏。")}function n(e){e.msg&&s._showErrorMsg(e.msg)}var o=$("#autoLoginSwitch"),s=this;o.hasClass("on")?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_CloseAutoLogin_b","usercenter"]),this.controller.setAutoLoginState({isAutoLogin:!1},{success:t,error:n})):(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_OpenAutoLogin_b","usercenter"]),this.controller.setAutoLoginState({isAutoLogin:!0},{success:e,error:n}))},_getAccParent:function(e){var t=e;return t=t.data("account")?t:t.parent(),t=t.data("account")?t:t.parent(),t=t.data("account")?t:t.parent()},switAccHandler:function(e){if(this.editMode!==!0&&this._enableUserChange&&this._enableGotoStatus){var t=$(e.target),n=this,o=this._getAccParent(t),s=t.parent().data("account")||t.parent().parent().data("account")||t.parent().parent().parent().data("account");!s||$(".icon_st",o).length>0||(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ChangeAccount_w"]),this._confirm({title:'<div><center><p class="gr-f16">您要切换账号'+s+"登录？</p></center></div>",confirm:"确认",cancel:"取消"},function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ChangeAccountOK_b"]),S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT),n.controller.notifyCp({code:1,msg:"",account:s},{success:function(){n.controller.sdkExit()},error:function(){n._showErrorMsg("通知游戏失败")}},"logout")}))}},_confirm:function(e,t,n){$("body").addClass("btnClick-none"),sdk.common.ui.MsgBox.show(e.title,{confirmName:e.confirm||"确定",cancelName:e.cancel||"取消",callBack:function(){$("body").removeClass("btnClick-none"),sdk.common.ui.MsgBox.remove(),setTimeout(function(){t&&t()},10)},cancel:function(){$("body").removeClass("btnClick-none"),sdk.common.ui.MsgBox.remove(),setTimeout(function(){n&&n()},10)}},"confirm2",!0)}});S.SSVW.Vip=Backbone.View.extend({el:"#userContainer",events:{},initialize:function(){_.bindAll(this,"showVipArea")},showVipArea:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["vip"]})}});