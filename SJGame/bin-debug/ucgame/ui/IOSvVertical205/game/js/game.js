S.SSCL.Games=Backbone.Collection.extend({model:S.SSMO.Game,initialize:function(){_.bindAll(this,"parse")},parse:function(e){return e.data}});S.SSCT.Game=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},validate:function(e,t){this.validModel=S.SSCT.GetHandler("Model","ValidCode"),this.validModel.on("error",_.bind(function(e,n){t.error(n.msg||n),this.validModel.off("error")},this));var n=this.validModel.set({alphaCode:e});n&&this.validModel.validCode({alphaCode:e},{success:t.success,error:function(e,n){console.log("resp",n),t.error(n.msg)}})},getGameInfo:function(e){function t(t){o.gameId=t.data.gameId,o.gameInfo=t.data,e&&e.success&&e.success.apply(this,[t.data])}function n(t){e&&e.error&&e.error.apply(this,[t])}if(null==this.gameId){var o=this;S.sdkBase.request(this.servType.COMMON,this.actions.GET_GAME_INFO,{},t,n)}else _.isUndefined(e)||_.isUndefined(e.success)||!_.isFunction(e.success)||e.success.apply(this,[this.gameInfo])}});S.SSMO.Game=Backbone.Model.extend({initialize:function(){}});S.SSMO.ValidCode=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.VALID_CODE},validate:function(e){if(!this.isRequest){if(_.isUndefined(e.alphaCode)&&_.isEmpty(e.alphaCode))return"激活码不能为空";if(6!=e.alphaCode.length||e.alphaCode.match(/[^a-z0-9A-Z]+/))return"请输入正确的激活码"}this.isRequest=!1},validCode:function(e,t){this.save(e,t)},parse:function(e){return this.isRequest=!0,e.data}});S.SSVW.Game=Backbone.View.extend({el:"#gameContainer",events:{"onclick #bbsLink":"linkToBBS","onclick #gameCenterLink":"linkToGameCenter","onclick #confirmValidCode":"doConfirm","onclick #exitValidCode":"doExit","onclick #clearCode":"flushInpt","onclick #validCode":"_inputFocuse","focusout #validCode":"hideClrPass","onclick #toUserCenterLink":"gotoUserCenter"},isRandom:null,initialize:function(){_.bindAll(this),this.gameController=S.SSCT.GetHandler("Controller","Game")},notOpen:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_GAME,enterBusiness:["notOpen"]})},validCode:function(e){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_GAME,enterBusiness:["validateCode"]}),this.isRandom=_.isUndefined(e)||_.isEmpty(e)?"false":e,this.changeClrPass(),this.initLogoutBtn()},doConfirm:function(){var e=this,t=this.$el.find("#validCode").val(),n=S.SSCT.GetHandler("Controller","User");this.$el.find("#confirmValidCode").attr("disabled","disabled"),this.$el.find("#confirmValidCode").attr("data-disabled","true").addClass("ui-disabled"),this.gameController.validate(t,this.gameController.callBackMix(function(t,o){function i(){"true"===e.isRandom?sdk.Url.redirect("../user/user.html#!user/updatePassword/true"):n.notifyCp({code:o.code,msg:o.msg},n.callBackMix(n.sdkExit))}S.SSCT.GetHandler("Controller","User").getCurUserInfo({success:function(t){ucf.Cache.remove("isAlpha_"+t.ucid,!0),i.call(e)},error:function(){i.call(e)}})},function(t){e._showErrorMsg(t,"#validCodeNoticeBox"),e.$el.find("#confirmValidCode").removeAttr("disabled"),e.$el.find("#confirmValidCode").attr("data-disabled","").removeClass("ui-disabled")}))},doExit:function(){S.Log.pageClose(),S.SSCT.GetHandler("Controller","User").sdkExit()},flushInpt:function(){_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||sdk.common.ui.NoticeBox.hide(this.noticeBar,null,"slide"),this.$el.find("#validCode").val("")},changeClrPass:function(){_.isEmpty($("#validCode").val())?$("#clearValidCode").hide():$("#clearValidCode").show()},hideClrPass:function(){$("#clearValidCode").hide()},initLogoutBtn:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"logout"==e.action&&(S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT),S.SSCT.GetHandler("Controller","User").sdkExit())}})},linkToBBS:function(){var e=this;S.SSCT.GetHandler("Controller","General").getUrl("gameBbs",{success:function(e){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bbsClick"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["bbsClick"]),sdk.PageCache.set("sdk_redirect_out",1),S.Url.redirect(e)},error:function(t){e._showErrorMsg(t.msg)}})},linkToGameCenter:function(){sdk.Log.pageClose(sdk.Log.businesses.PAGE_GAME,["notOpen"]),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_GAME,["gameCenter"]),S.Url.redirect(eConfig.gameCenter)},_inputFocuse:function(){this.changeClrPass()},_showErrorMsg:function(e,t,n){S.SSCT.GetHandler("Controller","General").sendClientMsg(e),n&&n.apply()},gotoUserCenter:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ValidCode_to_UserCenter_l"],{callback:function(){S.Url.redirect("../user/user.html#!user")},quiet:!1})}});