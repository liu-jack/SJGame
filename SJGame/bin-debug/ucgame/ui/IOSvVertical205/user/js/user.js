S.SSCL.LoginHist=Backbone.Collection.extend({initialize:function(){_.bindAll(this)},getHistory:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.GET_LOGIN_HISTORY,this.fetch(e)},getServerHistory:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.QUERY_HISTORY,this.fetch(e)},parse:function(e){return e},clearHistory:function(){this.url=S.sdkBase.servType.APP+"/"+S.sdkBase.actions.CLEAR_HISTORY,this.fetch(options)}});S.SSCL.QuestionList=Backbone.Collection.extend({initialize:function(){_.bindAll(this)},getQuestionList:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_QUESTION_HISTORY,this.fetch(e)},parse:function(e){return e}});S.SSCT.AccountManage=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},getSecureState:function(e){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.getSecureState({success:function(t,n){console.log("getSecureState success : "+JSON.stringify(n)),e.success(n.data)},error:function(t,n){console.log("getSecureState error : "+JSON.stringify(n)),e.error(n.msg,n)},quiet:!0})},sendCode2Mobile:function(e,t){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.sendCodeToMobile({data:e,success:function(e,t){console.log("sendCodeToMobile success : "+JSON.stringify(t))},error:function(e,n){console.log("sendCodeToMobile error : "+JSON.stringify(n)),t.error(n.msg)},quiet:!0})},doBindMobile:function(e,t){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.bindMobile({data:e,success:function(e,n){console.log("bindMobile success : "+JSON.stringify(n)),t.success()},error:function(e,n){console.log("bindMobile error : "+JSON.stringify(n)),t.error(n)},quiet:!0})},checkIsBinded:function(e,t){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.checkIsBinded({data:e,success:function(e,n){console.log("checkIsBinded success : "+JSON.stringify(n)),t.success(n.data)},error:function(e,n){console.log("checkIsBinded error : "+JSON.stringify(n)),t.error(n.msg)},quiet:!0})},doSaveSecurityQuestions:function(e,t){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.saveSecurityQuestions({data:e,success:function(e,n){console.log("saveSecurityQuestions success : "+JSON.stringify(n)),t.success()},error:function(e,n){console.log("saveSecurityQuestions error : "+JSON.stringify(n)),t.error(n)},quiet:!0})}});S.SSCT.Secrecy=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},sendMsgToMobile:function(e,t){var n=S.SSCT.GetHandler("Model","Secrecy");n.changeUrl("sendMsgToMobile"),n.fetch({data:e,success:function(){var n=S.SSCT.GetHandler("Controller","General");n.setCacheData("phone",e.phone,1800,!0),t.success()},error:function(e,n){t.error(n.msg)},quiet:!0})},doBindMobile:function(e,t){var n=S.SSCT.GetHandler("Model","Secrecy");n.changeUrl("bindMobile"),n.fetch({data:e,success:function(){t.success()},error:function(e,n){t.error(n.msg)},quiet:!0})}});S.SSCT.Sso=Backbone.Controller.extend({initialize:function(){},CONFIG:{ACCOUNT_TYPE:{LOGIN:0,GAME_LOGIN:1}},histLength:{},serverHistLength:{},getHistLength:function(e){var t=this.histLength[e]?this.histLength[e]:0;return t},loginConfig:null,getLoginConfig:function(e){var t=this;this.loginConfig?e(this.loginConfig):this.getLoginData(this.callBackMix(function(n){t.loginConfig=n,e(n)}))},histories:{},getHistories:function(e){return this.histories[e]?this.histories[e]:null},setHistories:function(e,t){this.histories[e]=t},serverHistories:{},getServerHistories:function(e){return this.serverHistories[e]?this.serverHistories[e]:null},validLoginData:function(e,t,n,o){o=o?o:{},o.error=o.error?o.error:function(){},o.success=o.success?o.success:function(){};var i={};if(0===t.length)return i.msg="密码不能为空",i.code=102,o.error(i),void 0;if(0===e.length)return i.msg="账号不能为空",i.code=101,o.error(i),void 0;if(n===this.CONFIG.ACCOUNT_TYPE.LOGIN){if(e.length<2||e.length>20)return i.msg="账号长度必须在2到20位之间",i.code=103,o.error(i),void 0;if(!rConfig.user.accountFilter.test(e)&&!rConfig.user.emailAccountFilter.test(e))return i.msg="账号格式错误",i.code=104,o.error(i),void 0;if(t.length<6||t.length>20)return i.msg="密码长度必须在6到20位之间",i.code=105,o.error(i),void 0}o.success(e,t)},loginSubmit:function(e,t,n){n=n?n:{},n.error=n.error?n.error:function(){},n.success=n.success?n.success:function(){};var o=S.SSCT.GetHandler("Model","Sso");o.on("error",_.bind(function(e,t){n.error(e,{msg:t}),o.off("error")},this));var i=_.isUndefined(e.accountType)?0:e.accountType,r=_.isUndefined(e.rememberPassword)?!0:e.rememberPassword;e.accountType=i,e.rememberPassword=r;var s=o.set(e);s&&o.login({success:function(e,t){var o=S.SSCT.GetHandler("Controller","User");o.getCurUserInfo(),n.success(e,t)},error:function(e,t){n.error(e,t)},data:e,quiet:t})},getLoginData:function(e){var t=S.SSCT.GetHandler("Model","Sso");t.getLoginData({success:function(t,n){e.success&&e.success(n.data)},error:function(t,n){e.error&&e.error(n.msg||"获取登录配置失败")},quiet:!0})},getHistory:function(e,t,n){n=_.isUndefined(n)?!0:n,t=t?t:{};var o=S.SSCT.GetHandler("Collection","LoginHist"),i=this;o.getHistory({success:function(n,o){var r=o.data||[];i.histories[e]=r,i.histLength[e]=r.length,e===i.CONFIG.ACCOUNT_TYPE.LOGIN&&_.each(r,function(e){var t=ucf.Cache.get("user_info_"+e.account,!0);t&&(e.isRandomPassword=t.random)}),t.success&&t.success(r)},error:function(e,n){t.error&&t.error(n.msg)},data:{accountType:e},quiet:n})},getServerHistory:function(e,t){t=t?t:{};var n=S.SSCT.GetHandler("Collection","LoginHist"),o=this;return o.serverHistories[e]?(t.success&&t.success(o.serverHistories[e]),void 0):(n.getServerHistory({success:function(n,i){var r=i.data.uids;o.serverHistories[e]=r,o.serverHistLength[e]=r.length?r.length:0,e===o.CONFIG.ACCOUNT_TYPE.LOGIN&&_.each(r,function(e){var t=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+e.account,!0);t&&(e.isRandomPassword=t.random)}),t.success&&t.success(r)},error:function(e,n){t.error&&t.error(n.msg)},data:{accountType:e},quiet:!0}),void 0)},getHistByUsername:function(e,t,n){var o=null,i=this.histories[t];_.isUndefined(e)||_.isUndefined(i)||_.each(i,function(t){t.account==e&&(o=t)}),o?n.success&&n.success(o):n.error&&n.error("找不到匹配的用户账号")},clearHistFlag:function(e){function t(t){t.success&&1===t.data?S.SSCT.GetHandler("Collection","LoginHist").clearHistory({success:function(){sdk.PageCache.del("clear_history"),e.success&&e.success()},error:function(){e.error&&e.error("清除后退历史失败")},quiet:!0}):e.error&&e.error("不需要清除后退历史")}e=e?e:{},sdk.PageCache.get("clear_history",t)},getLoginCount:function(e){var t=ucf.Cache.get("login_count_info",!0)||{};return t[e]||0},updateLoginCount:function(e){var t=ucf.Cache.get("login_count_info",!0)||{},n=t[e]||0;10>n&&n++,t[e]=n,ucf.Cache.set("login_count_info",t,0,!0)},validSecrecy:function(e,t,n){var o=S.SSCT.GetHandler("Controller","AccountManage");o.getSecureState(o.callBackMix(function(e){e.risk>=3?n.success(e):n.error&&n.error("safe")},function(e,t){n.error&&n.error(e,t)}))},getGameNotice:function(e){e=e?e:{},e.error=e.error?e.error:function(){},e.success=e.success?e.success:function(){};var t=S.SSCT.GetHandler("Model","Sso");t.getGameNotice({success:function(t,n){var o,i,r=n.data.msgs;if(null==r)ucf.Cache.set("game_notice",{},0,!0);else if(o=r.length,0==o)ucf.Cache.set("game_notice",{},0,!0);else{i=r[0];for(var s=o-1;s>=0;s--)parseInt(r[s].priority)<parseInt(i.priority)&&(i=r[s]);ucf.Cache.set("game_notice",i,0,!0)}e.success(i)},error:function(t,n){ucf.Cache.set("game_notice",{},0,!0),e.error(n.msg)},data:{msgType:1},quiet:!0})}});S.SSCT.User=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},curUser:{},userName:"",getCurUser:function(){return this.curUser},setCurUser:function(e){this.curUser=e},getCurUserInfo:function(e){function t(t){o.curUser=t.data,e&&e.success&&e.success.apply(this,[t.data])}function n(t){e&&e.error&&e.error.apply(this,[t.msg])}var o=this;S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_CURR_USER,{},t,n,null,null,{quiet:!0})},getBaseUserInfo:function(e,t){e=e?e:{};var n=ucf.Cache.get("userBaseInfo_"+this.curUser.ucid,!0);if(_.isUndefined(n)||_.isEmpty(n)){var o=S.SSCT.GetHandler("Model","User");t=_.isUndefined(t)?!1:t,o.fetchBaseUserInfo({data:{uid:this.curUser.ucid},success:$.proxy(function(t){n=t.toJSON(),ucf.Cache.set("userBaseInfo_"+this.curUser.ucid,n,1800,!0),e.success&&e.success.apply(this,[n])},this),error:$.proxy(function(t,n){e.error&&e.error.apply(this,[n.msg])},this),quiet:t})}else e.success&&e.success.apply(this,[n])},updatePass:function(e,t){var n=t.success?t.success:function(){},o=t.error?t.error:function(){},i=S.SSCT.GetHandler("Model","User");i.off("error"),i.on("error",$.proxy(function(e,t){o.apply(this,[t])},this));var r=i.set(e);r&&i.updatePass({success:$.proxy(function(){this.getCurUserInfo(this.callBackMix(function(e){var t=ucf.Cache.get("user_info_"+e.ucid,!0);t&&t.random&&ucf.Cache.remove("user_info_"+e.ucid,!0)})),n()},this),error:$.proxy(function(e,t){o.apply(this,[t.msg])},this),data:e})},registerUpdatePass:function(e,t){var n=t.success?t.success:function(){},o=t.error?t.error:function(){},i=S.SSCT.GetHandler("Model","User");i.off("error"),i.on("error",$.proxy(function(e,t){o.apply(this,[t])},this));var r=i.set(e),s=this;r&&i.updatePass({success:$.proxy(function(){s.getCurUserInfo(s.callBackMix(function(t){s.setRegData(t.ucid,e.password),ucf.Cache.set("user_info_"+t.ucid,{random:!1,password:e.password},0,!0)})),n()},this),error:$.proxy(function(e,t){o.apply(this,[t.msg])},this),data:e})},register:function(e,t,n){t=t?t:{},n=_.isUndefined(n)?!1:n;var o=S.SSCT.GetHandler("Model","Register");o.off("error"),o.on("error",function(e,n){t.error(n)});var i=o.set(e),r=this;i&&o.register({data:e,success:function(e,n){r.setRegData(e.get("ucid"),e.get("password")),ucf.Cache.set("regUcid",e.get("ucid"),1800,!0),t.success(e,n)},error:function(e,n){t.error(n.msg)},quiet:n})},sdkExit:function(){S.SSCT.GetHandler("Controller","General").quietRequestSync(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGIN_EXIT_SDK)},getVipInfo:function(e,t){var n=S.SSCT.GetHandler("Model","Vip"),o=this;t=_.isUndefined(t)?!0:t,n.fetchVipInfo({success:function(t,n){"1"==n.data.privilegeStatus&&"1"==n.data.vipStatus?e.success&&e.success():e.error&&e.error("no vip privilege")},error:function(){e.error&&e.error("privilegeStatus or vipStatus exception!!")},data:{uid:o.curUser.ucid,privilegeCode:"0001",timestamp:Math.round((new Date).getTime()/1e3)},quiet:t})},notifyCp:function(e,t,n){var o=t&&t.success?t.success:function(){},i=t&&t.error?t.error:function(){},n=_.isUndefined(n)||_.isEmpty(n)?"login":n;switch(n){case"login":S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGIN_NOTIFY_CP,{code:e.code,msg:e.msg},o,i);break;case"logout":console.log("logout notifyCp"+JSON.stringify(e)),e&&(e.msg="注销成功"),S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT_NOTIFY_CP,e,o,i)}},setRegData:function(e,t){sdk.PageCache.set("regInfo",JSON.stringify({ucid:e,password:t}))},getRegData:function(e){function t(t){e&&(t.success?e.success&&!_.isEmpty(t.data)?e.success(JSON.parse(t.data)):e.error():e.error&&e.error())}sdk.PageCache.get("regInfo",t)},getFeatureSwitch:function(e){var t=e&&e.success?e.success:function(){},n=e&&e.error?e.error:function(){};S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_FEATURE_SWITCH,{},t,n)},logout:function(e){function t(){o.apply()}function n(){i.apply()}var o=e&&e.success?e.success:function(){},i=e&&e.error?e.error:function(){};S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT,{},t,n)},setNerverNotice:function(e,t,n){var o=ucf.Cache.get("nerver_notice_info",!0)||{};n=_.isUndefined(n)?"existAccount":n,o[e]=o[e]||{},o[e][n]=t,ucf.Cache.set("nerver_notice_info",o,0,!0)},checkNoticeInfo:function(e,t){var n=ucf.Cache.get("nerver_notice_info",!0)||{};return t=_.isUndefined(t)?"existAccount":t,n[e]=n[e]||{},n[e][t]?!0:!1},getSecQuestion:function(e,t){var n=S.SSCT.GetHandler("Model","User");return e&&0!==e?rConfig.user.accountFilter.test(e)?(n.getSecQuestion({data:{ucid:parseInt(e)},success:function(e,n){n.data?t.success&&t.success(n.data):t.error&&t.error(n.msg)},error:function(e,n){t.error&&t.error(n.msg)}}),void 0):(t.error&&t.error("UC账号必须为数字"),void 0):(t.error&&t.error("请输入UC账号"),void 0)},validateAnswer:function(e,t){var n=S.SSCT.GetHandler("Model","User");return e.password_answer&&0!==e.password_answer.length?(n.validateAnswer({data:e,success:function(e,n){t.success&&t.success(n)},error:function(e,n){t.error&&t.error(n.msg)}}),void 0):(t.error&&t.error("请输入密保问题答案"),void 0)},resetPassword:function(e,t){var n=S.SSCT.GetHandler("Model","User");return e.password.length<6||e.password.length>20?(t.error&&t.error("密码长度不符（6-20位）"),void 0):e.password.match(rConfig.user.passwordFilter)?(t.error&&t.error("密码必须为字母或数字"),void 0):(n.resetPassword({data:e,success:function(n,o){var i=ucf.Cache.get("user_info_"+e.ucid,!0);i&&i.random&&ucf.Cache.remove("user_info_"+e.ucid,!0),t.success&&t.success(o.data)},error:function(e,n){t.error&&t.error(n.msg)}}),void 0)},updateNickname:function(e,t){var n=t.success?t.success:function(){},o=t.error?t.error:function(){},i=S.SSCT.GetHandler("Model","User"),r=this;i.off("error"),i.on("error",$.proxy(function(e,t){o.apply(this,[t])},this));var s=i.set(e);s&&i.updateNickname({success:function(){r.getCurUserInfo(r.callBackMix(function(t){var o=ucf.Cache.get("userBaseInfo_"+t.ucid,!0);o&&ucf.Cache.remove("userBaseInfo_"+t.ucid,!0),r.userName=e.userName,n()}))},error:$.proxy(function(e,t){o.apply(this,[t.msg])},this),data:e})},removeHistory:function(e,t){var n=S.SSCT.GetHandler("Model","User");n.removeHistory({data:e,success:function(){t.success()},error:function(e,n){t.error&&t.error(n.msg)},quiet:!0})},getLoginHistoryCount:function(e,t){var n=S.SSCT.GetHandler("Model","User");n.getLoginHistoryCount({data:e,success:function(e,n){t.success&&t.success(n.data)},error:function(e,n){t.error&&t.error(n.msg)},quiet:!0})},registerGuestAccount:function(e,t){var n=S.SSCT.GetHandler("Model","User");n.registerGuestAccount({data:e,success:function(e,n){t.success&&t.success(n)},error:function(e,n){t.error&&t.error(n)},quiet:!1})},bindGuestAccount:function(e,t){var n=S.SSCT.GetHandler("Model","User");n.bindGuestAccount({data:e,success:function(e,n){t.success&&t.success(n)},error:function(e,n){t.error&&t.error(n)},quiet:!1})},setAutoLoginState:function(e,t){var n=S.SSCT.GetHandler("Model","User");n.setAutoLoginState({data:e,success:function(e,n){t.success&&t.success(n.data)},error:function(e,n){t.error&&t.error(n)},quiet:!0})},getAccountInfoByLoginName:function(e,t){var n=S.SSCT.GetHandler("Model","User");n.getAccountInfoByLoginName({data:{loginName:e},success:function(e,n){t.success&&t.success(n.data)},error:function(e,n){t.error&&t.error(n)},quiet:!1})},validMsgRetakeAccount:function(e,t){var n="";_.isEmpty(e)?(n="账号不为空",t.error(n)):e.length<2||e.length>20?(n="账号长度必须在2到20位之间",t.error(n)):rConfig.user.accountFilter.test(e)||rConfig.user.emailAccountFilter.test(e)?t.success():(n="账号格式错误",t.error(n))}});S.SSCT.Pay=Backbone.Controller.extend({getUPointBalance:function(e){var t=e&&e.success?e.success:function(){},n=e&&e.error?e.error:function(){},o=S.SSCT.GetHandler("Model","UPoint");o.fetchUPoint({success:t,error:n,data:null,quiet:!0})}});S.SSMO.Register=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.isRequest=!1},validate:function(e){if(!this.isRequest){if(_.isEmpty(e.password))return"密码不能为空，请重新输入";if(e.password.length<6||e.password.length>20)return"密码长度为6-20位";if(e.password.match(rConfig.user.passwordFilter))return"密码只能为英文字母和数字，请重新输入";if(!e.agree)return"不同意UC账号服务协议无法注册哦^-^"}this.isRequest=!1},register:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.REGISTER,this.fetch(e)},parse:function(e){return this.isRequest=!0,e.data}});S.SSMO.Secrecy=Backbone.Model.extend({initialize:function(){_.bindAll(this)},validate:function(e){console.log(e),null===e.mobile&&alert("not null")},validateMobile:function(e){return null===e.match(rConfig.user.mobileFilter)?{msg:"手机号码必须为数字",success:!1}:11!==e.length||"1"!==e[0]?{msg:"手机号码输入错误",success:!1}:{msg:"success",success:!0}},validateCode:function(e){return null==e||""==e?{msg:"验证码不能为空",success:!1}:{msg:"success",success:!0}},validateQuestions:function(e){return e.length<2||e.length>20?{msg:"密保问题长度必须在2~20位之间",success:!1}:{msg:"success",success:!0}},validateQuestionAnswers:function(e){return e.length<2||e.length>20?{msg:"密保答案长度必须在2~20位之间",success:!1}:{msg:"success",success:!0}},validatePassword:function(e){return e.length<6||e.length>20?{msg:"密码长度必须在6~20位之间",success:!1}:e.match(rConfig.user.passwordFilter)?{msg:"密码只能为英文字母和数字，请重新输入",success:!1}:{msg:"success",success:!0}},parse:function(e){return e.data},getSecureState:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_QUERYSECURESTATE,this.fetch(e)},sendCodeToMobile:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_SENDMOBILESMSCODE,this.fetch(e)},bindMobile:function(e){var t=this.validateCode(e.data.code),n=this.validatePassword(e.data.password);t.success?n.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_BINDMOBILEBYSMSCODE,this.fetch(e)):e.error(this,n):e.error(this,t)},checkIsBinded:function(e){var t=this.validateMobile(e.data.mobile);t.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_CHECKISBINDED,this.fetch(e)):e.error(this,t)},saveSecurityQuestions:function(e){var t=this.validateQuestions(e.data.password_question),n=this.validateQuestionAnswers(e.data.password_answer),o=this.validatePassword(e.data.password);t.success?n.success?o.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_SETPASSWORDQUESTION,this.fetch(e)):e.error(this,o):e.error(this,n):e.error(this,t)}});S.SSMO.Sso=Backbone.Model.extend({defaults:{rememberPassword:!0},initialize:function(){_.bindAll(this)},login:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.LOGIN,this.fetch(e)},parse:function(e){this.isRequest=!0;var t=e.data||e;return t},getGameNotice:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_GAMENOTICE,this.fetch(e)},getLoginData:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.GET_LOGIN_CONFIG,this.fetch(e)}});S.SSMO.User=Backbone.Model.extend({initialize:function(){_.bindAll(this)},fetchBaseUserInfo:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.USER_BASEINFO,this.fetch(e)},updatePass:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.CHANGE_PASSWORD,this.fetch(e)},validate:function(e){if(_.isUndefined(e.isPostDetail)){if(!_.isUndefined(e.isPostPass)){if(e.password.length<6||e.password.length>20)return"密码长度不符（6-20位）";if(e.password.match(rConfig.user.passwordFilter))return"密码必须为字母或数字";if(e.oldPassword.length<6||e.oldPassword.length>20)return"密码长度不符（6-20位）";if(e.oldPassword.match(rConfig.user.passwordFilter))return"密码必须为字母或数字"}}else;},parse:function(e){return e.data},getSecQuestion:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.SECURITY_QUESTION,this.fetch(e)},validateAnswer:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.VALIDATE_ANSWER,this.fetch(e)},resetPassword:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.RESET_PASSWORD,this.fetch(e)},removeHistory:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.DELETE_LOGIN_HISTORY,this.fetch(e)},updateNickname:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UPDATE_NICKNAME,this.fetch(e)},getLoginHistoryCount:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.GET_LOGIN_HISTORY_COUNT,this.fetch(e)},registerGuestAccount:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.REGISTER_GUEST,this.fetch(e)},bindGuestAccount:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.ACTIVATE_GUEST,this.fetch(e)},logout:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.LOGOUT,this.fetch(e)},setAutoLoginState:function(e){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.SET_AUTO_LOGIN_STATE,this.fetch(e)},getAccountInfoByLoginName:function(e){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_ACCOUNT_INFO,this.fetch(e)}});S.SSMO.Vip=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.VIP},fetchVipInfo:function(e){this.fetch(e)},parse:function(e){return e.data}});S.SSMO.UPoint=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UPOINT_BALANCE},fetchUPoint:function(e){this.fetch(e)},parse:function(e){var t=e.data;return t}});S.SSVW.FindPassword=Backbone.View.extend({el:"#userContainer",events:{"onclick #sendCmccMessageBtn":"sendCmccMessage","onclick #sendUnicomMessageBtn":"sendUnicomMessage","onclick #validAccountBtn":"validAccount","onclick #secAnswerSubBtn":"secAnswerSubmit","onclick #newPasswordSubBtn":"newPasswordSubmit","onclick #appealSubBtn":"appealSubmit","onclick #needResetPassword":"checkedNeedResetPassword","onclick #messageRetakeBtn":"retakeMethod","onclick #secAnswerRetakeBtn":"retakeMethod","onclick #appealRetakeBtn":"retakeMethod","onclick #toAppealRetakeBtn":"toAppealRetake","onclick #toAppealRetakeByIdBtn":"toAppealRetakeByTabId","onclick #resetPassReturnGameBtn":"returnGame","onclick #accountList > .ac-item":"retakeAccount","onclick #validMsgRetakeAccBtn":"validMsgRetakeAcc"},local:{defaultTab:"messageRetake",tabs:["messageRetake","secAnswerRetake","appealRetake"]},initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","User"),this.ssoController=S.SSCT.GetHandler("Controller","Sso"),this.generalController=S.SSCT.GetHandler("Controller","General")},sendCmccMessage:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwphone_b"]);var e=this;this.generalController.smsSendMessage("cmcc",{error:function(t){e._showErrorMsg(t.msg)}})},sendUnicomMessage:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwphone_b"]);var e=this;this.generalController.smsSendMessage("unicom",{error:function(t){e._showErrorMsg(t.msg)}})},secAnswerRetake:function(){},validAccount:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwquestioncode_b"]);var e=$("#ucAccount").val(),t=document.createElement("div");document.body.appendChild(t);var n=this;this.controller.getSecQuestion(e,this.controller.callBackMix(function(o){return document.body.removeChild(t),o.password_question?(sdk.PageCache.set("account_security_question",{account:e,question:o.password_question}),sdk.Url.location.route("#!findPassword/securityAnswer"),void 0):(n._showErrorMsg("获取密保问题失败"),void 0)},function(e){document.body.removeChild(t),n._showErrorMsg(e)}))},validMsgRetakeAcc:function(){var e=$("#validMsgRetakeAccInp").val(),t=this;t.controller.validMsgRetakeAccount(e,{success:function(){t.controller.getAccountInfoByLoginName(e,{success:function(e){var n=e.mobile;_.isEmpty(n)?t._showErrorMsg("该账号未绑定任何手机"):t.showMsgRetakeCon(n)},error:function(e){t._showErrorMsg(e.msg)}})},error:function(e){t._showErrorMsg(e)}})},showMsgRetakeCon:function(e){$("#bindedNumber").html(e),$("#beforeMsgRetakeCon").addClass("ms-none"),$("#msgRetakeCon").removeClass("ms-none")},securityAnswer:function(){function e(e){e.success&&e.data&&($("#question").html(e.data.question),$("#question").attr("data-value",e.data.question),$("#ucAccount").html(e.data.account),$("#ucAccount").attr("data-value",e.data.account))}sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5_fpwquestion_p"]),sdk.PageCache.get("account_security_question",e)},secAnswerSubmit:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwquestion_b"]);var e=$("#securityAnswer").val(),t=$("#question").attr("data-value"),n=$("#ucAccount").attr("data-value"),o=this;this.controller.validateAnswer({ucid:parseInt(n,10),password_question:t,password_answer:e},this.controller.callBackMix(function(){sdk.PageCache.set("account_resetPassword_params",{account:n,question:t,answer:e}),sdk.Url.location.route("#!findPassword/resetPassword/"+n)},function(e){console.log(e),o._showErrorMsg(e)}))},resetPassword:function(e){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5_fpwmodifypw_p"]),$("#resetPassAccount").attr("data-value",e)},newPasswordSubmit:function(){function e(e){if(e.success&&e.data){var i=e.data;o.controller.resetPassword({ucid:parseInt(n,10),password_question:i.question,password_answer:i.answer,password:t},o.controller.callBackMix(function(){$("#successBox").showPopbox()},function(e){o._showErrorMsg(e)}))}}var t=$("#newPassword").val(),n=$("#resetPassAccount").attr("data-value"),o=this;sdk.PageCache.get("account_resetPassword_params",e)},appealSubmit:function(){var e=$("#server").val(),t=$("#contact").val(),n="checked"===$("#needResetPassword").attr("data-checked")?!0:!1;console.log("server : ["+e+"]  contact : ["+t+"] reset : ["+n+"]")},appealSuccess:function(){},passwordRetake:function(e){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["forgetPassword"]);var t,n=this;if(S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"backToLogin"==e.action&&(t=!0,S.Url.location.route("#!sso/login"),n.generalController.quietRequestSync(S.sdkBase.servType.APP,S.sdkBase.actions.CLEAR_HISTORY))}}),t!==!0){var o=rConfig.ACCOUNT_TYPE.UC,i=this.tabType||e||this.local.defaultTab;this.showRetakePageByTab(i);var s=this;this.ssoController.getServerHistory(o,this.ssoController.callBackMix(function(e){var t="";e.length>0?($("#accountList").removeClass("ms-none"),$("#hasAccount").html("曾在本机登录过的UC账号："),_.each(e,function(e){var n="";e.loginTime&&(n=e.loginTime),t+='<div class="ac-item" data-account='+e.ucid+" data-password="+e.password+">"+'<em class="em_arrow">&nbsp;</em>UC账号：'+e.ucid+"<br />最近登录时间："+n+"</div>"}),$("#accountList").html(t)):$("#hasAccount").html("！没有在本机登录过UC账号")},function(e){console.log(e),s._showErrorMsg(e)}))}},getInfoByAccount:function(e){if(!e)return null;var t=null;return _.each(this.ssoController.getServerHistories(rConfig.ACCOUNT_TYPE.UC),function(n){n.account==e&&(t=n)}),t},retakeMethod:function(e){var t=e.target,n=$(t).attr("data-retake");n&&this.showRetakePageByTab(n)},showRetakePageByTab:function(e){this.tabType=e;var t=this.local.tabs;_.each(t,function(t){t!==e&&($("#"+t).addClass("ms-none"),$("."+t).suiOff())}),$("#"+e).removeClass("ms-none"),$("."+e).suiOn()},checkedNeedResetPassword:function(){var e=$("#needResetPassword");"checked"===e.attr("data-checked")?(e.attr("data-checked",""),e.removeClass("cbbg")):(e.attr("data-checked","checked"),e.addClass("cbbg"))},toAppealRetake:function(){this.tabType="appealRetake",sdk.Url.location.route("#!findPassword/passwordRetake/appealRetake")},toAppealRetakeByTabId:function(){this.showRetakePageByTab("appealRetake")},retakeAccount:function(e){if($(e.target).hasClass("ac-item")){var t=$(e.target).attr("data-account");$(e.target).attr("data-password"),sdk.Url.location.route("#!sso/login/"+t)}},returnGame:function(){var e=$("#newPassword").val(),t=$("#resetPassAccount").attr("data-value");sdk.PageCache.set("auto_login_info",{account:t,password:e}),sdk.Url.location.route("#!sso/login/"+t),this.generalController.clearHistory()},_showErrorMsg:function(e){this.generalController.sendClientMsg(e)},flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||sdk.common.ui.NoticeBox.hide(this.noticeBar,null,"slide")}});S.SSVW.Register=Backbone.View.extend({el:"#userContainer",events:{"onclick #regReturnGameBtn":"returnGame","onclick #modifyPassBtn":"modifyPassword","onclick #modifyPassMask":"closeModifyPassword","onclick #cancelModifyBtn":"closeModifyPassword","onclick #doModifyBtn":"doModifyPassword","onclick #regBindBtn":"gotoBind","onclick #agreementBtn":"gotoAgreement"},isOpenModifyWindow:!1,initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","User"),this.generalController=S.SSCT.GetHandler("Controller","General"),this.ssoController=S.SSCT.GetHandler("Controller","Sso")},regSuccess:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["registerSuccess"]});var e=this;this.controller.getRegData(this.controller.callBackMix(function(t){e.ssoController.updateLoginCount(t.ucid);var n=e.generalController.getCacheData("user_info_"+t.ucid);n&&!1===n.random&&$("#passwordName").html("密码:"),$("#regTitle").html("成功注册UC账号"),$("#regMsg1").html("UC账号："+t.ucid),$("#regUcAccount").attr("data-account",t.ucid).html(t.ucid),$("#regPassword").attr("data-password",t.password).html(t.password)},function(){sdk.Url.back()}))},modifyPassword:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signmodifypw_b"]),$("#newPassword").val(""),this.hideFeedBack(),this.isOpenModifyWindow=!0,$("#modifyPassWin").suiShow(),$("#modifyPassWin").data("cancel","false"),setTimeout(function(){$("#modifyPassWin").data("cancel","true")},350)},closeModifyPassword:function(){this.isOpenModifyWindow&&($("#modifyPassWin").suiHide(),$(".btnClick-none").removeClass("btnClick-none"),$(window).off("resize"))},doModifyPassword:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signmodifypwok_b"]);var e=$("#newPassword").val(),t=$("#regPassword").html(),n=$(t);n.html()?t=n.html():"";var o={isPostPass:!0,oldPassword:t,password:e},i=this;this.controller.registerUpdatePass(o,this.controller.callBackMix(function(){i.generalController.sendClientMsg("修改成功"),$("#passwordName").html("密码:"),$("#regPassword").html(e),i.closeModifyPassword()},function(e){i.generalController.sendClientMsg(e)}))},returnGame:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signgame_b"]);var e=this;this.controller.getRegData(this.controller.callBackMix(function(t){var n=ucf.Cache.get("openTestGame_"+t.ucid,!0),o=ucf.Cache.get("isAlpha_"+t.ucid,!0);return n&&n.status&&"B"==n.status?(window.cordova=null,sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(n.message)),void 0):o?(window.cordova=null,sdk.Url.redirect("../game/game.html#!game/validCode/false"),void 0):(e.controller.notifyCp({code:1,msg:"操作"},e.controller.callBackMix(e.controller.sdkExit)),void 0)},function(){sdk.Url.back()}))},gotoBind:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signbindphone_b"]),S.Url.location.route("#!secrecy/preBind/signpage")},gotoAgreement:function(){S.Url.location.route("#!user/agreement")},flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val("")},_showLoading:function(){var e=S.common.ui.NoticeBox.loading();return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},hideFeedBack:function(){$("input").addClass("btnClick-none")}});S.SSVW.Secrecy=Backbone.View.extend({el:"#userContainer",controller:null,config:{btnLockTime:59,questionList:["我曾就读的小学校名？","刻骨铭心的6位数字？","我的心愿是？","我的爱好是？","最难忘那年那月那日？","最喜欢的一句话是？","我最关注的是什么？","最想要的物品名称？"],sourcePage:{USER:"usercenter",BIND:"ucidbindpag",REGISTER:"signpage",LOGIN:"loginpage",TIPS:"tips"}},events:{"onclick #toBindPageBtn":"toBindPage","onclick #doBindBtn":"doBind","onclick #resendBtn":"reSendMsg","onclick #cancelIbbBtn":"cancelIbb","onclick #keepBindBtn":"keepBind","onclick #toGameBtn":"doBindSuccess","onclick #toSetQuestionsBtn":"toSetQuestions","change  #questionList":"selQuestion","onclick #saveSecurityBtn":"saveSecurityQuestions","input #bindPass":"hideRandomPassNotice"},initialize:function(){_.bindAll(this),this.controller=this.controller?this.controller:S.SSCT.GetHandler("Controller","AccountManage"),this.generalController=S.SSCT.GetHandler("Controller","General")},toBindPage:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphonecode_b"]),this.hideFeedBack("#toBindPageBtn");var e=$("#mobile").val(),t={mobile:e},n=this._showLoading(),o=this;this.controller.checkIsBinded(t,this.controller.callBackMix(function(e){o._hideLoading(n),ucf.Cache.set("mobile",$("#mobile").val(),10800,!0),e.ucid?(o.beforeBoxShowed(),o._showBindBox()):o.setRouteType("#!secrecy/bind")},function(e){o._hideLoading(n),o._showErrorMsg(e),console.log("checkIsBinded error : "+e)}))},_showBindBox:function(){this._hideLinkEffect(["cancelIbbBtn","keepBindBtn"]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphonebind_w"]),$("#isBindBox").suiShow()},doBind:function(){this.hideFeedBack("#doBindBtn");var e={code:$("#validCode").val(),password:$("#bindPass").val()},t=this._showLoading(),n=this;this.controller.doBindMobile(e,this.controller.callBackMix(function(){function e(e){var t=e.ucid,o=ucf.Cache.get("mobile",!0);n._showBindSuccessBox({ucid:t,mobile:o})}n._hideLoading(t),n.beforeBoxShowed();var o=n.getUserInfo();_.isEmpty(o)?S.SSCT.GetHandler("Controller","User").getCurUserInfo({success:function(t){e(t)}}):e(o)},function(e){n._hideLoading(t),101==e.code&&$("#bindPass").val(""),n._showErrorMsg(e.msg)}))},_showBindSuccessBox:function(e){this._hideLinkEffect("toGameBtn"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphoneok_w"]),$("#bindSuccessBox").html("<p>UC账号:<em>"+e.ucid+"</em></p>"+"<p>手机号:<em>"+e.mobile+"</em></p>"+"<p>已成功绑定</p>"),this.enterType===this.config.sourcePage.USER&&$("#toGameBtn").val("完成"),$("#toGameBox").suiShow()},reSendMsg:function(){$("#resendBtn").hasClass("clickAble")&&this.sendMsg()},cancelIbb:function(){sdk.EC.showInput(),this.hideFeedBack("#cancelIbbBtn");var e=this;setTimeout(function(){e.addFeedBack("#cancelIbbBtn")},500),this.addFeedBack("#toBindPageBtn"),$("#isBindBox").suiHide()},keepBind:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphonebind_b"]),this.cancelIbb(),S.SSCT.GetHandler("Controller","General"),this.setRouteType("#!secrecy/bind")},doBindSuccess:function(){this.hideFeedBack("#toGameBtn");var e=this;setTimeout(function(){e.addFeedBack("#toGameBtn")},500),this.addFeedBack("#doBindBtn"),this.cancelTgb(),this.enterType===this.config.sourcePage.USER?(S.Url.location.route("#!user"),this.generalController.clearHistory()):this.toGame()},toSetQuestions:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsquestion_l"]),this.setRouteType("#!secrecy/securityQuestions")},selQuestion:function(){var e=document.querySelector("#questionList"),t=e.options[e.selectedIndex],n=t.value;"-1"!=n&&""!=n&&("0"==n?$("#passwordQuestion").val(""):$("#passwordQuestion").val(n))},saveSecurityQuestions:function(){this.hideFeedBack("#saveSecurityBtn");var e={password_question:$("#passwordQuestion").val(),password_answer:$("#passwordAnswer").val(),password:$("#questionPass").val()},t=this._showLoading(),n=this;this.controller.doSaveSecurityQuestions(e,this.controller.callBackMix(function(){function e(e){var t=e.ucid;n._showQuestionBindSuccessBox({ucid:t})}n._hideLoading(t),n.beforeBoxShowed();var o=n.getUserInfo();_.isEmpty(o)?S.SSCT.GetHandler("Controller","User").getCurUserInfo({success:function(t){e(t)}}):e(o)},function(e){n._hideLoading(t),101==e.code&&$("#questionPass").val(""),n._showErrorMsg(e.msg)}))},_showQuestionBindSuccessBox:function(e){this._hideLinkEffect("toGameBtn"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsquestion_w"]),$("#saveSuccessBox").html("<p>UC账号:<em>"+e.ucid+"</em></p>"+"<p>成功设置密保问题</p>"),this.enterType===this.config.sourcePage.USER&&$("#toGameBtn").val("完成"),$("#toGameBox").suiShow()},initBackBtnEvent:function(){var e=this;S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(t){"sdBackGame"==t.action&&e.toGame()}})},toGame:function(){function e(e){var n=e.ucid,o=ucf.Cache.get("openTestGame_"+n,!0),i=ucf.Cache.get("isAlpha_"+n,!0);if(o&&o.status&&"B"==o.status)window.cordova=null,sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(o.message));else if(i)window.cordova=null,sdk.Url.redirect("../game/game.html#!game/validCode/false");else{S.Log.pageClose();var s=S.SSCT.GetHandler("Controller","User");t.enterType!==t.config.sourcePage.TIPS&&s.notifyCp({code:1,msg:"操作"}),s.sdkExit()}}var t=this,n=this.getUserInfo();_.isEmpty(n)?S.SSCT.GetHandler("Controller","User").getCurUserInfo({success:function(t){e(t)}}):e(n)},_parseUrl:function(e){if(_.isEmpty(e))return{};var t=e.replace(/^\?/,"").split("&"),n={};return _.each(t,function(e){var t=e.split("="),o=t[0],i=t[1];n[o]=i}),n},preBind:function(e){var t;if("tips"===e){var n=this._parseUrl(window.location.search),o=n.source;t=["preBind",e],_.isEmpty(o)||t.push(o)}this.enterType=e,t=t||["preBind",this.enterType],S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:t}),_.isUndefined($("#mobile").val())||""==$("#mobile").val()||$("#mobile").val(""),this.initBackBtnEvent()},bind:function(){function e(e){var t=e.ucid;if(_.isUndefined($("#validCode").val())||""==$("#validCode").val()||$("#validCode").val(""),_.isUndefined($("#bindPass").val())||""==$("#bindPass").val()||$("#bindPass").val(""),e.isRandomPassword)$("#bindPass").val(e.randomPassword),o.showRandomPassNotice();else{var i=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+t,!0);i&&i.random&&($("#bindPass").val(i.password),o.showRandomPassNotice())}$("#bindInfo").html('<p class="flb-box"><span class="size-w90 tr flb-chi">UC账号:</span><em class="gr-ml10 flb-chi flb-p1"> '+t+"</em></p>"+'<p class="flb-box"><span class="size-w90 tr flb-chi">待绑定手机:</span><em class="gr-ml10 flb-chi flb-p1"> '+n+"</em></p>"),o.initBackBtnEvent(),o.sendMsg()}S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["bind"]});var t=S.SSCT.GetHandler("Controller","General"),n=t.getCacheData("mobile",!0),o=this,i=this.getUserInfo();_.isEmpty(i)?S.SSCT.GetHandler("Controller","User").getCurUserInfo({success:function(t){e(t)}}):e(i)},securityQuestions:function(e){this.enterType=e;var t=S.SSCT.GetHandler("Controller","User"),n=this;t.getCurUserInfo(t.callBackMix(function(e){var t=e.ucid;if($("#uc_account").html("UC账号：<em>"+t+"</em>"),n.initQuestionList(),$("#passwordQuestion").val(n.config.questionList[0]),_.isUndefined($("#passwordAnswer").val())||""==$("#passwordAnswer").val()||$("#passwordAnswer").val(""),e.isRandomPassword)$("#questionPass").val(e.randomPassword);else{var o=ucf.Cache.get("user_info_"+t,!0);o&&o.random&&$("#questionPass").val(o.password)}n.initBackBtnEvent()}))},sendMsg:function(){this.btnCountDown();var e=S.SSCT.GetHandler("Controller","General"),t=e.getCacheData("mobile",!0),n={mobile:t},o=this;this.controller.sendCode2Mobile(n,this.controller.callBackMix(null,function(e){o.cancelBtnCountDown(),o._showErrorMsg("发送验证码失败: "+e)}))},cancelTgb:function(){sdk.EC.showInput(),$("#toGameBox").suiHide()},btnCountDown:function(){"undefined"!=typeof secrecyTimeId&&null!=secrecyTimeId&&(clearInterval(secrecyTimeId),secrecyTimeId=null);var e=this.config.btnLockTime,t=this;$("#resendBtn").val(e+" 重新获取").removeClass("clickAble").disabled(),secrecyTimeId=setInterval(function(){--e<0?t.cancelBtnCountDown():$("#resendBtn").val(e+" 重新获取").disabled()},1e3)},cancelBtnCountDown:function(){clearInterval(secrecyTimeId),secrecyTimeId=null,$("#resendBtn").val("重新获取").addClass("clickAble").enabled()},_flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),this._hideErrorMsg()},getUserInfo:function(){var e=e?e:S.SSCT.GetHandler("Controller","User"),t=e.getCurUser();return t},initQuestionList:function(){var e='<option value="-1">请选择密保问题</option>';this.config.questionList.map(function(t){e+="<option value="+t+">"+t+"</option>"}),e+='<option value="0">自定义问题</option>',$("#questionList").html(e)},beforeBoxShowed:function(){$("#modifyPassMask").height($(window).height()+100),$(window).on("resize",function(){$("#modifyPassMask").height($(window).height()+100)}),_.delay(function(){sdk.EC.hideInput()},50)},setRouteType:function(e){var t=this.enterType||"";S.Url.location.route(e+"/"+t)},_showErrorMsg:function(e){var t=S.SSCT.GetHandler("Controller","General");t.sendClientMsg(e)},_hideErrorMsg:function(e){e=_.isUndefined(e)||_.isEmpty(e)?"slide":e,_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||("remove"==e?S.common.ui.NoticeBox.hide(this.noticeBar,null,"remove"):S.common.ui.NoticeBox.hide(this.noticeBar,null,"slide"))},_showLoading:function(){var e=S.common.ui.NoticeBox.loading();return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},hideFeedBack:function(e){$(e).addClass("btnClick-none")},addFeedBack:function(e){$(e).removeClass("btnClick-none")},hideRandomPassNotice:function(){$("#randomPassNotice").addClass("ms-vshid")},showRandomPassNotice:function(){$("#randomPassNotice").removeClass("ms-vshid")}});S.SSVW.Sso=Backbone.View.extend({el:"#userContainer",events:{"onclick #loginBut":"loginSubmit","onclick #registerBut":"register","onclick #forgetPassBtn":"forgetPassword","onclick #mobileBindingBtn":"bindMobile","onclick #returnGameBtn":"returnGame","onclick #gameLoginBtn":"gotoGameLogin","onclick #backBtn":"goBack","onclick #modifyAndLoginBtn":"loginPageModifyAndLogin","onclick #bindModifyAndLoginBtn":"bindModifyAndLogin","onclick #useUCAccountLogin":"useUCAccountLogin","onclick #isNerverNotice":"checkNerverNotice","change #loginHistory":"selectHis","onclick #updatePassBtn":"_setUpdatePassParam","onclick #cancelLogin":"cancelUCAccountLogin","onclick #neverUpdateBtn":"neverUpdatePass","onclick #cancelModify":"cancelModify","onclick #agreementBtn":"gotoAgreement","onclick #loginHistory":"logHist","onclick #closeNotice":"closeNotice","onclick #noticeBtn":"showNotice","onclick #autoLoginCheckboxWrap":"setAccAutoLogin"},showHistoryFlag:!1,accountType:0,historyScroll:null,noticeId:"",localConfig:{HISTORY_LIST_MAX_SIZE:10,LOGIN_COUNT:5},loginLoadingEl:{},initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","Sso"),this.userController=S.SSCT.GetHandler("Controller","User"),this.generalController=S.SSCT.GetHandler("Controller","General"),this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.LOGIN},closeNotice:function(){setTimeout($.proxy(function(){this.$el.find("#notice").addClass("ms-ni"),this._showLinkEffect()},this),300)},showNotice:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_LoginNotice_l",this.noticeId]),this.$el.find("#notice").removeClass("ms-ni"),this._hideLinkEffect("closeNotice")},login:function(e){function t(e){var t=e.allowGameLogin,n=e.gameAccountTitle,o=e.isAutoLogin;n=_.isUndefined(n)||null===n||0===n.length?rConfig.user.defaultGameName:n,$("#gameLoginBtn").html(n+"老账号登录"),t===!0&&$("#gameLoginBtn").removeClass("ms-none"),o===!1&&$("#autoLoginCheckbox").suiOff()}function n(){s?i._setHistory(s):i._setHistory()}S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["sso"]});var o=ucf.Cache.get("game_notice",!0)||{};_.isUndefined(o.content)||(this.$el.find("#noticeBtn").html(o.content),this.$el.find("#noticeBtn").removeClass("ms-ni"),this.$el.find("#noticeTtl").html(o.content),this.$el.find("#noticeWrapper").html(o.contentDetail),this.noticeId=o.msgId,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_LoginNotice_p",o.msgId]));var i=this;this.controller.getGameNotice({success:function(e){_.isUndefined(e)||(_.isUndefined(o.content)||0==parseInt(e.priority))&&(i.$el.find("#noticeBtn").html(e.content),i.$el.find("#noticeBtn").removeClass("ms-ni"),i.$el.find("#noticeTtl").html(e.content),i.$el.find("#noticeWrapper").html(e.contentDetail),i.noticeId=e.msgId,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_LoginNotice_p",e.msgId]))},error:function(){}});var s=e,i=this;this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.LOGIN,this.controller.clearHistFlag(),$("#autoLoginCheckbox").suiOn(),this.versionFixing(),this.controller.getLoginConfig(t),sdk.PageCache.get("auto_login_info",function(e){sdk.PageCache.del("auto_login_info"),e&&e.success&&e.data?i._setHistory(e.data.account,e.data.password):n()},function(){sdk.PageCache.del("auto_login_info"),n()}),$("#username").attr("placeholder","UC账号\\手机"),$("#registerBut").val("一键注册"),$("#forgetPassBtn").removeClass("ms-ni"),$("#gameLoginBottom").addClass("ms-ni"),$("#normalLoginBottom").removeClass("ms-ni")},gameLogin:function(){function e(e){var n=e.gameAccountTitle,o=e.isAutoLogin;n=_.isUndefined(n)||null===n||0===n.length?rConfig.user.defaultGameName:n,t.setUsername(""),t.setPassword(""),o===!1&&$("#autoLoginCheckbox").suiOff(),t.accountType=t.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,$("#loginTitleTabs").html('<a class="item">'+n+'老账号</a><p class="btnBox"><a href="javascript:;" id="backBtn" class="white fl btn btn_dark back_btn">UC账号</a></p>'),$("#username").attr("placeholder",n),$("#registerBut").val("注册UC账号"),$("#forgetPassBtn").addClass("ms-ni"),t._setHistory(),$("#normalLoginBottom").addClass("ms-ni"),$("#gameLoginBottom").removeClass("ms-ni")}S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["oldAccountLogin"]});var t=this;$("#autoLoginCheckbox").suiOn(),this.versionFixing(),this.controller.getLoginConfig(e)},versionFixing:function(){var e=S.global.compareTo(rConfig.VERSIONS.AUTO_LOGIN_VERSION);e!==!1&&e>=0?$("#autoLoginCheckboxWrap").removeClass("ms-ni"):$("#autoLoginCheckboxWrap").addClass("ms-ni")},loginSubmit:function(){this.accountType===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidlogin_b"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_login_b"]);var e=this,t=this.accountType,n=this.$el.find("#username").val(),o=this.$el.find("#password").val(),i=$("#autoLoginCheckbox").isOn();this.controller.validLoginData(n,o,t,this.controller.callBackMix(function(n,o){e.loginLoadingEl=e._showLoading(),e.controller.loginSubmit({account:n,password:o,accountType:t,rememberPassword:!0,isAutoLogin:i},!0,e.controller.callBackMix(function(t,n){$("input").addClass("btnClick-none"),e.userController.getCurUserInfo(e.userController.callBackMix(function(i){var s=e.generalController.getCacheData("user_info_"+i.ucid,!0);s&&s.random&&o!=s.password&&e.generalController.setCacheData("user_info_"+i.ucid,{random:!1,password:o},0,!0),e.doLoginSuccess(t,n,i)}))},function(t,n){101==n.code?e.$el.find("#password").val(""):"",e._hideLoading(e.loginLoadingEl),e._showErrorMsg(n.msg)}))},function(t){105==t.code?e.$el.find("#password").val(""):"",e._showErrorMsg(t.msg)}))},doLoginSuccess:function(e,t,n){var o=e.get("account"),i=e.get("password"),s=e.get("accountType");e.get("rememberPassword");var r=this;ucf.Cache.set("openTestGame_"+e.get("ucid"),e.get("openTestGame"),86400,!0),ucf.Cache.set("isAlpha_"+e.get("ucid"),e.get("isAlpha"),86400,!0);var a=ucf.Cache.get("user_info_"+n.ucid,!0);a&&(n.isRandomPassword=a.random,n.randomPassword=n.isRandomPassword?a.password:n.randomPassword);var c=!(!1===n.isRandomPassword||0===n.randomPassword.length),l=ucf.Cache.get("login_binding_info",!0)||{};if(s===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN&&l[o]!==!0){l[o]=!0,ucf.Cache.set("login_binding_info",l,0,!0);var u=n.ucid,d=n.randomPassword;c?this.controller.validSecrecy(s,o,this.controller.callBackMix(function(){r._hideLoading(r.loginLoadingEl),sdk.PageCache.set("login_param",{accountType:r.controller.CONFIG.ACCOUNT_TYPE.LOGIN,account:u,password:i,randomPassword:d}),S.Url.location.route("#!sso/firstGameLogin")},function(e,t){r._hideLoading(r.loginLoadingEl),1!=t.code?r._showErrorMsg(e):r.userController.checkNoticeInfo(n.ucid,"updatePassword")?r.doLoginCheck(s,o):r._showUpdateRandomPassBox({accountType:r.controller.CONFIG.ACCOUNT_TYPE.LOGIN,account:n.ucid,randomPassword:n.randomPassword})})):this.existUCAccount()}else s===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN?this.existUCAccount(s,n.ucid):s===this.controller.CONFIG.ACCOUNT_TYPE.LOGIN&&!0===n.isRandomPassword?(r._hideLoading(r.loginLoadingEl),this.controller.updateLoginCount(n.ucid),r.userController.checkNoticeInfo(n.ucid,"updatePassword")?r.doLoginCheck(s,o):r._showUpdateRandomPassBox({accountType:s,account:n.ucid,randomPassword:n.randomPassword,isUCLogin:!0})):(r._hideLoading(r.loginLoadingEl),this.controller.updateLoginCount(n.ucid),this.doLoginCheck(s,n.ucid))},register:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_b"]),S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["register"]});var e=this._randomPassword(),t=this._showLoading(),n=this;this.userController.register({password:e,isAutoLogin:!0,agree:!0},this.userController.callBackMix(function(o){n._hideLoading(t);var i=o.get("ucid");ucf.Cache.set("user_info_"+i,{random:!0,password:e},0,!0),ucf.Cache.set("openTestGame_"+i,o.get("openTestGame"),3600,!0),ucf.Cache.set("isAlpha_"+i,o.get("isAlpha"),3600,!0),S.Url.location.route("#!register/regSuccess")},function(e){n._hideLoading(t),n.generalController.sendClientMsg(e)}),!0)},doLoginCheck:function(e,t,n){function o(e){function t(){if(s&&s.status&&"B"==s.status)return window.cordova=null,sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(s.message)),void 0;if(r)window.cordova=null,sdk.Url.redirect("../game/game.html#!game/validCode/false");else{if(i.userController.notifyCp({code:1,msg:"操作"}),n)return n.apply(i),void 0;i.userController.sdkExit()}}var o=e.ucid,s=ucf.Cache.get("openTestGame_"+o,!0),r=ucf.Cache.get("isAlpha_"+o,!0);t()}var i=this,s=this.userController.getCurUser();_.isEmpty(s)?this.userController.getCurUserInfo({success:function(e){o(e)}}):o(s)},bindMobile:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindphone_b"]),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bindSecrecyMobile"]),sdk.Url.location.route("#!secrecy/preBind/ucidbindpage")},returnGame:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindgame_b"]);var e=$("#ucAccount").attr("data-value"),t=$("#ucAccount").attr("data-acType");this.doLoginCheck(t,e)},firstGameLogin:function(){function e(e){if(e.success&&e.data){var t=e.data.account,n=e.data.accountType,o=e.data.randomPassword;$("#ucAccount").html(t),$("#ucAccount").attr("data-value",t),$("#ucAccount").attr("data-acType",n),$("#randomPassword").attr("data-value",o),$("#randomPassword").html(o)}}S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["firstGameLogin"]}),sdk.PageCache.get("login_param",e)},bindModifyAndLogin:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindmodifypwok_b"]),this.modifyAndLogin(1)},loginPageModifyAndLogin:function(){this.accountType===this.controller.CONFIG.ACCOUNT_TYPE.LOGIN?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_loginmodifypwok_b"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbindmodifypwok_b"]),this.modifyAndLogin()},modifyAndLogin:function(e){var t=this,n=$("#newPassword").val(),o=$("#accountParam").attr("data-value"),i=$("#accountParam").attr("data-acType"),s=$("#accountParam").attr("data-password"),r=S.SSCT.GetHandler("Controller","User"),a="callback"===$(".modifyAndLoginBtn").attr("data-callback")?!0:!1;r.updatePass({oldPassword:s,password:n,isPostPass:!0},r.callBackMix(function(){var s;a&&(s=function(){$("#passwordLabel").html("密码"),$("#randomPassword").html(n),$("#randomPassword").attr("data-value",n),t._hidePopBox()}),e?s():t.doLoginCheck(i,o,s)},function(e){t._showErrorMsg(e,"#loginSuccessNoticeBox")}))},existUCAccount:function(){this._hideLoading(this.loginLoadingEl),this._showExsitAccountBox()},toSecrecyPage:function(e,t,n){var o=this,i=this._showLoading();this.controller.validSecrecy(e,t,this.controller.callBackMix(function(){o._hideLoading(i),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bindSecrecyMobile"]),sdk.Url.location.route("#!secrecy/preBind/loginpage")},function(){o._hideLoading(i),n()}))},checkNerverNotice:function(){var e=$("#isNerverNotice");"checked"===e.attr("data-value")?(e.attr("data-value",""),e.removeClass("cbbg")):(e.attr("data-value","checked"),e.addClass("cbbg"))},useUCAccountLogin:function(){function e(e){var n=t.generalController.getCacheData("user_info_"+e.ucid,!0);n&&(e.isRandomPassword=n.random,e.randomPassword=e.isRandomPassword?n.password:e.randomPassword);var o=!(!1===e.isRandomPassword||0===e.randomPassword.length);o?t.userController.checkNoticeInfo(e.ucid,"updatePassword")?t.doLoginCheck(t.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid):t._showUpdateRandomPassBox({accountType:t.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,account:e.ucid,randomPassword:e.randomPassword}):t.doLoginCheck(t.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid)}var t=this,n=this.userController.getCurUser();_.isEmpty(n)?S.SSCT.GetHandler("Controller","User").getCurUserInfo({success:function(t){e(t)}}):e(n)},setUsername:function(e){this.$el.find("#username").val(e)},setPassword:function(e){e?this.$el.find("#password").val(e):this.$el.find("#password").val("")},logHist:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_otherid_b"])},selectHis:function(){var e=document.querySelector("#loginHistory"),t=e.options[e.selectedIndex],n=t.value,o=n||$("#loginHistory").val();if("-1"!=o){var i={},s=this;this.controller.getHistByUsername(o,this.accountType,this.controller.callBackMix(function(e){i=e,s._setAccount({account:i.account,password:i.password,isRandomPassword:i.isRandomPassword})}))}},checkRememPassword:function(e){var t,n=e.target,o=n.getAttribute("data-checked");"checked"===o?(t="",$(n).removeClass(this.localConfig.checkedClass)):(t="checked",$(n).addClass(this.localConfig.checkedClass)),n.setAttribute("data-checked",t)},resetUsername:function(){this.setUsername(""),this.resetPassword()},resetPassword:function(){this.setPassword("")},cancelUCAccountLogin:function(){function e(e){t.userController.setNerverNotice(e.ucid,!0),t.doLoginCheck(t.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid)}sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbindpass_b"]);var t=this,n=this.userController.getCurUser();_.isEmpty(n)?S.SSCT.GetHandler("Controller","User").getCurUserInfo({success:function(t){e(t)}}):e(n)},neverUpdatePass:function(){function e(e){t.userController.setNerverNotice(e.ucid,!0,"updatePassword"),$(".btnClick-none").removeClass("btnClick-none"),t._hidePopBox(),t.doLoginCheck(t.accountType,e.ucid)}this.accountType==this.controller.CONFIG.ACCOUNT_TYPE.LOGIN?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_loginmodifypwpass_l"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbindmodifypwpass_l"]);var t=this,n=this.userController.getCurUser();_.isEmpty(n)?S.SSCT.GetHandler("Controller","User").getCurUserInfo({success:function(t){e(t)}}):e(n)},cancelModify:function(){this._hidePopBox()},forgetPassword:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_forgetpw_l"]),S.Url.location.route("#!findPassword/passwordRetake/messageRetake")},gotoAgreement:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_article_l"]),S.Url.location.route("#!user/agreement")},gotoGameLogin:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldid_l"]),S.Url.location.route("#!sso/gameLogin")},goBack:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbinducid_b"]),S.Url.back()},setAccAutoLogin:function(){var e=$("#autoLoginCheckbox");e.isOn()?(e.suiOff(),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_CloseAutoLogin_b","login"])):(e.suiOn(),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_OpenAutoLogin_b","login"]))},_setHistory:function(e,t){var n={isRandomPassword:!1,account:"",password:""};this._getHistData(_.bind(function(o){var i=this.controller.getHistLength(this.accountType);if(0===i||_.isUndefined(o[0]))this.$el.find("#showHistory").removeClass("ms-block").addClass("ms-ni");else{i>1?this.$el.find("#showHistory").removeClass("ms-ni").addClass("ms-block"):this.$el.find("#showHistory").removeClass("ms-block").addClass("ms-ni");var s=null,r=document.createDocumentFragment(),a=new Option("请选择账号","-1");r.appendChild(a),_.each(o,function(t){_.isEmpty(e)||t.account!==e||(s=t),r.appendChild(new Option(t.account,t.account))}),$("#loginHistory").append(r),e&&t?s={isRandomPassword:!1,account:e,rememberPassword:!0,password:t}:e&&null===s?s={isRandomPassword:!1,account:e,rememberPassword:!1,password:""}:null===s&&(s=o[0]),n.isRandomPassword=s.isRandomPassword,n.account=s.account,s.rememberPassword&&(n.password=s.password)}this._setAccount({account:n.account,password:n.password,isRandomPassword:n.isRandomPassword})},this),!0)},_flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),$(window).width()>$(window).height()},_setAccount:function(e){this.setUsername(e.account),this.setPassword(e.password)},_showLoading:function(){var e=S.common.ui.NoticeBox.loading();return e},_textLoading:function(){var e=S.common.ui.NoticeBox.loading("loading_text");return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},_getHistData:function(e,t){var n=this,o=this.controller.getHistories(this.accountType);_.isUndefined(o)||t===!0?this.controller.getHistory(this.accountType,this.controller.callBackMix(function(t){e&&e(t)},function(e){n._showErrorMsg(e,"#errorEl")})):e&&e(o)},_showUpdateRandomPassBox:function(e){e.accountType==this.controller.CONFIG.ACCOUNT_TYPE.LOGIN?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_loginmodifypw_w"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbindmodifypw_w"]),$("input").addClass("btnClick-none"),this._showPopBox(template.render("updateRandomPassBoxTempl"),function(){$("#accountParam").attr("data-value",e.account),$("#accountParam").attr("data-acType",e.accountType),$("#accountParam").attr("data-password",e.randomPassword)})},_setUpdatePassParam:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindmodifypw_b"]),$("input").addClass("btnClick-none");var e=$("#ucAccount").attr("data-value"),t=$("#ucAccount").attr("data-acType"),n=$("#randomPassword").attr("data-value");this._showUpdatePassBox({account:e,accountType:t,password:n})},_showUpdatePassBox:function(e){this._showPopBox(template.render("updatePassBoxTempl"),function(){$("#accountParam").html(e.account),$("#accountParam").attr("data-value",e.account),$("#accountParam").attr("data-acType",e.accountType),$("#accountParam").attr("data-password",e.password)})},_showExsitAccountBox:function(){function e(e){var n=t.userController.checkNoticeInfo(e.ucid);n?t.doLoginCheck(t.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid):(S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["existUCAccount"]}),t._showPopBox(template.render("ownUCAccountBoxTempl"),function(){$("#bindTitle").html("我们发现你的《"+e.gameName+"》游戏老账号和UC账号曾经绑定过。"),$("#bindUcid").html("UC账号："+e.ucid)}))}var t=this,n=this.userController.getCurUser();_.isEmpty(n)?S.SSCT.GetHandler("Controller","User").getCurUserInfo({success:function(t){e(t)}}):e(n)},_showPopBox:function(e,t){var n=this;_.delay(function(){sdk.EC.hideInput(),$("#popBox").html(e),_.delay(function(){$("#popup").suiShow()},10),t.apply(n)},50)},_hidePopBox:function(){sdk.EC.showInput(),$("#popup").suiHide(),$(".btnClick-none").removeClass("btnClick-none"),$(window).off("resize")},_showErrorMsg:function(e){this.generalController.sendClientMsg(e)},_randomPassword:function(){return Math.random().toString().substr(2,8)}});S.SSVW.User=Backbone.View.extend({el:"#userContainer",events:{"onclick #changePassBtn":"gotoUpdatePass","onclick #confirmChangePass":"doUpdatePass","onclick #updatePswSubmit":"updatePasswordSub","onclick #payHistoryBtn":"gotoPayHistory","onclick #aboutBtn":"gotoAboutUs","onclick #feedBackBtn":"gotoFeedBack","onclick #gameBbsBtn":"gotoBBS","onclick #gameStrategyBtn":"gotoGameExp","onclick #userServiveBtn":"gotoUserService","onclick #vipBtn":"gotoVipArea","onclick #toSecrecyBtn":"gotoSecrecy","onclick #changeNickname":"changeNickname","onclick #submitNicknameBtn":"submitNickname","onclick #accountSecureBtn":"gotoAccountSecure","onclick #gotoSecCenterBtn":"gotoSecCenter","onclick #rechargeBtn":"gotoRecharge","onclick #multiAccountBtn":"gotoMultiAccount","onclick #becomeVipBtn":"gotoBecomeVip","onclick .del_icon":"_showConfirmBox","onclick #exitBtn":"curLogout","onclick #activeAgreementBtn":"gotoAgreement","onclick #bindUCAccount":"gotoActivate","onclick #bindUCAccountPlf":"gotoActivatePlf","onclick #regGuest":"registerGuestAccount","onclick #activateGuest":"bindGuestAccount","onclick #bindReturn":"bindReturn","change  #bindLoginHistory":"selectHis","onclick #bindLoginHistory":"logHist","onclick #userBaseInfo":"hideEditNickname","onclick #autoLoginSwitch":"setAutoLoginStatus","onclick .switAcc":"switAccHandler"},pageScroll:{},redirectTitle:void 0,redirectUrl:void 0,initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","User"),this.ssoController=S.SSCT.GetHandler("Controller","Sso"),this.generalController=S.SSCT.GetHandler("Controller","General")},urlConfig:{gameBbs:"gameBbs",gameStrategy:"gameGuide",userService:"feedback"},userInfo:function(){function e(){t.entranceControl(),t.controller.getBaseUserInfo(t.controller.callBackMix(t.renderBaseInfo,$.proxy(function(e){t.renderBaseInfo({}),sdk.common.ui.NoticeBox.error(e)},t)))}S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["management"]});var t=this;t.controller.getCurUserInfo(t.controller.callBackMix(e,t._getCurUserErrorHandler))},updatePassword:function(e){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["updatePassword"]});var t=this;this._enterType=e,this._getCurUserInfo({success:function(e){t.$el.find("#up-ucid").html(e.ucid),t.$el.find("#newPass").val(""),t.$el.find("#newPass").attr("placeholder","请输入6-20位字母或数字");var n=t.generalController.getCacheData("user_info_"+e.ucid,!0);_.isUndefined(n)||_.isEmpty(n)||n.random&&(e.isRandomPassword=!0,e.randomPassword=n.password),e.isRandomPassword?(t.$el.find("#oldPass").attr("placeholder",""),t.$el.find("#oldPass").val(e.randomPassword)):(t.$el.find("#oldPass").val(""),t.$el.find("#oldPass").attr("placeholder","请输入6-20位字母或数字")),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"onEdit"==e.action&&t.editMode===!0?t.cancelEditMode():"doUpdatePass"==e.action&&t.editMode!==!0&&t.doUpdatePass()}})},error:t._getCurUserErrorHandler})},renderBaseInfo:function(e){var t=this,n=S.SSCT.GetHandler("Controller","AccountManage");n.getSecureState(n.callBackMix(function(e){var t=$("#secureState");t.data("risk",e.risk),e.risk>=3?(t.text("级别：低"),t.removeClass(),t.addClass("oth pag_red")):(t.text("级别：高"),t.removeClass(),t.addClass("oth pag_green"))},function(e){t._showErrorMsg(e)}));var o=S.SSCT.GetHandler("Controller","Pay");o.getUPointBalance(o.callBackMix(function(e){$("#uPointBalance").text("余额："+e.get("balance")+" U点")},function(e){t._showErrorMsg(e)}));var i=S.SSCT.GetHandler("Controller","User");i.getLoginHistoryCount({},i.callBackMix(function(e){$("#accountNo").addClass("pag_blue");var t=parseInt(e.count);t>99?$("#accountNo").text("N"):$("#accountNo").text(e.count)},function(e){t._showErrorMsg(e)})),this.$el.find("#userInfoDetailBtn").removeAttr("disabled");var s=this;this.controller.getCurUserInfo(this.controller.callBackMix(function(t){var n,o=e.userName;if(_.isUndefined(o)||_.isEmpty(o)?o="UC用户":o.length>rConfig.user.showUserNickLen&&(o=o.substr(0,rConfig.user.showUserNickLen-1)+"..."),n=_.isUndefined(e.level)?0:e.level,s.$el.find("#sdkVersion").html(eConfig.version),_.isEmpty(e))ucf.Cache.set("userBaseInfo_"+t.ucid,{level:0,userName:"UC用户"},1800,!0),s.$el.find("#userInfoNickname").html(o),s.$el.find("#userInfoUcid").html(t.ucid),s.$el.find("#userInfoLevel").html(0),s.$el.find("#userInfoAvatar").attr("src","../common/sdk_images/tx-999.jpg"),s.$el.find("#userInfoVip").css("display","none");else{s.$el.find("#userInfoNickname").html(o),s.$el.find("#userInfoUcid").html(t.ucid);var i=!1,r="";0===e.gender?(r="../common/sdk_images/czsex.png",genderAvatar="../common/sdk_images/tx-998.jpg"):1===e.gender?(r="../common/sdk_images/sexn.png",genderAvatar="../common/sdk_images/tx-999.jpg"):(genderAvatar="../common/sdk_images/tx-999.jpg",i=!0),s.$el.find("#userInfoAvatar").attr("src",genderAvatar),s.$el.find("#userInfoLevel").html(n)}}))},entranceControl:function(){var e=S.global.compareTo(rConfig.VERSIONS.AUTO_LOGIN_VERSION);e!==!1&&e>=0?($("#autoLoginSetting").removeClass("ms-ni"),$("#autoLoginNoti").removeClass("ms-ni")):($("#autoLoginSetting").addClass("ms-ni"),$("#autoLoginNoti").addClass("ms-ni"));var t=!1;this.controller.getFeatureSwitch(this.controller.callBackMix(function(e){e.data.enablePayHistory&&($("#payHistoryBtn").removeClass("ms-ni"),$("#payHistoryBtn").addClass("p-last-border"),$("#rechargeBtn").removeClass("raddius"),t=!0),e.data.enableUserChange&&($("#logoutBtn").parent().removeClass("ms-none"),t||($("#logoutBtn").parent().addClass("p-last-border"),t=!0)),t&&$("#gameExp").parent().removeClass("p-last-border"),e.data.isAutoLogin===!0?($("#autoLoginSwitch").suiOn(),$("#autoLoginNoti").html("关闭后每次进入游戏时可重新选择账号进行登录。")):($("#autoLoginSwitch").suiOff(),$("#autoLoginNoti").html("开启后将自动使用最近登录的账号进入游戏。")),e.data.enableUserChange?$("#exitBtn").suiShow():$("#exitBtn").suiHide()},function(){console.log("获取功能开关失败！")}))},updatePasswordSub:function(){this.doUpdatePass()},doUpdatePass:function(){var e=this.$el.find("#oldPass").val(),t=this.$el.find("#newPass").val();if(!e)return this._showErrorMsg("请输入旧密码"),void 0;if(!t)return this._showErrorMsg("请输入新密码"),void 0;this.controller.setCurUser({}),this.$el.find("#confirmChangePass").attr("disabled","disabled");var n={oldPassword:e,password:t,isPostPass:!0},o=this;this.controller.updatePass(n,this.controller.callBackMix(function(){o.controller.getCurUserInfo(o.controller.callBackMix(function(){$("body").addClass("btnClick-none"),o._showErrorMsg("更新密码成功"),"tips"===o._enterType?S.Url.location.route("#!user"):S.Url.back()},function(){S.Url.location.route("#!sso/login")}))},function(e){o._showErrorMsg(e),o.$el.find("#confirmChangePass").removeAttr("disabled")}))},flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||sdk.common.ui.NoticeBox.hide(this.noticeBar,null,"slide")},showVipPanel:function(e){this.controller.getVipInfo(this.controller.callBackMix(function(){var t=$("#vip");t.css("display","block"),e||(t.addClass("p-last-border"),$("#gameExp").parent().removeClass("p-last-border"))},function(){}))},gotoVipArea:function(){S.Url.location.route("#!vip/showVipArea")},gotoUpdatePass:function(){S.Url.location.route("#!user/updatePassword")},_getCurUserErrorHandler:function(e){e||(e="获取当前用户失败"),this._showErrorMsg(e)},gotoPayHistory:function(){this._getCurUserInfo({success:function(e){var t=window.location.href.replace("user/user.html#!user","pay/pay.html#!pay/history/"+e.gameName);sdk.Log.pageEnter(sdk.Log.businesses.PAGE_PAY,["payHistory"]),window.cordova=null,S.Url.redirect(eConfig.payHistoryUrl+(eConfig.payHistoryUrl.indexOf("?")>=0?"&":"?")+"p="+encodeURIComponent(t))},error:this._getCurUserErrorHandler})},gotoAboutUs:function(){this._getCurUserInfo({success:function(e){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_GENERAL,["about"]),S.Url.redirect("../general/about.html?game="+e.gameName)},error:this._getCurUserErrorHandler})},gotoFeedBack:function(){this._getCurUserInfo({success:function(e){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["feedBack"]),sdk.PageCache.set("feedBack_result_url",window.location.href);var t=S.SSCT.GetHandler("Controller","Game");t.getGameInfo(t.callBackMix(function(t){S.Url.redirect(eConfig.feedBackCenter+"?uid="+e.ucid+"&uname="+e.nickname+"&gid="+t.gameId+"&gname="+e.gameName+"&skey=D02")}))},error:this._getCurUserErrorHandler})},_getRedirectURL:function(e,t){var n=this;this.generalController.getUrl(e,{success:function(e){t&&t(e)},error:function(e){n._showErrorMsg(e.msg)}})},gotoBBS:function(){this._getRedirectURL(this.urlConfig.gameBbs,function(e){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bbsClick"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["bbsClick"]),sdk.PageCache.set("sdk_redirect_out",1),S.Url.redirect(e)})},gotoGameExp:function(){this._getRedirectURL(this.urlConfig.gameStrategy,function(e){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["gameExp"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["gameExp"]),S.Url.redirect(e)})},gotoUserService:function(){this._getRedirectURL(this.urlConfig.userService,function(e){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["userService"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["userService"]),S.Url.redirect(e)})},gotoSecrecy:function(){S.Url.location.route("#!secrecy/preBind/usercenter")},multiAccount:function(){var e="",t=this;this.editMode=!1,this._getHistData(function(n){function o(o){_.each(n,function(t){itemHtml=template("accountInfoItemTempl",{gameName:_.isEmpty(t.gameName)?"空":t.gameName,ucAccount:t.account,status:o&&t.account===o.account?"icon_st":""}),e+=itemHtml}),$("#accountInfos").html(e),t.controller.getFeatureSwitch(t.controller.callBackMix(function(e){var n=S.global.compareTo(rConfig.VERSIONS.AUTO_LOGIN_VERSION);if(e.data.enableUserChange&&n!==!1&&n>=0){for(var o=document.querySelectorAll(".gotoStatus"),i=0;i<o.length;i++)o[i].style.visibility="visible";t._enableGotoStatus=!0}t._enableUserChange=e.data.enableUserChange})),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"backToUser"==e.action&&(sdk.common.ui.MsgBox.remove(),$("#delConfirmBox").suiHide(),S.Url.back()),"onEdit"==e.action&&t.editMode===!0?t.cancelEditMode():"onEdit"==e.action&&t.editMode!==!0&&t.showEditMode()}})}t._getCurUserInfo({success:o,error:function(){o()}})},!0)},showEditMode:function(){this.editMode=!0,this.generalController.setHeaderStyle({topBarBtnBackGame:{text:"完成",visible:!0,visiblePersist:!1,btnShape:"rect"}});for(var e=document.querySelectorAll(".delStatus"),t=0;t<e.length;t++)e[t].style.display="block";if(this._enableGotoStatus===!0)for(var n=document.querySelectorAll(".gotoStatus"),t=0;t<n.length;t++)n[t].style.visibility="hidden"},cancelEditMode:function(){this.editMode=!1,this.generalController.setHeaderStyle({topBarBtnBackGame:{text:"编辑",visible:!0,visiblePersist:!1,btnShape:"rect"}});for(var e=document.querySelectorAll(".delStatus"),t=0;t<e.length;t++)e[t].style.display="none";if(this._enableGotoStatus===!0)for(var n=document.querySelectorAll(".gotoStatus"),t=0;t<n.length;t++)n[t].style.visibility="visible"},_getHistData:function(e,t){var n=this,o=rConfig.ACCOUNT_TYPE.UC,i=this.ssoController.getHistories(o);!i||t?this.ssoController.getHistory(o,this.controller.callBackMix(function(t){e&&e(t)},function(e){n._showErrorMsg(e)})):e&&e(i)},removeHistory:function(e){var t=e,n=$(t).attr("data-account"),o=rConfig.ACCOUNT_TYPE.UC,i=this;this.controller.removeHistory({accountType:o,account:parseInt(n)},this.controller.callBackMix(function(){ucf.Cache.remove("user_info_"+n,!0),$(t).remove()},function(e){i._showErrorMsg(e)}))},_confirm:function(e,t,n){function o(){$("#delConfirm").off("click"),$("#delConfirmCancel").off("click")}var i=e.confirm||"确定",s=e.cancel||"取消",r=e.title||"",a=this,c=$("#mulAccConfirmBoxTempl").html();$("#delConfirmBox").length<1&&this.$el.append(c),$("#delConfirmBox").suiShow(),$("#delConfirm").btnText(i),$("#delConfirmCancel").btnText(s),$("#delConfirm").on("click",function(){o(),$("#delConfirmBox").suiHide(),t&&t.call(a)}),$("#delConfirmCancel").on("click",function(){o(),$("#delConfirmBox").suiHide(),n&&n.call(a)}),$("#delConfirmBoxContent").html(r)},_showConfirmBox:function(e){var t=this;if($(e.target).hasClass("del_icon")){$(e.target).addClass("btnClick-none");var n=e.target.parentNode.parentNode,o='<div><center><p class="gr-f16">确认在本机删除账号'+$(n).attr("data-account")+"？</p></center></div><div><center><p>被删除账号将不会出现在登录输入框中</p></center></div>";t._delConfirmElem=n,t._confirm({title:o},function(){t.removeHistory(t._delConfirmElem),window.scrollTo(0,document.body.scrollHeight)})}},curLogout:function(){var e=this;this._confirm({title:'<div><center><p class="gr-f16">确定要退出当前账号？</p></center></div>',confirm:"退出账号",cancel:"取消"},function(){e.controller.logout({success:function(){e.controller.notifyCp({code:1,msg:""},{success:function(){e.controller.sdkExit()},error:function(){e._showErrorMsg("通知游戏失败")}},"logout"),sdk.PageCache.set("clear_history",1)}})})},_showErrorMsg:function(e){this.generalController.sendClientMsg(e)},changeNickname:function(){$("#userInfoNickname").toggleClass("hide"),$("#changeNickname").toggleClass("hide"),$("#editNickname").toggleClass("hide"),$("#submitNicknameBtn").toggleClass("hide"),$("#editNickname").val("")},hideEditNickname:function(e){"editNickname"!=e.target.id&&"changeNickname"!=e.target.id&&$("#userInfoNickname").hasClass("hide")&&this.changeNickname()},submitNickname:function(){var e=this.$el.find("#editNickname").val();if(!e)return this._showErrorMsg("请输入昵称"),void 0;if(e.length<2||e.length>20)return this._showErrorMsg("昵称需要在2-20位之内"),void 0;this.controller.setCurUser({});var t={uid:this.$el.find("#userInfoUcid").text(),userName:e},n=this;this.controller.updateNickname(t,this.controller.callBackMix(function(){n.controller.getCurUserInfo(n.controller.callBackMix(function(){n._showErrorMsg("修改昵称成功"),e.length>rConfig.user.showUserNickLen&&(e=e.substr(0,rConfig.user.showUserNickLen-1)+"..."),$("#userInfoNickname").text(e)},function(){S.Url.location.route("#!sso/login")}))},function(e){"userName_isExist"==e?n._showErrorMsg("用户名已存在"):n._showErrorMsg(e)}))},gotoAccountSecure:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"backToUser"==e.action&&(sdk.common.ui.MsgBox.remove(),S.Url.back())}});var e=$("#secureState");"获取中"!=e.text()&&(parseInt(e.data("risk"))>=3?(sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["accountSecure"]),S.Url.location.route("#!secrecy/preBind/usercenter")):S.Url.location.route("#!user/alreadySafe"))},gotoSecCenter:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["accountSecure"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["accountSecure"]),sdk.PageCache.set("sdk_redirect_out",1);var e=eConfig.secureUrl+"?uc_param_str=frpfvesscpmilaprnisieiut&appId=17"+"&backUrl="+encodeURIComponent(eConfig.sdkExitBackUrl);S.Url.redirect(e)},gotoRecharge:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["udPay"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["udPay"]),sdk.PageCache.set("sdk_redirect_out",1);var e=eConfig.udPayCenterUrl+"?wp="+encodeURIComponent("H5充值首页")+"&from="+encodeURIComponent("游戏SDK个人中心")+"&link="+encodeURIComponent("H5充值首页");S.Url.redirect(e)},gotoMultiAccount:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["multiAccount"]),S.Url.location.route("#!user/multiAccount")},gotoBecomeVip:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["becomeVip"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["becomeVip"]),sdk.PageCache.set("sdk_redirect_out",1);var e=eConfig.becomeVip;S.Url.redirect(e)},gotoAgreement:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_article_l"]),S.Url.location.route("#!user/agreement")},gotoActivate:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_l"]),S.Url.location.route("#!user/activate")},gotoActivatePlf:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_l"]),S.Url.location.route("#!user/activatePlf")},activate:function(){function e(e){e.data&&(t=e.data.account,n=e.data.password),console.log("Android login history cache:"+JSON.stringify(e.data)),o._getHistData(function(e){var o=i.getHistLength(0);if(0===o||_.isUndefined(e[0]))s.$el.find("#bindLoginHistory").removeClass("ms-block").addClass("ms-ni");else{o>1?s.$el.find("#bindLoginHistory").removeClass("ms-ni").addClass("ms-block"):s.$el.find("#bindLoginHistory").removeClass("ms-block").addClass("ms-ni");var r=document.createDocumentFragment(),a=new Option("请选择账号","-1");r.appendChild(a),_.each(e,function(e){r.appendChild(new Option(e.account,e.account))}),$("#bindLoginHistory").append(r)}t&&n?(s.$el.find("#ucAccountToBind").val(t),s.$el.find("#passwordToBind").val(n)):e[0]&&(s.$el.find("#ucAccountToBind").val(e[0].account),s.$el.find("#passwordToBind").val(e[0].password))},!0)}sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_p"]),this._backButtonHandle(function(e){"activeBackGame"==e.action&&(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_leaveformaloldid_b"]),S.SSCT.GetHandler("Controller","User").sdkExit())});var t,n,o=S.SSCT.GetHandler("View","Sso"),i=S.SSCT.GetHandler("Controller","Sso"),s=this;sdk.PageCache.get("auto_login_info",e)},activatePlf:function(){this.activate()},regActivate:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5a_formalsign_p"]),this._backButtonHandle(function(e){"regActiveBackGame"==e.action&&(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_leaveformalsign_b"]),S.SSCT.GetHandler("Controller","User").sdkExit())})},regActivatePlf:function(){this.regActivate();var e=sdk.common.utils.Url.getQueryStringArgs();e.title&&(this.redirectTitle=e.title,this.redirectUrl=e.redirectUrl,this.$el.find("#activateHint").text("进入"+e.title+"前，请先注册账号并完成激活："))},logHist:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_otherid_b"])},selectHis:function(){var e=this.$el.find("#bindLoginHistory").val(),t=e||this.$el.find("#bindLoginHistory").val(),n=S.SSCT.GetHandler("Controller","Sso"),o=this;"-1"!=t&&n.getHistByUsername(t,0,this.controller.callBackMix(function(e){o.$el.find("#ucAccountToBind").val(e.account),o.$el.find("#passwordToBind").val(e.password)},function(){o.$el.find("#passwordToBind").val("")}))},registerGuestAccount:function(){function e(e){sdk.Log.click(sdk.Log.businesses.PAGE_USER,[e])}sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formalsign_b"]),$("#regGuest").addClass("btnClick-none");var t=this.$el.find("#regGuestEmail").val(),n=this.$el.find("#regGuestPassword").val(),o=this;if(t&&!t.match(rConfig.user.emailAccountFilter))return this._showErrorMsg("邮箱输入有误"),e("email_format_error"),void 0;if(n.length<6||n.length>20)return this._showErrorMsg("密码长度不符（6-20位）"),void 0;if(n.match(rConfig.user.passwordFilter))return this._showErrorMsg("密码必须为字母或数字"),void 0;var i={email:t,password:n};this.controller.registerGuestAccount(i,this.controller.callBackMix(function(e){t.length>20&&(t=t.substr(0,19)+"..."),o.$el.find("#newUCID").text(e.data.ucid),o.$el.find("#bindEmail").text(t),t?o.$el.find("#bindEmailP").removeClass("ms-vshid"):o.$el.find("#bindEmailP").addClass("ms-vshid"),setTimeout($.proxy(function(){this.bindGuestAccountSuccess()},o),80)},function(t){t.msg.match("已被使用")&&e("email_is_used_error"),o._showErrorMsg(t.msg)}))},bindGuestAccountSuccess:function(){this._hideLinkEffect("bindReturn"),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5a_formalsignok_p"]),this.redirectTitle&&this.$el.find("#bindReturn").val("进入"+this.redirectTitle),$("#registerGuestAccountSuccess").suiShow()},bindGuestAccount:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_b"]);var e=this.$el.find("#ucAccountToBind").val(),t=this.$el.find("#passwordToBind").val(),n=this;if(""==e)return this._showErrorMsg("请输入账号"),void 0;if(t.length<6||t.length>20)return this._showErrorMsg("密码长度不符（6-20位）"),void 0;if(t.match(rConfig.user.passwordFilter))return this._showErrorMsg("密码必须为字母或数字"),void 0;var o={account:e,password:t,accountType:0,rememberPassword:!0,isAutoLogin:!0},i=this._textLoading();this.controller.bindGuestAccount(o,this.controller.callBackMix(function(){n._hideLoading(i),n._showErrorMsg("激活成功"),n.redirectUrl?S.Url.redirect(n.redirectUrl):n.controller.sdkExit()},function(e){n._hideLoading(i),n._showErrorMsg(e.msg)}))},setAutoLoginStatus:function(){function e(){o.suiOn(),$("#autoLoginNoti").html("关闭后每次进入游戏时可重新选择账号进行登录。")}function t(){o.suiOff(),$("#autoLoginNoti").html("开启后将自动使用最近登录的账号进入游戏。")}function n(e){e.msg&&i._showErrorMsg(e.msg)}var o=$("#autoLoginSwitch"),i=this;o.isOn()?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_CloseAutoLogin_b","usercenter"]),this.controller.setAutoLoginState({isAutoLogin:!1},{success:t,error:n})):(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_OpenAutoLogin_b","usercenter"]),this.controller.setAutoLoginState({isAutoLogin:!0},{success:e,error:n}))},_textLoading:function(){var e=S.common.ui.NoticeBox.loading("loading_text");return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},bindReturn:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formalsignok_b"]),this.redirectUrl?S.Url.redirect(this.redirectUrl):this.controller.sdkExit()},_getAccParent:function(e){var t=e;return t=t.data("account")?t:t.parent(),t=t.data("account")?t:t.parent(),t=t.data("account")?t:t.parent()},switAccHandler:function(e){if(this.editMode!==!0&&this._enableUserChange&&this._enableGotoStatus){var t=$(e.target),n=this,o=this._getAccParent(t),i=t.parent().data("account")||t.parent().parent().data("account")||t.parent().parent().parent().data("account");!i||$(".icon_st",o).length>0||(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ChangeAccount_w"]),this._confirm({title:'<div><center><p class="gr-f16">您要切换账号'+i+"登录？</p></center></div>",confirm:"确认",cancel:"取消"},function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ChangeAccountOK_b"]),n.generalController.quietRequestAsync(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT,{success:function(){n.controller.notifyCp({code:1,msg:"",account:i},{success:function(){n.controller.sdkExit()},error:function(){n._showErrorMsg("通知游戏失败")}},"logout")},error:function(){n._showErrorMsg("切换账号失败")}})}))}},_backButtonHandle:function(e){S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:e})},_getCurUserInfo:function(e){var t=this.controller.getCurUser();_.isEmpty(t)?this.controller.getCurUserInfo(e):e.success.call(this,t)}});S.SSVW.Vip=Backbone.View.extend({el:"#userContainer",events:{},initialize:function(){_.bindAll(this,"showVipArea")},showVipArea:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["vip"]})}});